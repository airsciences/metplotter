(function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.API=t=function(){function t(t,i){var e
this.preError="Plotter.API",e=this.preError+".constructor()",this.async=!0,"undefined"!=typeof i&&(this.async=i),this.getAccessToken=function(){return t.token},this.getAccessTokenValue=function(){if(void 0===t.token)throw new Error(e+" Access token is not defined.")
return"Token "+t.token},this.getCSRFToken=function(){if(void 0===t.csrfToken)throw new Error(e+" CSRF token is not defined.")
return t.csrfToken}}return t.prototype.build=function(){var t,i,e
if(i=this.preError+".build()",e=null,XMLHttpRequest)e=new XMLHttpRequest
else try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){t=n
try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=e,console.error(i,"Cannot specify XMLHTTPRequest (error)",t)}}return e},t.prototype.get=function(t,i,e){var n,s,o
s=this.preError+".get(uri, params, callback)",o=this.build(),"undefined"!=typeof e&&(o.onreadystatechange=function(){var t,i
if(4===o.readyState){if(200!==o.status&&304!==o.status)return console.log(s+" HTTP error, (status): "+o.status),void(o=null)
i={response:o.response,responseText:o.responseText,responseJSON:null}
try{i.responseJSON=JSON.parse(i.responseText)}catch(e){t=e,i.responseJSON=null}return e(i)}}),i=this.encodeArgs("GET",i)
try{o.open("GET",t+i,this.async),o.setRequestHeader("Authorization",this.getAccessTokenValue()),o.send(null)}catch(t){throw n=t,new Error(s+", "+n)}},t.prototype.put=function(t,i,e){var n,s,o
s=this.preError+".put(uri, params, callback)",o=this.build(),"undefined"!=typeof e&&(o.onreadystatechange=function(){var t,i
if(4===o.readyState){if(200!==o.status&&304!==o.status)return console.log(s+" HTTP error, (status): "+o.status),void(o=null)
i={response:o.response,responseText:o.responseText,responseJSON:null}
try{i.responseJSON=JSON.parse(i.responseText)}catch(e){t=e,i.responseJSON=null}return e(i)}}),i=this.encodeArgs("PUT",i)
try{o.open("PUT",t,this.async),o.setRequestHeader("Authorization",this.getAccessToken()),o.setRequestHeader("X-CSRFToken",this.getCSRFToken()),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(i)}catch(t){n=t,console.log(s+"catch(error).",n)}},t.prototype.post=function(t,i,e){var n,s,o
s=this.preError+".post(uri, params, callback)",o=build(),"undefined"!=typeof e&&(o.onreadystatechange=function(){var t,i
if(4===o.readyState){if(200!==o.status&&304!==o.status)return console.log(s+" HTTP error, (status): "+o.status),void(o=null)
i={response:o.response,responseText:o.responseText,responseJSON:null}
try{i.responseJSON=JSON.parse(i.responseText)}catch(e){t=e,i.responseJSON=null}return e(i)}}),i=this.encodeArgs("POST",i)
try{o.open("POST",t,this.async),o.setRequestHeader("Authorization",this.getAccessToken()),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(i)}catch(t){n=t,console.log(s+"catch(error).",n)}},t.prototype.delete=function(t,i,e){var n,s,o
s=this.preError+".delete(uri, params, callback)",o=this.build(),"undefined"!=typeof e&&(o.onreadystatechange=function(){var t,i
if(4===o.readyState){if(200!==o.status&&304!==o.status)return console.log(s+" HTTP error, (status): "+o.status),void(o=null)
i={response:o.response,responseText:o.responseText,responseJSON:null}
try{i.responseJSON=JSON.parse(i.responseText)}catch(e){t=e,i.responseJSON=null}return e(i)}}),i=this.encodeArgs("DELETE",i)
try{o.open("DELETE",t,this.async),o.setRequestHeader("Authorization",this.getAccessToken()),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(i)}catch(t){n=t,console.log(s+"catch(error).",n)}},t.prototype.encodeArgs=function(t,i){var e,n,s,o,r
if(r=this.preError+"encodeArgs(type, json_args)",n="",e=0,"string"==typeof i)try{i=JSON.parse(i)}catch(t){o=t,console.log(r+"catch(error).",o)}if("POST"===t||"PUT"===t)n=JSON.stringify(i)
else if("GET"===t)for(s in i)n=0===e?"?"+s+"="+i[s]:n+"&"+s+"="+i[s],e++
return n},t}()}).call(this),function(){var t,i=[].slice
window.Plotter||(window.Plotter={}),window.Plotter.BarPlot=t=function(){function t(t,e,n){var s,o,r
this.preError="BarPlot.",this.plotter=t,this.initialized=!1,r=[{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,maxBar:null,color:"rgb(41, 128, 185)",band:{minVariable:null,maxVariable:null}}],this.defaults={plotId:null,uuid:"",debug:!0,target:null,width:null,merge:!1,x:{variable:null,format:"%Y-%m-%dT%H:%M:%SZ",min:null,max:null,ticks:7},y:r,zoom:{scale:{min:.05,max:5}},aspectDivisor:5,transitionDuration:500,weight:2,axisColor:"rgb(0,0,0)",font:{weight:100,size:12},focusX:{color:"rgb(52, 52, 52)"},crosshairX:{weight:1,color:"rgb(149,165,166)"},requestInterval:336},n.x&&(n.x=this.plotter.lib.mergeDefaults(n.x,this.defaults.x)),n.y[0]=this.plotter.lib.mergeDefaults(n.y[0],this.defaults.y[0]),this.options=this.plotter.lib.mergeDefaults(n,this.defaults),this.device="full",this.transform=d3.zoomIdentity,this.links=[{variable:"battery_voltage",title:"Battery Voltage"},{variable:"temperature",title:"Temperature"},{variable:"relative_humidity",title:"Relative Humidity"},{variable:"precipitation",title:"Precipitation"},{variable:"snow_depth",title:"Snow Depth"},{variable:"wind_direction",title:"Wind Direction"},{variable:"wind_speed_average",title:"Wind Speed"},{variable:"net_solar",title:"Net Solar"},{variable:"solar_pyranometer",title:"Solar Pyranometer"},{variable:"equip_temperature",title:"Equipment Temperature"},{variable:"barometric_pressure",title:"Barometric Pressure"},{variable:"snowfall_24_hour",title:"24-Hr Snowfall"},{variable:"intermittent_snow",title:"Intermittent Snow"}],this.log=function(){var t
t=1<=arguments.length?i.call(arguments,0):[]},this.options.debug&&(this.log=function(){var t
return t=1<=arguments.length?i.call(arguments,0):[],console.log(t)}),this.parseDate=d3.timeParse(this.options.x.format),this.bisectDate=d3.bisector(function(t){return t.x}).left,this.displayDate=d3.timeFormat("%b. %e, %I:%M %p"),this.sortDatetimeAsc=function(t,i){return t.x-i.x},this.data=this.processData(e),this.getDefinition(),this.clipPathId="bar-plot-clip-path-"+this.plotter.lib.uuid(),this.bars=[],this.focusRect=[],this.focusText=[],this.skipBandDomainSet=!1,o=null,s=null,e.length>0&&(o=this.getDomainScale(this.definition.x),s=this.getDomainMean(this.definition.x)),this.state={range:{data:[],scale:o},length:{data:[]},interval:{data:[]},zoom:1,request:{data:[]},requested:{data:[]},mean:{scale:s}},e[0].length>0&&(this.setDataState(),this.setIntervalState(),this.setDataRequirement())}return t.prototype.processData=function(t){var i,e,n
i=[]
for(n in t)e=t[n],i[n]=this.processDataSet(e,n)
return i},t.prototype.processDataSet=function(t,i){var e,n,s,o,r
n=this.options.y[i],o=[]
for(s in t)r=t[s],o[s]={x:new Date(this.parseDate(r[this.options.x.variable]).getTime()-288e5),y:r[n.variable]},null!=n.band&&(n.band.minVariable&&(o[s].yMin=r[n.band.minVariable]),n.band.maxVariable&&(o[s].yMax=r[n.band.maxVariable]))
return e=new Plotter.Data(o),o=e._clean(e.get()),o.sort(this.sortDatetimeAsc)},t.prototype.setData=function(t){var i,e
if(this.data=[this.processDataSet(t,0)],this.getDefinition(),e=null,i=null,t.length>0&&(e=this.getDomainScale(this.definition.x),i=this.getDomainMean(this.definition.x)),this.state.range.scale=e,this.state.mean.scale=i,t.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.addData=function(t,i){var e,n
if(this.data[i]=this.processDataSet(t,i),this.getDefinition(),n=null,e=null,t.length>0&&(n=this.getDomainScale(this.definition.x),e=this.getDomainMean(this.definition.x)),this.state.range.scale=n,this.state.mean.scale=e,t.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.appendData=function(t,i){var e,n
if(e=this.processDataSet(t,i),n=new window.Plotter.Data(this.data[i]),n.append(e,["x"]),this.data[i]=n._clean(n.get()),this.data[i]=this.data[i].sort(this.sortDatetimeAsc),this.initialized)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.removeData=function(t){if(t>=0&&(delete this.data[t],delete this.options[t],this.svg.select(".bar-plot-area-"+t).remove(),this.svg.select(".bar-plot-path-"+t).remove(),this.svg.select(".focus-rect-"+t).remove(),this.svg.select(".focus-text-"+t).remove(),this.initialized))return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.setDataState=function(){var t,i,e,n,s
t=this.data.length-1,e=this.data,n=[]
for(i in e)s=e[i],this.state.range.data[i]={min:d3.min(this.data[i],function(t){return t.x}),max:d3.max(this.data[i],function(t){return t.x})},n.push(this.state.length.data[i]=this.data[i].length)
return n},t.prototype.setIntervalState=function(){var t,i,e,n
i=this.data,e=[]
for(t in i)n=i[t],e.push(this.state.interval.data[t]={min:(this.state.range.scale.min.getTime()-this.state.range.data[t].min.getTime())/36e5,max:(this.state.range.data[t].max.getTime()-this.state.range.scale.max.getTime())/36e5})
return e},t.prototype.setDataRequirement=function(){var t,i,e,n,s,o
i=new Date,n=this.data,s=[]
for(e in n)o=n[e],t=this.state.interval.data[e].max<this.options.requestInterval,this.state.request.data[e]={min:this.state.interval.data[e].min<this.options.requestInterval,max:t},null==this.state.requested.data[e]?s.push(this.state.requested.data[e]={min:!1,max:!1}):s.push(void 0)
return s},t.prototype.setZoomState=function(t){return this.state.zoom=t},t.prototype.getDomainScale=function(t){var i
return i={min:t.domain()[0],max:t.domain()[1]}},t.prototype.getDomainMean=function(t){var i
return i=new Date(d3.mean(t.domain())),i.setHours(i.getHours()+Math.round(i.getMinutes()/60)),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),i},t.prototype.getDefinition=function(){var t,i,e
return e=this.preError+"getDefinition():",t=this,this.definition={},this.calculateChartDims(),this.calculateAxisDims(this.data),this.definition.xAxis=d3.axisBottom().scale(this.definition.x).ticks(Math.round(this.definition.dimensions.width/100)),this.definition.yAxis=d3.axisLeft().scale(this.definition.y).ticks(this.options.y[0].ticks),this.definition.x.domain([this.definition.x.min,this.definition.x.max]),this.skipBandDomainSet||(this.definition.x1.domain(this.data[0].map(function(t){return t.x})),this.skipBandDomainSet=!1),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),i=[[-(1/0),0],[this.definition.x(new Date)+this.definition.dimensions.margin.left,this.definition.dimensions.innerHeight]],this.definition.zoom=d3.zoom().scaleExtent([this.options.zoom.scale.min,this.options.zoom.scale.max]).translateExtent(i).on("zoom",function(){var i
return i=t.setZoomTransform(),t.plotter.i.zoom.set(i)})},t.prototype.setBandDomain=function(t){return this.definition.x1=t},t.prototype.calculateChartDims=function(){var t,i,e,n
return n=null!=this.options.width?Math.round(this.options.width):Math.round($(this.options.target).width())-24,i=Math.round(n/this.options.aspectDivisor),n>1e3?e={top:Math.round(.04*i),right:Math.round(Math.pow(n,.3)),bottom:Math.round(.12*i),left:Math.round(Math.pow(n,.6))}:n>600?(this.device="mid",this.options.font.size=this.options.font.size/1.25,t=this.options.aspectDivisor/1.25,i=Math.round(n/t),e={top:Math.round(.04*i),right:Math.round(Math.pow(n,.3)),bottom:Math.round(.14*i),left:Math.round(Math.pow(n,.6))}):(this.device="small",this.options.font.size=this.options.font.size/1.5,t=this.options.aspectDivisor/1.5,i=Math.round(n/t),e={top:Math.round(.04*i),right:Math.round(Math.pow(n,.3)),bottom:Math.round(.18*i),left:Math.round(Math.pow(n,.6))}),this.definition.dimensions={width:n,height:i,margin:e},this.definition.dimensions.topPadding=parseInt(this.definition.dimensions.margin.top),this.definition.dimensions.bottomPadding=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom),this.definition.dimensions.leftPadding=parseInt(this.definition.dimensions.margin.left),this.definition.dimensions.innerHeight=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom-this.definition.dimensions.margin.top),this.definition.dimensions.innerWidth=parseInt(this.definition.dimensions.width-this.definition.dimensions.margin.left-this.definition.dimensions.margin.right),this.definition.x=d3.scaleTime().range([e.left,n-e.right]),this.definition.x1=d3.scaleBand().rangeRound([e.left,n-e.right],.05).padding(.1),this.definition.y=d3.scaleLinear().range([i-e.bottom,e.top])},t.prototype.calculateAxisDims=function(t){return this.calculateXAxisDims(t),this.calculateYAxisDims(t)},t.prototype.calculateXAxisDims=function(t){return null===this.options.x.min?this.definition.x.min=d3.min(t[0],function(t){return t.x}):this.definition.x.min=this.parseDate(this.options.x.min),null===this.options.x.max?this.definition.x.max=d3.max(t[0],function(t){return t.x}):this.definition.x.max=this.parseDate(this.options.x.max)},t.prototype.calculateYAxisDims=function(t){var i,e,n,s
this.definition.y.min=0,this.definition.y.max=0
for(s in t)n=t[s],e=d3.min([d3.min(n,function(t){return t.y}),d3.min(n,function(t){return t.yMin})]),i=d3.max([d3.max(n,function(t){return t.y}),d3.max(n,function(t){return t.yMax})]),(e<this.definition.y.min||void 0===this.definition.y.min)&&(this.definition.y.min=e),(i>this.definition.y.max||void 0===this.definition.y.max)&&(this.definition.y.max=i)
if(this.definition.y.min===this.definition.y.max&&(this.definition.y.min=.8*this.definition.y.min,this.definition.y.max=1.2*this.definition.y.min),null!=this.options.y[0].min&&(this.definition.y.min=this.options.y[0].min),null!=this.options.y[0].max)return this.definition.y.max=this.options.y[0].max},t.prototype.preAppend=function(){var t,i
return i=this.preError+"preAppend()",t=this,this.outer=d3.select(this.options.target).append("div").attr("class","bar-plot-body").style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px").style("display","inline-block"),this.ctls=d3.select(this.options.target).append("div").attr("class","plot-controls").style("width","23px").style("height",this.definition.dimensions.height+"px").style("display","inline-block").style("vertical-align","top"),this.svg=this.outer.append("svg").attr("class","bar-plot").attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.append("defs").append("clipPath").attr("id",this.clipPathId).append("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.append("g").attr("class","bar-plot-axis-x").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.append("g").attr("class","bar-plot-axis-y").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)")},t.prototype.append=function(){var t,i,e,n,s,o,r,a,l
if(this.initialized=!0,this.initialized){o=this.preError+"append()",t=this,this.svg.select(".bar-plot-axis-x").call(this.definition.xAxis),this.svg.select(".bar-plot-axis-y").call(this.definition.yAxis),e=""+this.options.y[0].title,this.options.y[0].units&&(e=e+" "+this.options.y[0].units),n=-15,i=-52,"small"===this.device&&(n=-10,i=-30),this.svg.select(".bar-plot-axis-y").append("text").text(e).attr("class","bar-plot-y-label").attr("x",n).attr("y",i).attr("dy",".75em").attr("transform","rotate(-90)").style("font-size",this.options.font.size).style("font-weight",this.options.font.weight),this.barWrapper=this.svg.append("g").attr("class","bar-wrapper"),r=this.data
for(s in r)l=r[s],this.bars[s]=this.barWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").selectAll(".bar-"+s).data(l).enter().append("rect").attr("class","bar-"+s).attr("x",function(i){return t.definition.x(i.x)}).attr("width",d3.max([1,this.definition.x1.bandwidth()])).attr("y",function(i){return t.definition.y(i.y)}).attr("height",function(i){return t.definition.dimensions.innerHeight+t.definition.dimensions.margin.top-t.definition.y(i.y)}).style("fill",this.options.y[s].color)
null!=this.options.y[0].maxBar&&this.barWrapper.append("rect").attr("class","bar-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(this.options.y[0].maxBar)).attr("width",this.definition.dimensions.innerWidth).attr("height",1).style("color","#gggggg").style("opacity",.4),this.hoverWrapper=this.svg.append("g").attr("class","hover-wrapper"),this.crosshairs=this.hoverWrapper.append("g").attr("class","crosshair"),this.crosshairs.append("line").attr("class","crosshair-x").style("stroke",this.options.crosshairX.color).style("stroke-width",this.options.crosshairX.weight).style("stroke-dasharray","3, 3").style("fill","none"),this.crosshairs.append("rect").attr("class","crosshair-x-under").style("fill","rgb(255,255,255)").style("opacity",.1),this.focusDateText=this.hoverWrapper.append("text").attr("class","focus-date-text").attr("x",9).attr("y",7).style("display","none").style("fill","#000000").style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),a=this.data
for(s in a)l=a[s],this.focusRect[s]=this.hoverWrapper.append("rect").attr("width",this.definition.x1.bandwidth()).attr("height",2).attr("class","focus-rect-"+s).attr("fill",this.options.focusX.color).attr("transform","translate(-10, -10)").style("display","none").style("stroke","rgb(255,255,255)").style("opacity",.75),this.focusText[s]=this.hoverWrapper.append("text").attr("class","focus-text-"+s).attr("x",11).attr("y",7).style("display","none").style("fill",this.options.y[s].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)")
return this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(this.transform),this.appendZoomTarget(this.transform)}},t.prototype.update=function(){var t,i,e,n,s,o,r
s=this.preError+"update()",t=this,e=this.transform.rescaleX(this.definition.x),i=Math.floor(this.transform.k*this.definition.x1.bandwidth()),o=this.data
for(n in o)r=o[n],null!=r&&null!=t.options.y[n]&&(null===this.svg.selectAll(".bar-"+n).node()[0]?(console.log("Adding new BarPlot data set."),this.bars[n]=this.barWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").selectAll(".bar-"+n).data(r).enter().append("rect").attr("class","bar-"+n).attr("x",function(t){return e(t.x)}).attr("width",d3.max([1,i])).attr("y",function(i){return t.definition.y(i.y)}).attr("height",function(i){return t.definition.dimensions.innerHeight+t.definition.dimensions.margin.top-t.definition.y(i.y)}).style("fill",this.options.y[n].color),this.focusRect[n]=this.hoverWrapper.append("rect").attr("width",this.definition.x1.bandwidth()).attr("height",2).attr("class","focus-rect-"+n).attr("fill",this.options.focusX.color).attr("transform","translate(-10, -10)").style("display","none").style("stroke","rgb(255,255,255)").style("opacity",.75),this.focusText[n]=this.hoverWrapper.append("text").attr("class","focus-text-"+n).attr("x",11).attr("y",7).style("display","none").style("fill",this.options.y[n].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)")):(this.bars[n]=this.barWrapper.select("g").selectAll(".bar-"+n).data(r),this.bars[n].enter().append("rect").attr("class","bar-"+n).attr("x",function(t){return e(t.x)}).attr("width",d3.max([1,i])).attr("y",function(i){return t.definition.y(i.y)}).attr("height",function(i){return t.definition.dimensions.innerHeight+t.definition.dimensions.margin.top-t.definition.y(i.y)}).style("fill",this.options.y[n].color),this.bars[n].exit().remove(),this.bars[n].attr("x",function(t){return e(t.x)}).attr("width",d3.max([1,i])).attr("y",function(i){return t.definition.y(i.y)}).attr("height",function(i){return t.definition.dimensions.innerHeight+t.definition.dimensions.margin.top-t.definition.y(i.y)})))
return this.overlay.remove(),this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(this.transform),this.appendZoomTarget(this.transform),this.calculateYAxisDims(this.data),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),this.svg.select(".bar-plot-axis-y").call(this.definition.yAxis),null!=this.options.y[0].maxBar&&this.barWrapper.select(".bar-plot-max-bar").attr("y",this.definition.y(this.options.y[0].maxBar)),this.setZoomTransform(this.transform)},t.prototype.removeTemp=function(){return this.temp.remove()},t.prototype.appendCrosshairTarget=function(t){var i,e
if(this.initialized)return e=this.preError+"appendCrosshairTarget()",i=this,this.overlay.datum(this.data).attr("class","overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").on("mouseover",function(){return i.plotter.i.crosshairs.show()}).on("mouseout",function(){return i.plotter.i.crosshairs.hide()}).on("mousemove",function(){var e
return e=i.setCrosshair(t),i.plotter.i.crosshairs.set(t,e)})},t.prototype.appendZoomTarget=function(t){var i,e
if(this.initialized)return e=this.preError+"appendZoomTarget()",i=this,this.overlay.attr("class","zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").style("cursor","move"),this.svg.call(this.definition.zoom,t)},t.prototype.setZoomTransform=function(t){var i,e,n,s,o,r,a
if(this.initialized){o=this.preError+".setZoomTransform(transform)",i=this,null!=t?this.transform=t:null!=d3.event&&(this.transform=d3.event.transform),n=this.transform,e=n.rescaleX(this.definition.x),this.svg.select(".bar-plot-axis-x").call(this.definition.xAxis.scale(e)),this.state.range.scale=this.getDomainScale(e),this.state.mean.scale=this.getDomainMean(e),this.setDataState(),this.setIntervalState(),this.setDataRequirement(),this.setZoomState(n.k),r=this.data
for(s in r)a=r[s],this.svg.selectAll(".bar-"+s).attr("x",function(t){return e(t.x)}).attr("width",d3.max([1,Math.floor(n.k*this.definition.x1.bandwidth())]))
return this.appendCrosshairTarget(n),n}},t.prototype.setCrosshair=function(t,i){var e,n,s,o,r,a,l,p,h,d,u,c,f,m,g,y,x
if(this.initialized){m=this.preError+".setCrosshair(mouse)",e=this,o=this.definition.dimensions,p=function(t){switch(!1){case!(t>360||t<0):return"INV"
case!(t>=0&&t<11.25):return"N"
case!(t>=11.25&&t<33.75):return"NNE"
case!(t>=33.75&&t<56.25):return"NE"
case!(t>=56.25&&t<78.75):return"ENE"
case!(t>=78.75&&t<101.25):return"E"
case!(t>=101.25&&t<123.75):return"ESE"
case!(t>=123.75&&t<146.25):return"SE"
case!(t>=146.25&&t<168.75):return"SSE"
case!(t>=168.75&&t<191.25):return"S"
case!(t>=191.25&&t<213.75):return"SSW"
case!(t>=213.75&&t<236.25):return"SW"
case!(t>=236.25&&t<258.75):return"WSW"
case!(t>=258.75&&t<281.25):return"W"
case!(t>=281.25&&t<303.75):return"WNW"
case!(t>=303.75&&t<326.25):return"NW"
case!(t>=326.25&&t<348.75):return"NNW"
case!(t>=348.75&&t<=360):return"N"}},g=this.data
for(f in g)y=g[f],r=this.overlay.node(),s=y,i=i?i:d3.mouse(r),x=this.definition.x.invert(i[0]+o.leftPadding),t&&(x=this.definition.x.invert(t.invertX(i[0]+o.leftPadding))),c=e.bisectDate(s,x,1),u=x.getMinutes()>=30?c:c-1,x.getTime()<=this.state.range.data[f].min.getTime()&&(u=c),x.getTime()>=this.state.range.data[f].max.getTime()&&(u=c-1),null!=s[u]&&(h=t?t.applyX(this.definition.x(s[u].x)):this.definition.x(s[u].x),d=[],a=[],null!==this.options.y[f].variable&&(a[f]=s[u],null!=a[f]&&(d[f]=this.definition.y(a[f].y),n=this.displayDate(a[f].x),isNaN(d[f])||null==a[f].y||this.focusRect[f].attr("transform","translate(0, 0)"))),l=h-o.leftPadding,l>=0&&(this.crosshairs.select(".crosshair-x").attr("x1",l).attr("y1",o.topPadding).attr("x2",l).attr("y2",o.innerHeight+o.topPadding).attr("transform","translate("+o.leftPadding+", 0)"),this.crosshairs.select(".crosshair-x-under").attr("x",l).attr("y",o.topPadding).attr("width",o.innerWidth-l).attr("height",o.innerHeight).attr("transform","translate("+o.leftPadding+", 0)"),this.focusDateText.attr("x",l-120).attr("y",o.topPadding+o.innerHeight-3).attr("transform","translate("+o.leftPadding+", 0)").text(n),null===this.options.y[f].variable||isNaN(d[f])||null==a[f].y||(this.focusRect[f].attr("width",t.k*this.definition.x1.bandwidth()).attr("x",h).attr("y",d[f]),this.focusText[f].attr("x",h+o.leftPadding/10+t.k*this.definition.x1.bandwidth()+2).attr("y",d[f]-o.topPadding/10).text(null!=a[f].y?"wind_direction"===e.options.y[0].variable?p(a[f].y):a[f].y.toFixed(2)+" "+this.options.y[f].units:void 0))))
return i}},t.prototype.showCrosshair=function(){var t,i,e,n
if(this.initialized){this.crosshairs.select(".crosshair-x").style("display",null),this.crosshairs.select(".crosshair-x-under").style("display",null),this.focusDateText.style("display",null),t=this.options.y,i=[]
for(n in t)e=t[n],null!==e.variable?(null!=this.focusRect[n]&&this.focusRect[n].style("display",null).attr("fill",this.options.focusX.color),null!=this.focusText[n]?i.push(this.focusText[n].style("display",null).style("color",e.color).style("fill",e.color)):i.push(void 0)):i.push(void 0)
return i}},t.prototype.hideCrosshair=function(){var t,i,e,n
if(this.initialized){this.crosshairs.select(".crosshair-x").style("display","none"),this.crosshairs.select(".crosshair-x-under").style("display","none"),this.focusDateText.style("display","none"),t=this.options.y,i=[]
for(n in t)e=t[n],null!==e.variable?(null!=this.focusRect[n]&&this.focusRect[n].style("display","none"),null!=this.focusText[n]?i.push(this.focusText[n].style("display","none")):i.push(void 0)):i.push(void 0)
return i}},t.prototype.appendTitle=function(t,i){var e,n,s
if(n=1,e="16px",s="12px","small"===this.device&&(n=.4,e="10px",s="7px"),this.title=this.svg.append("g").attr("class","bar-plot-title"),this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2-4*n).style("font-size",e).style("font-weight",600).text(t),i)return this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2+12*n).style("font-size",s).text(i)},t.prototype.getState=function(){return this.state},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Colors=t=function(){function t(){var t
t={light:["rgb(53, 152, 219)","rgb(241, 196, 14)","rgb(155, 88, 181)","rgb(27, 188, 155)","rgb(52, 73, 94)","rgb(231, 126, 35)","rgb(45, 204, 112)","rgb(232, 76, 61)","rgb(149, 165, 165)"],dark:["rgb(45, 62, 80)","rgb(210, 84, 0)","rgb(39, 174, 97)","rgb(192, 57, 43)","rgb(126, 140, 141)","rgb(42, 128, 185)","rgb(239, 154, 15)","rgb(143, 68, 173)","rgb(23, 160, 134)"]},this.color=function(i,e){return t[i][e]},this.templateColors={}}return t.prototype.getInitial=function(t){var i,e,n
e=t.y
for(i in e)n=e[i],n.color=this.get(n.dataLoggerId)
return t},t.prototype.get=function(t){var i,e
return i=Object.keys(this.templateColors).length,e=2*i%7,null!=this.templateColors[t]==!1&&(this.templateColors[t]=this.color("light",e)),this.templateColors[t]},t}()}.call(this),function(){var t,i=[].indexOf||function(t){for(var i=0,e=this.length;i<e;i++)if(i in this&&this[i]===t)return i
return-1}
window.Plotter||(window.Plotter={}),window.Plotter.Controls=t=function(){function t(t){this.preError="Plotter.Dropdown",this.plotter=t,this.api=this.plotter.i.api,this.current=[],this.stations=[],this.maps=[],this.markers={},this.listeners={}}return t.prototype.append=function(t){var i,e,n,s,o,r
return n=this.plotter.i.template.full()[t],e=this.plotter.plots[t].proto,s=e.options.uuid,r="plot-controls-"+s,i="",o='<ul id="'+r+'" class="unstyled" style="list-style-type: none; padding-left: 6px;"> </ul>',$(e.options.target).find(".plot-controls").append(o),this.move(t,"#"+r,"up"),this.new("#"+r,"down"),this.remove(t,"#"+r),this.move(t,"#"+r,"down"),"station"===n.type?this.appendParameterDropdown(t,"#"+r,e.options.y.dataloggerid):"parameter"===n.type?this.appendStationDropdown(t,"#"+r,e.options.y[0].variable):void 0},t.prototype.setCurrent=function(t){var i,e,n,s,o,r
if(i=this.plotter.plots[t].proto,this.current[t]=[],i.initialized){s=i.options.y,o=[]
for(n in s)r=s[n],null!==r.dataLoggerId?(e={dataLoggerId:parseInt(r.dataLoggerId),yTarget:n,color:r.color},o.push(this.current[t].push(e))):o.push(void 0)
return o}},t.prototype.getCurrent=function(t){return t>=0?this.current[t]:this.current},t.prototype.updateStationStates=function(t){var i,e,n,s,o,r,a,l,p
if(this.setCurrent(t),this.stations[t].length>0){for(r=this.stations[t],l=[],s=0,o=r.length;s<o;s++)a=r[s],a.displayed=[],l.push(function(){var s,o,r,l
for(r=a.dataloggers,l=[],s=0,o=r.length;s<o;s++)p=r[s],p.displayed=!1,p.color="",e=this.plotter.lib.indexOfValue(this.current[t],"dataLoggerId",p.id),e>-1?(i=this.current[t][e].color,p.displayed=!0,p.color=i,n={dataLoggerId:p.id,color:i},l.push(a.displayed.push(n))):l.push(void 0)
return l}.call(this))
return l}},t.prototype.appendStationDropdown=function(t,i,e){var n,s,o,r,a,l
return a=this.plotter.options.href+"/api/v5/dataloggerregion?sensor_name="+e,n=this,s={},r=this.getCurrent(t),l=this.plotter.lib.uuid(),o=function(e){var s,o,r,a,p,h,d,u,c,f
for(n.stations[t]=e.responseJSON.results,o='<div class="dropdown"> <li><a id="station-'+l+'" class="station-dropdown dropdown-toggle" role="button" title="Select Stations" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="station-dropdown-'+t+'" class="dropdown-menu pull-right">',d=n.stations[t],r=0,p=d.length;r<p;r++){for(c=d[r],s=n.plotter.lib.toLower(c.name),o=o+' <li class="subheader"> <a data-region="'+s+'" data-plot-id="'+t+'" href=""> <i class="icon-caret-down" style="margin-right: 6px"></i> <span class="region-name">'+c.name+'</span> <span class="region-dots"></span> </a> </li> <ul class="list-group-item sublist" style="display: none;">',u=c.dataloggers,a=0,h=u.length;a<h;a++)f=u[a],o=o+' <li class="station" data-station-id="'+f.id+'" data-plot-id="'+t+'" style="padding: 1px 5px; cursor: pointer; list-style-type: none"> <i class="icon-circle"></i> <span class="station-name"> '+f.datalogger_name+" | "+f.elevation+" ft </span> </li>"
o+=" </ul>"}return o+=" </ul> </li>",$(i).prepend(o),$("#station-"+l).dropdown(),n.bindSubMenuEvent(".subheader"),n.setCurrent(t),n.updateStationDropdown(t),n.appendStationMap(t,i,e.responseJSON.results)},this.api.get(a,s,o)},t.prototype.updateStationDropdown=function(t){var i,e,n,s,o,r,a,l,p,h,d,u,c,f,m
for(i=this,this.updateStationStates(t),n=function(t){var i,e,n,s
for(i="",e=0,n=t.length;e<n;e++)s=t[e],i=i+' <i style="color: '+s.color+';" class="icon-circle"></i>'
return i},e=function(t,i,e){return e.displayed?$('[data-station-id="'+e.id+'"][data-plot-id="'+t+'"]').off("click").on("click",function(t){var e
return t.stopPropagation(),e=$(this).attr("data-plot-id"),$(this).append('<i class="icon-spinner icon-spin" data-plot-id="'+e+'"></i>'),i.removeStation(e,$(this).attr("data-station-id"))}):$('[data-station-id="'+e.id+'"][data-plot-id="'+t+'"]').off("click").on("click",function(t){var e
return t.stopPropagation(),e=$(this).attr("data-plot-id"),$(this).append('<i class="icon-spinner icon-spin" data-plot-id="'+e+'"></i>'),i.addStation(e,$(this).attr("data-station-id"))})},u=this.stations[t],l=0,h=u.length;l<h;l++){for(f=u[l],o=this.plotter.lib.toLower(f.name),r="",a="",s="",f.displayed.length>0&&(s="rgb(248, 248, 248)",a=700,r=n(f.displayed)),c=f.dataloggers,p=0,d=c.length;p<d;p++)m=c[p],$('[data-station-id="'+m.id+'"][data-plot-id="'+t+'"]> i.icon-circle').css("color",m.color),e(t,i.plotter,m)
$('[data-region="'+o+'"][data-plot-id="'+t+'"]').css("font-weight",a),$('[data-region="'+o+'"][data-plot-id="'+t+'"] > span.region-dots').html(r)}if(null!=this.plotter.legends[t])return this.plotter.legends[t].draw()},t.prototype.removeSpinner=function(t){return $('i.icon-spinner[data-plot-id="'+t+'"]').remove()},t.prototype.appendParameterDropdown=function(t,e,n){var s,o,r,a,l,p
return l=this.plotter.options.href+"/api/v5/sensortype?sensors__data_logger="+n,o={},a=this.getCurrent(t),p=this.plotter.lib.uuid(),s=[],r=function(n){var s,o,r,l,h,d,u,c,f,m
for(l='<div class="dropdown"> <li><a id="param-'+p+'" class="parameter-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="param-dropdown-'+t+'" class="dropdown-menu pull-right" role="menu" aria-labelledby="'+p+'">',f=n.responseJSON.results,h=0,u=f.length;h<u;h++)c=f[h],"wind_speed_minimum"===c.field_name||"wind_speed_maximum"===c.field_name||("wind_speed_average"===c.field_name?(s=c.field_name,o=s.replace("_","-"),d=o+"-plot-"+t,m=a.variable,i.call(c.field_name,m)>=0&&(r='<i id="'+d+'" class="parameter-'+c.parameter+' icon-circle" style="color: '+a.color+'"></i>')):(s=c.field_name,o=s.replace("_","-"),d=o+"-plot-"+t,r=a.variable===c.field_name?'<i id="'+d+'" class="icon-circle" style="color: '+a.color+'"></i>':'<i id="'+d+'" class="icon-circle" style=""></i>')),l=l+' <li><a style="cursor: pointer" onclick="plotter.addVariable('+t+", '"+s+"')\">"+r+" "+c.sensortype_name+"</a></li>"
return l+=" </ul> </li> </div>",$(e).prepend(l),$("#"+p).dropdown()},this.api.get(l,o,r)},t.prototype.appendStationMap=function(t,i,e){var n,s,o,r,a,l,p,h,d,u,c,f,m,g,y,x,v,w,b,S,P,D,T,_
for(n=this,u=this.getCurrent(t),h=this.plotter.plots[t].proto.options.uuid,c='<li data-toggle="popover" data-placement="left"> <i id="map-'+h+'" class="icon-map-marker" title="Select Stations Map" style="cursor: pointer"></i> </li> <div class="popover" style="max-width: 356px;"> <div class="popover-content"> <a id="map-close-'+h+'" style="font-size: 10px; cursor: pointer">Close</a> <div id="map-control-'+h+'" style="width: 312px; height: 312px;"></div> </div> </div>',$(i).prepend(c),$("#map-"+h).on("click",function(){return n.plotter.i.controls.toggleMap(t)}),$("#map-close-"+h).on("click",function(){return n.plotter.i.controls.toggleMap(t)}),this.maps[t]=new google.maps.Map(document.getElementById("map-control-"+h),{center:new google.maps.LatLng(46.98,-122.221),zoom:6,maxZoom:12,minZoom:6,mapTypeId:"terrain",zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1}),m=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),this.markers[t]=[],this.listeners[t]=[],o=new google.maps.LatLngBounds,s=[],f=0,x=e.length;f<x;f++)for(D=e[f],P=D.dataloggers,g=0,v=P.length;g<v;g++)_=P[g],d="rgb(200,200,200)",T=5,S=.5,p="map-plot-"+h+"-station-"+_.id,l=n.isCurrent(u,"dataLoggerId",_.id),l&&(d=l.color,T=7,S=.8,s.push(new google.maps.LatLng(_.lat,_.lon))),b=new google.maps.Marker({position:{lat:_.lat,lng:_.lon},id:p,tooltip:_.datalogger_name+" - "+_.elevation+" ft",dataLoggerId:_.id,icon:{path:google.maps.SymbolPath.CIRCLE,scale:T,strokeWeight:2,fillOpacity:S,fillColor:d},selected:!1}),b.addListener("mouseover",function(){return m.setContent(this.tooltip),m.open(n.maps[t],this)}),b.addListener("mouseout",function(){return m.close()}),this.listeners[t][p]=b.addListener("click",function(){return n.plotter.addStation(t,this.dataLoggerId)}),r=this.markers[t][p]=b,this.markers[t][p].setMap(this.maps[t])
if(s.length>0){for(y=0,w=s.length;y<w;y++)a=s[y],o.extend(a)
this.maps[t].fitBounds(o),this.maps[t].panToBounds(o)}if(this.maps[t].getZoom()<6)return this.maps[t].setZoom(6)},t.prototype.resetStationMap=function(t){var i,e,n,s,o
i=this,s=this.markers[t],o=[]
for(e in s)n=s[e],n.setIcon({path:google.maps.SymbolPath.CIRCLE,scale:5,strokeWeight:2,fillOpacity:.5,fillColor:"rgb(200,200,200)"}),n.set("selected",!1),i.listeners[t][e].remove(),o.push(i.listeners[t][e]=n.addListener("click",function(){var e
return e=this.get("dataLoggerId"),i.plotter.addStation(t,e)}))
return o},t.prototype.updateStationMap=function(t){var i,e,n,s,o,r,a,l,p,h
i=this,o=this.plotter.plots[t].proto.options.uuid,this.resetStationMap(t),h=function(t,e,n){return i.markers[t][e].setIcon({path:google.maps.SymbolPath.CIRCLE,scale:7,strokeWeight:2,fillOpacity:.8,fillColor:n}),i.markers[t][e].set("selected",!0),i.listeners[t][e].remove(),i.listeners[t][e]=i.markers[t][e].addListener("click",function(){var e
return e=this.get("dataLoggerId"),i.plotter.removeStation(t,e)})},n=this.plotter.plots[t].proto.options,a=n.y,l=[]
for(r in a)p=a[r],null!==p.variable?(e=p.variable.replace("_","-"),s="map-plot-"+o+"-station-"+p.dataLoggerId,l.push(h(t,s,p.color))):l.push(void 0)
return l},t.prototype.boundOnSelected=function(t){var i,e,n,s,o,r,a,l,p,h
i=this,n=new google.maps.LatLngBounds,e=[],h=this.markers[t]
for(s in h)o=h[s],a=o.get("selected"),a===!0&&e.push(o.getPosition())
for(l=0,p=e.length;l<p;l++)r=e[l],n.extend(r)
if(this.maps[t].fitBounds(n),this.maps[t].getZoom()<6)return this.maps[t].setZoom(6)},t.prototype.toggleMap=function(t){var i,e,n,s,o,r
return o=this.plotter.plots[t].proto.options.uuid,e=128,n=268,"http://localhost:5000"===location.origin&&(e=0,n=12),i=this.plotter.i.controls.maps[t].getCenter(),r=this.plotter.i.controls.maps[t].getZoom(),s=$("#map-control-"+o).parent().parent().prev().offset(),$("#map-control-"+o).parent().parent().toggle().css("left",s.left-356-e).css("top",s.top-n),google.maps.event.trigger(this.plotter.i.controls.maps[t],"resize"),this.plotter.i.controls.maps[t].setCenter(i),this.plotter.i.controls.maps[t].setZoom(r)},t.prototype.toggle=function(t){return $(t).toggle()},t.prototype.move=function(t,i,e){var n,s,o,r
return n=this,o=this.plotter.plots[t].proto.options.uuid,s="up"===e?"Up":"Down",r='<i id="move-'+o+"-"+e+'" style="cursor: pointer;" title="Move Plot '+s+'" class="icon-arrow-'+e+'"></i>',$(i).append(r),$("#move-"+o+"-"+e).on("click",function(){return n.plotter.move(t,e)})},t.prototype.remove=function(t,i){var e,n,s
return e=this,n=this.plotter.plots[t].proto.options.uuid,s='<i id="remove-'+n+'" style="cursor: pointer;" title="Remove Plot" class="icon-remove"></i>',$(i).append(s),$("#remove-"+n).on("click",function(){return e.plotter.remove(t)})},t.prototype.new=function(t){var i,e,n,s,o,r,a,l,p,h,d
for(i=this,d=this.plotter.lib.uuid(),e=[{variable:"battery_voltage",title:"Battery Voltage"},{variable:"net_solar",title:"Solar Radiation"},{variable:"solar_pyranometer",title:"Solar Pyranometer"},{variable:"relative_humidity",title:"Relative Humidity"},{variable:"barometric_pressure",title:"Barometric Pressure"},{variable:"snow_depth",title:"Snow Depth"},{variable:"snowfall_24_hour",title:"24-Hour Snowfall"},{variable:"intermittent_snow",title:"Intermittent Snow"},{variable:"wind_direction",title:"Wind Direction"},{variable:"precipitation",title:"Precipitation (Bar Plot)"},{variable:"precipitation_line",title:"Precipitation (Line Plot)"},{variable:"temperature",title:"Temperature"},{variable:"equip_temperature",title:"Equipment Temperature"},{variable:"wind_speed_average",title:"Wind Speed"}],n='<ul id="new-'+d+'-dropdown" class="dropdown-menu pull-right" role="menu" aria-labelledby="new-'+d+'"> <li><a id="new-'+d+'-parameter" style="cursor: pointer">Add Parameter Plot</a></li> <li><a id="new-'+d+'-station" style="cursor: pointer">Add Station Plot</a></li> </ul>',s='<div class="dropdown"> <li><a id="new-'+d+'" class="dropdown-toggle" title="Add New Plot" data-toggle="dropdown" role="button" href="#"> <i class="icon-plus"></i></a> <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="'+d+'">',o=0,a=e.length;o<a;o++)h=e[o],s=s+' <li><a id="new_'+h.variable+"_"+d+'" data-variable="'+h.variable+'">'+h.title+"</a></li>"
for(s+=" </ul> </li> </div>",$(t).append(s),p=[],r=0,l=e.length;r<l;r++)h=e[r],p.push($("#new_"+h.variable+"_"+d).off("click").on("click",function(){var t
return t=$(this).attr("data-variable"),i.plotter.add("parameter",t)}))
return p},t.prototype.isCurrent=function(t,i,e){var n,s
for(n in t)if(s=t[n],s[i]===e)return s
return!1},t.prototype.bindSubMenuEvent=function(t){return $(t).unbind().on("click",function(t){var i
return t.preventDefault(),t.stopPropagation(),i=$(this).next(),i.is(":visible")?($(this).find("i").removeClass("icon-caret-up").addClass("icon-caret-down"),i.slideUp()):($(this).find("i").removeClass("icon-caret-down").addClass("icon-caret-up"),i.slideDown())})},t.prototype.getLoggerName=function(t,i){var e,n,s,o,r,a,l
a="Station",o=this.stations[t]
for(n in o){s=o[n],r=s.dataloggers
for(e in r)l=r[e],l.id===parseInt(i)&&(a=l.datalogger_name+" - "+l.elevation+" Ft.")}return a},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Crosshairs=t=function(){function t(t){this.preError="Plotter.Crosshairs.",this.plotter=t}return t.prototype.set=function(t,i){var e,n,s,o,r
for(o=this.plotter.plots,r=[],e=0,n=o.length;e<n;e++)s=o[e],null!=s?r.push(s.proto.setCrosshair(t,i)):r.push(void 0)
return r},t.prototype.show=function(){var t,i,e,n,s
for(n=this.plotter.plots,s=[],t=0,i=n.length;t<i;t++)e=n[t],null!=e?s.push(e.proto.showCrosshair()):s.push(void 0)
return s},t.prototype.hide=function(){var t,i,e,n,s
for(n=this.plotter.plots,s=[],t=0,i=n.length;t<i;t++)e=n[t],null!=e?s.push(e.proto.hideCrosshair()):s.push(void 0)
return s},t}()}.call(this),function(){var t,i=[].indexOf||function(t){for(var i=0,e=this.length;i<e;i++)if(i in this&&this[i]===t)return i
return-1}
window.Plotter||(window.Plotter={}),window.Plotter.Data=t=function(){function t(t){var i
return this.preError="Plotter.Data.",i=this.preError+".constructor(...)",t instanceof Array?(this.data=$.extend(!0,[],t),this.sourceCount=1,void(this.test=function(t,e,n){var s,o,r,a,l,p
if(i=this.preError+"test(...):",null==n)throw new Error(i+" Missing onKeys (required)")
for(o=n.length,s=0,l=!1,r=0,a=n.length;r<a;r++){if(p=n[r],void 0===t[p])throw new Error(i+" key '"+p+"' not found in primary data set.")
if(void 0===e[p])throw new Error(i+" key '"+p+"' not found in joining data set.")
t[p]instanceof Date?t[p].getTime()===e[p].getTime()&&s++:t[p]===e[p]&&s++}return s===o&&(l=!0),l})):void console.log(i+" data not of type array.")}return t.prototype.join=function(t,e){var n,s,o,r,a,l,p,h,d,u,c,f,m,g,y
m=this.preError+".join(data, onKeys)",g=[],r="_"+parseInt(this.sourceCount+1),l=Object.keys(this.data[0]),n=Object.keys(t[0]),t.length>this.data.length?(a=$.extend(!0,[],t),h=$.extend(!0,[],this.data)):(a=$.extend(!0,[],this.data),h=$.extend(!0,[],t))
for(f in a){y=a[f],o=g.push($.extend(!0,{},y))
for(s in h)if(p=h[s],u=this.test(y,p,e)){for(d in p)c=p[d],i.call(e,d)<0&&(g[o-1][d+r]=c)
h.splice(s,1)
break}}return this.sourceCount++,this.data=this._clean(g),this.data},t.prototype.merge=function(t,e){var n,s,o,r,a,l,p,h,d,u,c,f,m,g
f=this.preError+".merge(data, onKeys)",m=[],a=Object.keys(this.data[0]),n=Object.keys(t[0]),t.length>this.data.length?(r=$.extend(!0,[],t),p=$.extend(!0,[],this.data)):(r=$.extend(!0,[],this.data),p=$.extend(!0,[],t))
for(c in r){g=r[c],o=m.push($.extend(!0,{},g))
for(s in p)if(l=p[s],d=this.test(g,l,e)){for(h in l)u=l[h],i.call(e,h)<0&&(m[o-1][h]=u)
p.splice(s,1)
break}}return this.data=this._clean(m),this.data},t.prototype.append=function(t,e){var n,s,o,r,a,l,p,h,d,u,c
d=this.preError+".append(data, onKeys)",s=$.extend(!0,[],this.data),r=$.extend(!0,[],t)
for(h in s){c=s[h]
for(n in r)if(o=r[n],l=this.test(c,o,e)){for(a in o)p=o[a],i.call(e,a)<0&&(s[h][a]=p)
r.splice(n,1)}}return u=s.concat(r),this.data=this._clean(u),this.data},t.prototype.appendKeys=function(t,i){var e,n,s
n=[]
for(e in t)s=t[e],n[e+i]=s
return this._clean(n)},t.prototype.sub=function(t,i){return this.data=this._clean($.extend(!0,[],this.data.slice(t,i))),this.data},t.prototype.get=function(){return $.extend(!0,[],this.data)},t.prototype.getSourceCount=function(){return this.sourceCount},t.prototype._clean=function(t){var i,e,n,s,o
for(i=$.extend(!0,[],t),e=i.length-1,n=s=0,o=e;0<=o?s<=o:s>=o;n=0<=o?++s:--s)void 0===i[n]&&i.splice(n,1)
return $.extend(!0,[],i)},t.prototype._tryError=function(t,i){var e,n,s,o,r
for(e=t.length-1,r=[],n=s=0,o=e;0<=o?s<=o:s>=o;n=0<=o?++s:--s){if(void 0===t[n])throw console.log("@data[i] is (i, row)",n,row),new Error(i+" undefined row")
r.push(void 0)}return r},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.InitialSync=t=function(){function t(t){this.preError="Plotter.InitialSync",this.plotter=t,this.api=this.plotter.i.api,this.requests={},this.endpoint=function(){return this.plotter.options.href+"/api/v5/measurement"}}return t.prototype.stageAll=function(){var t,i,e,n
for(n=[],i=t=0,e=this.plotter.i.template.plotCount()-1;0<=e?t<=e:t>=e;i=0<=e?++t:--t)n.push(this.stage(i))
return n},t.prototype.stage=function(t){var i,e,n,s,o,r,a,l
for(i=this.plotter.i.template.template[t],o=i.x.max,a=[],n=s=0,r=this.plotter.i.template.dataSetCount(t)-1;0<=r?s<=r:s>=r;n=0<=r?++s:--s)e=this.plotter.i.template.forSync(t,n,o,this.plotter.options.initialLength),l=this.plotter.lib.uuid(),this.requests[l]={plot:t,ready:!1,requested:!1},a.push(this.requests[l].requested=this.get(t,n,l,e))
return a},t.prototype.add=function(t){var i,e,n,s,o,r,a,l,p,h
for(p=this.plotter.plots,s=0,o=p.length;s<o;s++)if(l=p[s],void 0!==l){e=l.proto.getState()
break}return i=this.plotter.i.template.template[t],a=this.plotter.lib.format(e.range.data[0].max),r=e.length.data[0],n=this.plotter.i.template.forSync(t,0,a,r),h=this.plotter.lib.uuid(),this.requests[h]={plotId:t,ready:!1,requested:!1},this.requests[h].requested=this.getAppend(t,0,h,n)},t.prototype.get=function(t,i,e,n){var s,o,r,a
return r=this.preError+".get()",a=this.endpoint(),s=this,o=function(n){if(null==n.responseJSON)throw new Error(r+" error requesting data.")
if(0===n.responseJSON.results.length)throw new Error(r+" no set found.")
return s.requests[e].ready=!0,s.plotter.plots[t].__data__[i]=n.responseJSON.results},this.api.get(a,n,o),!0},t.prototype.getAppend=function(t,i,e,n){var s,o,r,a
return r=this.preError+".get()",a=this.endpoint(),s=this,o=function(n){var o,a,l,p,h
if(null==n.responseJSON)throw new Error(r+" error requesting data.")
if(0===n.responseJSON.results.length)throw new Error(r+" no set found.")
for(h=s.plotter.plots,a=0,l=h.length;a<l;a++)if(p=h[a],void 0!==p){o=p.proto.transform
break}return null==s.plotter.plots[t].__data__&&(s.plotter.plots[t].__data__=[]),s.requests[e].ready=!0,s.plotter.plots[t].__data__[i]=n.responseJSON.results,s.plotter.plots[t].proto.skipBandDomainSet=!0,s.plotter.plots[t].proto.setData(s.plotter.plots[t].__data__[i]),s.plotter.plots[t].proto.setBandDomain(s.plotter.bandDomain),s.plotter.plots[t].proto.append(),s.plotter.plots[t].proto.setZoomTransform(o),null==s.plotter.legends[t]&&(s.plotter.legends[t]=new window.Plotter.Legend(s.plotter,t),s.plotter.legends[t].draw()),s.plotter.i.controls.removeSpinner(t)},this.api.get(a,n,o),!0},t.prototype.isReady=function(){var t,i,e,n
t=0,e=this.requests
for(i in e)n=e[i],n.ready===!1&&t++
return 0===t},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Legend=t=function(){function t(t,i){var e
this.preError="Plotter.Legend.",e=this.preError+".constructor(...)",this.plotter=t,this.svg=this.plotter.plots[i].proto.svg,this.plotId=this.plotter.plots[i].proto.options.plotId,this.dimensions=this.plotter.plots[i].proto.definition.dimensions,this.legend=this.svg.append("g").attr("class","legend")}return t.prototype.set=function(){var t,i,e,n,s,o,r
this.data=[],e=this.plotter.plots[this.plotId].proto.options,t=0,o=e.y
for(s in o)r=o[s],i=this.plotter.i.controls.getLoggerName(this.plotId,r.dataLoggerId),t++,n={offset:t,title:""+i,color:r.color},this.data.push(n)
return this.data},t.prototype.draw=function(){var t,i
return this.set(),t=this.legend.selectAll("rect").data(this.data),t.attr("y",function(t){return 12*t.offset}).style("fill",function(t){return t.color}),t.enter().append("rect").attr("rx",1).attr("ry",1).attr("width",6).attr("height",6).attr("x",this.dimensions.margin.left+20).attr("y",function(t){return 12*t.offset}).style("fill",function(t){return t.color}),t.exit().remove(),i=this.legend.selectAll("text").data(this.data),i.attr("y",function(t){return 12*t.offset+6}).text(function(t){return t.title}),i.enter().append("text").attr("x",this.dimensions.margin.left+30).attr("y",function(t){return 12*t.offset+6}).text(function(t){return t.title}).style("font-size","12px").style("font-weight",500),i.exit().remove(),{remove:function(){return this.legend.selectAll(".legend").remove()}}},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Library=t=function(){function t(t){var i,e
e={dateFormat:"%Y-%m-%dT%H:%M:%SZ",displayDate:"%b. %e, %I:%M %p"},i=this.mergeDefaults(e,t),this.parseDate=d3.timeParse(i.dateFormat),this.format=d3.utcFormat(i.dateFormat),this.displayFormat=d3.timeFormat(i.displayDate),this.getNow=function(){return this.format(new Date)},this.getNowDisplay=function(){return this.displayFormat(new Date)}}return t.prototype.mergeDefaults=function(t,i){var e,n,s,o,r
s={}
for(e in i)o=i[e],s[e]=o
for(n in t)r=t[n],s[n]=r
return s},t.prototype.indexOfValue=function(t,i,e){var n,s,o,r
if(s=-1,t.length>0)for(n=o=0,r=t.length-1;0<=r?o<=r:o>=r;n=0<=r?++o:--o)null!=t[n]&&t[n][i]==e&&(s=n)
return s},t.prototype.uuid=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},t.prototype.utarget=function(t){return t=t.replace("#",""),t+"-"+this.uuid()},t.prototype.toLower=function(t){return t.replace(" ","_").toLowerCase()},t}()}.call(this),function(){var t,i=[].slice
window.Plotter||(window.Plotter={}),window.Plotter.LinePlot=t=function(){function t(t,e,n){var s,o,r
this.preError="LinePlot.",this.plotter=t,this.initialized=!1,r=[{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,maxBar:null,color:"rgb(41, 128, 185)",band:{minVariable:null,maxVariable:null}}],this.defaults={plotId:null,uuid:"",debug:!0,target:null,width:null,merge:!1,x:{variable:null,format:"%Y-%m-%dT%H:%M:%SZ",min:null,max:null,ticks:7},y:r,zoom:{scale:{min:.05,max:5}},aspectDivisor:5,transitionDuration:500,weight:2,axisColor:"rgb(0,0,0)",font:{weight:100,size:12},crosshairX:{weight:1,color:"rgb(149,165,166)"},requestInterval:336},n.x&&(n.x=this.plotter.lib.mergeDefaults(n.x,this.defaults.x)),n.y[0]=this.plotter.lib.mergeDefaults(n.y[0],this.defaults.y[0]),this.options=this.plotter.lib.mergeDefaults(n,this.defaults),this.device="full",this.transform=d3.zoomIdentity,this.links=[{variable:"battery_voltage",title:"Battery Voltage"},{variable:"temperature",title:"Temperature"},{variable:"relative_humidity",title:"Relative Humidity"},{variable:"precipitation",title:"Precipitation"},{variable:"snow_depth",title:"Snow Depth"},{variable:"wind_direction",title:"Wind Direction"},{variable:"wind_speed_average",title:"Wind Speed"},{variable:"net_solar",title:"Net Solar"},{variable:"solar_pyranometer",title:"Solar Pyranometer"},{variable:"equip_temperature",title:"Equipment Temperature"},{variable:"barometric_pressure",title:"Barometric Pressure"},{variable:"snowfall_24_hour",title:"24-Hr Snowfall"},{variable:"intermittent_snow",title:"Intermittent Snow"}],this.log=function(){var t
t=1<=arguments.length?i.call(arguments,0):[]},this.options.debug&&(this.log=function(){var t
return t=1<=arguments.length?i.call(arguments,0):[],console.log(t)}),this.parseDate=d3.timeParse(this.options.x.format),this.bisectDate=d3.bisector(function(t){return t.x}).left,this.displayDate=d3.timeFormat("%b. %e, %I:%M %p"),this.sortDatetimeAsc=function(t,i){return t.x-i.x},this.data=this.processData(e),this.getDefinition(),this.clipPathId="line-plot-clip-path-"+this.plotter.lib.uuid(),this.bands=[],this.lines=[],this.focusCircle=[],this.focusText=[],this.skipBandDomainSet=!1,o=null,s=null,e.length>0&&(o=this.getDomainScale(this.definition.x),s=this.getDomainMean(this.definition.x)),this.state={range:{data:[],scale:o},length:{data:[]},interval:{data:[]},zoom:1,request:{data:[]},requested:{data:[]},mean:{scale:s}},e[0].length>0&&(this.setDataState(),this.setIntervalState(),this.setDataRequirement())}return t.prototype.processData=function(t){var i,e,n
i=[]
for(n in t)e=t[n],i[n]=this.processDataSet(e,n)
return i},t.prototype.processDataSet=function(t,i){var e,n,s,o,r
n=this.options.y[i],o=[]
for(s in t)r=t[s],o[s]={x:new Date(this.parseDate(r[this.options.x.variable]).getTime()-288e5),y:r[n.variable]},null!=n.band&&(n.band.minVariable&&(o[s].yMin=r[n.band.minVariable]),n.band.maxVariable&&(o[s].yMax=r[n.band.maxVariable]))
return e=new Plotter.Data(o),o=e._clean(e.get()),o.sort(this.sortDatetimeAsc)},t.prototype.setData=function(t){var i,e
if(this.data=[this.processDataSet(t,0)],this.getDefinition(),e=null,i=null,t.length>0&&(e=this.getDomainScale(this.definition.x),i=this.getDomainMean(this.definition.x)),this.state.range.scale=e,this.state.mean.scale=i,t.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.addData=function(t,i){var e,n
if(this.data[i]=this.processDataSet(t,i),this.getDefinition(),n=null,e=null,t.length>0&&(n=this.getDomainScale(this.definition.x),e=this.getDomainMean(this.definition.x)),this.state.range.scale=n,this.state.mean.scale=e,t.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.appendData=function(t,i){var e,n
if(e=this.processDataSet(t,i),n=new window.Plotter.Data(this.data[i]),n.append(e,["x"]),this.data[i]=n._clean(n.get()),this.data[i]=this.data[i].sort(this.sortDatetimeAsc),this.initialized)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.removeData=function(t){if(t>=0&&(delete this.data[t],delete this.options[t],this.svg.select(".line-plot-area-"+t).remove(),this.svg.select(".line-plot-path-"+t).remove(),this.svg.select(".focus-circle-"+t).remove(),this.svg.select(".focus-text-"+t).remove(),this.initialized))return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.setDataState=function(){var t,i,e,n,s
t=this.data.length-1,e=this.data,n=[]
for(i in e)s=e[i],this.state.range.data[i]={min:d3.min(this.data[i],function(t){return t.x}),max:d3.max(this.data[i],function(t){return t.x})},n.push(this.state.length.data[i]=this.data[i].length)
return n},t.prototype.setIntervalState=function(){var t,i,e,n
i=this.data,e=[]
for(t in i)n=i[t],e.push(this.state.interval.data[t]={min:(this.state.range.scale.min.getTime()-this.state.range.data[t].min.getTime())/36e5,max:(this.state.range.data[t].max.getTime()-this.state.range.scale.max.getTime())/36e5})
return e},t.prototype.setDataRequirement=function(){var t,i,e,n,s,o
i=new Date,n=this.data,s=[]
for(e in n)o=n[e],t=this.state.interval.data[e].max<this.options.requestInterval,this.state.request.data[e]={min:this.state.interval.data[e].min<this.options.requestInterval,max:t},null==this.state.requested.data[e]?s.push(this.state.requested.data[e]={min:!1,max:!1}):s.push(void 0)
return s},t.prototype.setZoomState=function(t){return this.state.zoom=t},t.prototype.getDomainScale=function(t){var i
return i={min:t.domain()[0],max:t.domain()[1]}},t.prototype.getDomainMean=function(t){var i
return i=new Date(d3.mean(t.domain())),i.setHours(i.getHours()+Math.round(i.getMinutes()/60)),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),i},t.prototype.setBandDomain=function(t){return this.definition.x1=t},t.prototype.getDefinition=function(){var t,i,e
return e=this.preError+"getDefinition():",t=this,this.definition={},this.calculateChartDims(),this.calculateAxisDims(this.data),this.definition.xAxis=d3.axisBottom().scale(this.definition.x).ticks(Math.round(this.definition.dimensions.width/100)),this.definition.yAxis=d3.axisLeft().scale(this.definition.y).ticks(this.options.y[0].ticks),this.definition.x.domain([this.definition.x.min,this.definition.x.max]),this.skipBandDomainSet||(this.definition.x1.domain(this.data[0].map(function(t){return t.x})),this.skipBandDomainSet=!1),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),i=[[-(1/0),0],[this.definition.x(new Date)+this.definition.dimensions.margin.left,this.definition.dimensions.innerHeight]],this.definition.zoom=d3.zoom().scaleExtent([this.options.zoom.scale.min,this.options.zoom.scale.max]).translateExtent(i).on("zoom",function(){var i
return i=t.setZoomTransform(),t.plotter.i.zoom.set(i)}),this.definition.line=d3.line().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(i){return t.definition.x(i.x)}).y(function(i){return t.definition.y(i.y)}),this.definition.area=d3.area().defined(function(t){return!isNaN(t.yMin)&&null!==t.yMin&&!isNaN(t.yMax)&&null!==t.yMax}).x(function(i){return t.definition.x(i.x)}).y0(function(i){return t.definition.y(i.yMin)}).y1(function(i){return t.definition.y(i.yMax)})},t.prototype.calculateChartDims=function(){var t,i,e,n
return n=null!=this.options.width?Math.round(this.options.width):Math.round($(this.options.target).width())-24,i=Math.round(n/this.options.aspectDivisor),n>1e3?e={top:Math.round(.04*i),right:Math.round(Math.pow(n,.3)),bottom:Math.round(.12*i),left:Math.round(Math.pow(n,.6))}:n>600?(this.device="mid",this.options.font.size=this.options.font.size/1.25,t=this.options.aspectDivisor/1.25,i=Math.round(n/t),e={top:Math.round(.04*i),right:Math.round(Math.pow(n,.3)),bottom:Math.round(.14*i),left:Math.round(Math.pow(n,.6))}):(this.device="small",this.options.font.size=this.options.font.size/1.5,t=this.options.aspectDivisor/1.5,i=Math.round(n/t),e={top:Math.round(.04*i),right:Math.round(Math.pow(n,.3)),bottom:Math.round(.18*i),left:Math.round(Math.pow(n,.6))}),this.definition.dimensions={width:n,height:i,margin:e},this.definition.dimensions.topPadding=parseInt(this.definition.dimensions.margin.top),this.definition.dimensions.bottomPadding=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom),this.definition.dimensions.leftPadding=parseInt(this.definition.dimensions.margin.left),this.definition.dimensions.innerHeight=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom-this.definition.dimensions.margin.top),this.definition.dimensions.innerWidth=parseInt(this.definition.dimensions.width-this.definition.dimensions.margin.left-this.definition.dimensions.margin.right),this.definition.x=d3.scaleTime().range([e.left,n-e.right]),this.definition.x1=d3.scaleBand().rangeRound([e.left,n-e.right],.05).padding(.1),this.definition.y=d3.scaleLinear().range([i-e.bottom,e.top])},t.prototype.calculateAxisDims=function(t){return this.calculateXAxisDims(t),this.calculateYAxisDims(t)},t.prototype.calculateXAxisDims=function(t){return null===this.options.x.min?this.definition.x.min=d3.min(t[0],function(t){return t.x}):this.definition.x.min=this.parseDate(this.options.x.min),null===this.options.x.max?this.definition.x.max=d3.max(t[0],function(t){return t.x}):this.definition.x.max=this.parseDate(this.options.x.max)},t.prototype.calculateYAxisDims=function(t){var i,e,n,s
this.definition.y.min=0,this.definition.y.max=0
for(s in t)n=t[s],e=d3.min([d3.min(n,function(t){return t.y}),d3.min(n,function(t){return t.yMin})]),i=d3.max([d3.max(n,function(t){return t.y}),d3.max(n,function(t){return t.yMax})]),(e<this.definition.y.min||void 0===this.definition.y.min)&&(this.definition.y.min=e),(i>this.definition.y.max||void 0===this.definition.y.max)&&(this.definition.y.max=i)
if(this.definition.y.min===this.definition.y.max&&(this.definition.y.min=.8*this.definition.y.min,this.definition.y.max=1.2*this.definition.y.min),null!=this.options.y[0].min&&(this.definition.y.min=this.options.y[0].min),null!=this.options.y[0].max)return this.definition.y.max=this.options.y[0].max},t.prototype.preAppend=function(){var t,i
return i=this.preError+"preAppend()",t=this,this.outer=d3.select(this.options.target).append("div").attr("class","line-plot-body").style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px").style("display","inline-block"),this.ctls=d3.select(this.options.target).append("div").attr("class","plot-controls").style("width","23px").style("height",this.definition.dimensions.height+"px").style("display","inline-block").style("vertical-align","top"),this.svg=this.outer.append("svg").attr("class","line-plot").attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.append("defs").append("clipPath").attr("id",this.clipPathId).append("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.append("g").attr("class","line-plot-axis-x").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.append("g").attr("class","line-plot-axis-y").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)")},t.prototype.append=function(){var t,i,e,n,s,o,r,a,l
if(this.initialized=!0,this.initialized){o=this.preError+"append()",t=this,this.svg.select(".line-plot-axis-x").call(this.definition.xAxis),this.svg.select(".line-plot-axis-y").call(this.definition.yAxis),e=""+this.options.y[0].title,this.options.y[0].units&&(e=e+" "+this.options.y[0].units),n=-15,i=-52,"small"===this.device&&(n=-10,i=-30),this.svg.select(".line-plot-axis-y").append("text").text(e).attr("class","line-plot-y-label").attr("x",n).attr("y",i).attr("dy",".75em").attr("transform","rotate(-90)").style("font-size",this.options.font.size).style("font-weight",this.options.font.weight),this.lineWrapper=this.svg.append("g").attr("class","line-wrapper"),r=this.data
for(s in r)l=r[s],this.bands[s]=this.lineWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").append("path").datum(l).attr("d",this.definition.area).attr("class","line-plot-area-"+s).style("fill",this.options.y[s].color).style("opacity",.15).style("stroke",function(){return d3.color(t.options.y[s].color).darker(1)}),this.lines[s]=this.lineWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").append("path").datum(l).attr("d",this.definition.line).attr("class","line-plot-path-"+s).style("stroke",this.options.y[s].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none")
null!=this.options.y[0].maxBar&&this.lineWrapper.append("rect").attr("class","line-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(this.options.y[0].maxBar)).attr("width",this.definition.dimensions.innerWidth).attr("height",1).style("color","#gggggg").style("opacity",.4),this.hoverWrapper=this.svg.append("g").attr("class","hover-wrapper"),this.crosshairs=this.hoverWrapper.append("g").attr("class","crosshair"),this.crosshairs.append("line").attr("class","crosshair-x").style("stroke",this.options.crosshairX.color).style("stroke-width",this.options.crosshairX.weight).style("stroke-dasharray","3, 3").style("fill","none"),this.crosshairs.append("rect").attr("class","crosshair-x-under").style("fill","rgb(255,255,255)").style("opacity",.1),this.focusDateText=this.hoverWrapper.append("text").attr("class","focus-date-text").attr("x",9).attr("y",7).style("display","none").style("fill","#000000").style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),a=this.data
for(s in a)l=a[s],this.focusCircle[s]=this.hoverWrapper.append("circle").attr("r",4).attr("class","focus-circle-"+s).attr("fill",this.options.y[s].color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText[s]=this.hoverWrapper.append("text").attr("class","focus-text-"+s).attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y[s].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)")
return this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(this.transform),this.appendZoomTarget(this.transform)}},t.prototype.update=function(){var t,i,e,n,s,o
e=this.preError+"update()",t=this,n=this.data
for(i in n)o=n[i],null!=o&&null!=t.options.y[i]&&(null===this.svg.select(".line-plot-area-"+i).node()?this.bands[i]=this.lineWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").append("path").datum(o).attr("d",this.definition.area).attr("class","line-plot-area-"+i).style("fill",this.options.y[i].color).style("opacity",.15).style("stroke",function(){return d3.color(t.options.y[i].color).darker(1)}):this.svg.select(".line-plot-area-"+i).datum(o).attr("d",this.definition.area).style("fill",this.options.y[i].color).style("stroke",function(){return d3.rgb(t.options.y[i].color).darker(1)}),null===this.svg.select(".line-plot-path-"+i).node()?(this.lines[i]=this.lineWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").append("path").datum(o).attr("d",this.definition.line).attr("class","line-plot-path-"+i).style("stroke",this.options.y[i].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.focusCircle[i]=this.hoverWrapper.append("circle").attr("r",4).attr("class","focus-circle-"+i).attr("fill",this.options.y[i].color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText[i]=this.hoverWrapper.append("text").attr("class","focus-text-"+i).attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y[i].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)")):this.svg.select(".line-plot-path-"+i).datum(o).attr("d",this.definition.line).style("stroke",this.options.y[i].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"))
this.overlay.remove(),this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(this.transform),this.appendZoomTarget(this.transform),this.calculateYAxisDims(this.data),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),s=this.data
for(i in s)o=s[i],this.svg.select(".line-plot-area-"+i).datum(o).attr("d",this.definition.area),this.svg.select(".line-plot-path-"+i).datum(o).attr("d",this.definition.line)
return this.svg.select(".line-plot-axis-y").call(this.definition.yAxis),null!=this.options.y[0].maxBar&&this.lineWrapper.select(".line-plot-max-bar").attr("y",this.definition.y(this.options.y[0].maxBar)),this.setZoomTransform(this.transform)},t.prototype.appendCrosshairTarget=function(t){var i,e
if(this.initialized)return e=this.preError+"appendCrosshairTarget()",i=this,this.overlay.datum(this.data).attr("class","overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").on("mouseover",function(){return i.plotter.i.crosshairs.show()}).on("mouseout",function(){return i.plotter.i.crosshairs.hide()}).on("mousemove",function(){var e
return e=i.setCrosshair(t),i.plotter.i.crosshairs.set(t,e)})},t.prototype.appendZoomTarget=function(t){var i,e
if(this.initialized)return e=this.preError+"appendZoomTarget()",i=this,this.overlay.attr("class","zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").style("cursor","move"),this.svg.call(this.definition.zoom,t)},t.prototype.setZoomTransform=function(t){var i,e,n,s,o,r,a
if(this.initialized){o=this.preError+".setZoomTransform(transform)",i=this,null!=t?this.transform=t:null!=d3.event&&(this.transform=d3.event.transform),n=this.transform,e=n.rescaleX(this.definition.x),this.svg.select(".line-plot-axis-x").call(this.definition.xAxis.scale(e)),this.state.range.scale=this.getDomainScale(e),this.state.mean.scale=this.getDomainMean(e),this.setDataState(),this.setIntervalState(),this.setDataRequirement(),this.setZoomState(n.k),this.definition.area=d3.area().defined(function(t){return!isNaN(t.yMin)&&null!==t.yMin&&!isNaN(t.yMax)&&null!==t.yMax}).x(function(t){return n.applyX(i.definition.x(t.x))}).y0(function(t){return i.definition.y(t.yMin)}).y1(function(t){return i.definition.y(t.yMax)}),this.definition.line=d3.line().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(t){return n.applyX(i.definition.x(t.x))}).y(function(t){return i.definition.y(t.y)}),r=this.data
for(s in r)a=r[s],this.svg.select(".line-plot-area-"+s).attr("d",this.definition.area),this.svg.select(".line-plot-path-"+s).attr("d",this.definition.line)
return this.appendCrosshairTarget(n),n}},t.prototype.setCrosshair=function(t,i){var e,n,s,o,r,a,l,p,h,d,u,c,f,m,g,y,x
if(this.initialized){m=this.preError+".setCrosshair(mouse)",e=this,o=this.definition.dimensions,p=function(t){switch(!1){case!(t>360||t<0):return"INV"
case!(t>=0&&t<11.25):return"N"
case!(t>=11.25&&t<33.75):return"NNE"
case!(t>=33.75&&t<56.25):return"NE"
case!(t>=56.25&&t<78.75):return"ENE"
case!(t>=78.75&&t<101.25):return"E"
case!(t>=101.25&&t<123.75):return"ESE"
case!(t>=123.75&&t<146.25):return"SE"
case!(t>=146.25&&t<168.75):return"SSE"
case!(t>=168.75&&t<191.25):return"S"
case!(t>=191.25&&t<213.75):return"SSW"
case!(t>=213.75&&t<236.25):return"SW"
case!(t>=236.25&&t<258.75):return"WSW"
case!(t>=258.75&&t<281.25):return"W"
case!(t>=281.25&&t<303.75):return"WNW"
case!(t>=303.75&&t<326.25):return"NW"
case!(t>=326.25&&t<348.75):return"NNW"
case!(t>=348.75&&t<=360):return"N"}},g=this.data
for(f in g)y=g[f],r=this.overlay.node(),s=y,i=i?i:d3.mouse(r),x=this.definition.x.invert(i[0]+o.leftPadding),t&&(x=this.definition.x.invert(t.invertX(i[0]+o.leftPadding))),c=e.bisectDate(s,x,1),u=x.getMinutes()>=30?c:c-1,x.getTime()<=this.state.range.data[f].min.getTime()&&(u=c),x.getTime()>=this.state.range.data[f].max.getTime()&&(u=c-1),null!=s[u]&&(h=t?t.applyX(this.definition.x(s[u].x)):this.definition.x(s[u].x),d=[],a=[],null!==this.options.y[f].variable&&(a[f]=s[u],null!=a[f]&&(d[f]=this.definition.y(a[f].y),n=this.displayDate(a[f].x),isNaN(d[f])||null==a[f].y||this.focusCircle[f].attr("transform","translate(0, 0)"))),l=h-o.leftPadding,l>=0&&(this.crosshairs.select(".crosshair-x").attr("x1",l).attr("y1",o.topPadding).attr("x2",l).attr("y2",o.innerHeight+o.topPadding).attr("transform","translate("+o.leftPadding+", 0)"),this.crosshairs.select(".crosshair-x-under").attr("x",l).attr("y",o.topPadding).attr("width",o.innerWidth-l).attr("height",o.innerHeight).attr("transform","translate("+o.leftPadding+", 0)"),this.focusDateText.attr("x",l-120).attr("y",o.topPadding+o.innerHeight-3).attr("transform","translate("+o.leftPadding+", 0)").text(n),null===this.options.y[f].variable||isNaN(d[f])||null==a[f].y||(this.focusCircle[f].attr("cx",h).attr("cy",d[f]),this.focusText[f].attr("x",h+o.leftPadding/10).attr("y",d[f]-o.topPadding/10).text(a[f].y?"wind_direction"===e.options.y[0].variable?p(a[f].y):a[f].y.toFixed(1)+" "+this.options.y[f].units:void 0))))
return i}},t.prototype.showCrosshair=function(){var t,i,e,n
if(this.initialized){this.crosshairs.select(".crosshair-x").style("display",null),this.crosshairs.select(".crosshair-x-under").style("display",null),this.focusDateText.style("display",null),t=this.options.y,i=[]
for(n in t)e=t[n],null!==e.variable?(null!=this.focusCircle[n]&&this.focusCircle[n].style("display",null).attr("fill",e.color),null!=this.focusText[n]?i.push(this.focusText[n].style("display",null).style("color",e.color).style("fill",e.color)):i.push(void 0)):i.push(void 0)
return i}},t.prototype.hideCrosshair=function(){var t,i,e,n
if(this.initialized){this.crosshairs.select(".crosshair-x").style("display","none"),this.crosshairs.select(".crosshair-x-under").style("display","none"),this.focusDateText.style("display","none"),t=this.options.y,i=[]
for(n in t)e=t[n],null!==e.variable?(null!=this.focusCircle[n]&&this.focusCircle[n].style("display","none"),null!=this.focusText[n]?i.push(this.focusText[n].style("display","none")):i.push(void 0)):i.push(void 0)
return i}},t.prototype.appendTitle=function(t,i){var e,n,s
if(n=1,e="16px",s="12px","small"===this.device&&(n=.4,e="10px",s="7px"),this.title=this.svg.append("g").attr("class","line-plot-title"),this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2-4*n).style("font-size",e).style("font-weight",600).text(t),i)return this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2+12*n).style("font-size",s).text(i)},t.prototype.getState=function(){return this.state},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.LiveSync=t=function(){function t(t){this.preError="Plotter.LiveSync",this.plotter=t,this.api=this.plotter.i.api,this.requests={},this.endpoint=function(){return this.plotter.options.href+"/api/v5/measurement"}}return t.prototype.append=function(t,i,e){var n,s,o,r,a,l,p,h,d
return n=new Date,o=n.getTimezoneOffset()/60,s=new Date(n.getTime()-36e5*(8-o)),e.range.data[i].max>=s||(l=this.plotter.options.updateLength,a=e.range.data[i].max.getTime(),h=new Date(a+36e5*this.plotter.options.updateLength),h>s&&(l=Math.round((h.getTime()-s.getTime())/36e5)),p=this.plotter.lib.format(new Date(h)),l<this.plotter.options.minUpdateLength||(r=this.plotter.i.template.forSync(t,i,p,l),d=this.plotter.lib.uuid(),this.requests[d]={ready:!1,requested:!1},this.requests[d].requested=this.get(t,i,d,r,"max")))},t.prototype.prepend=function(t,i,e){var n,s,o,r
return o=this.plotter.lib.format(e.range.data[i].min),s=this.plotter.options.updateLength,n=this.plotter.i.template.forSync(t,i,o,s),r=this.plotter.lib.uuid(),this.requests[r]={ready:!1,requested:!1},this.requests[r].requested=this.get(t,i,r,n,"min")},t.prototype.add=function(t,i,e){var n,s,o,r,a
return n=new Date,e.range.data[0].max>=n||(r=this.plotter.lib.format(e.range.data[0].max),o=e.length.data[0],s=this.plotter.i.template.forSync(t,i,r,o),a=this.plotter.lib.uuid(),this.requests[a]={ready:!1,requested:!1},this.requests[a].requested=this.getNew(t,i,a,s))},t.prototype.get=function(t,i,e,n,s){var o,r,a,l
return a=this.preError+".get()",l=this.endpoint(),o=this,r=function(n){var r,l
if(r=o.plotter.plots[t].proto,null==n.responseJSON)throw new Error(a+" error requesting data.")
if(l=n.responseJSON.results,void 0===o.plotter.plots[t].__data__)throw new Error(a+" appending to empty data set.")
if(0===n.responseJSON.results.length)throw new Error(a+" no new data found.")
return r.appendData(l,i),r.update(),o.requests[e].ready=!0,r.state.requested.data[i][s]=!1,o.plotter.updates=o.plotter.updates<0?0:o.plotter.updates-1},this.api.get(l,n,r),!0},t.prototype.getNew=function(t,i,e,n){var s,o,r,a
return r=this.preError+".getNew()",a=this.endpoint(),s=this,o=function(n){var o,a
if(o=s.plotter.plots[t].proto,null==n.responseJSON)throw new Error(r+" error requesting data.")
if(a=n.responseJSON.results,void 0===s.plotter.plots[t].__data__)throw new Error(r+" appending to empty data set.")
if(0===n.responseJSON.results.length)throw new Error(r+" no new data found.")
return o.addData(a,i),o.update(),s.requests[e].ready=!0,s.plotter.i.controls.removeSpinner(t),s.plotter.updates=s.plotter.updates<0?0:s.plotter.updates-1},this.api.get(a,n,o),!0},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Now=t=function(){function t(t,i){return this.parse=function(i){var e,n
return i.indexOf("now")>=0&&(n=new Date,i.indexOf("(")>=0&&(e=parseInt(i.replace("(","").replace(")","").replace("now","")),n=new Date(n.getTime()+36e5*e)),i=t(n)),i},this.datetime=this.parse(i),this.datetime}return t.prototype.set=function(t){return this.datetime=this.parse(t),!0},t.prototype.get=function(){return this.datetime},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Handler=t=function(){function t(t,i,e){var n,s,o,r,a,l
this.preError="Plotter.Handler",o=i.dateFormat?i.dateFormat:"%Y-%m-%dT%H:%M:%SZ",r={dateFormat:o},this.lib=new window.Plotter.Library(r),s=location.origin.indexOf(":5000")>=0?"http://dev.nwac.us":location.origin,l={templateId:null,uuid:null,localId:this.lib.uuid(),href:s,target:null,dateFormat:"%Y-%m-%dT%H:%M:%SZ",refresh:500,futureWait:18e4,updateLength:168,initialLength:504,requestPaddingInterval:336,newDataInterval:168,minUpdateLength:0,updateLimit:6,width:null},this.options=this.lib.mergeDefaults(i,l),this.waitCounter=parseInt(this.options.futureWait/this.options.refresh),this.refreshCounter=0,n={token:null,csrfToken:null,admin:!1},a=this.lib.mergeDefaults(t,n),this.isAdmin=function(){return a.admin},this.i={api:new window.Plotter.API(a),sapi:new window.Plotter.API(a,!1)},this.i.template=new window.Plotter.Template(this),this.i.controls=new window.Plotter.Controls(this),this.i.initialsync=new window.Plotter.InitialSync(this),this.i.livesync=new window.Plotter.LiveSync(this),this.i.zoom=new window.Plotter.Zoom(this),this.i.crosshairs=new window.Plotter.Crosshairs(this),this.i.specs=new window.Plotter.Specs,this.i.colors=new window.Plotter.Colors,this.plots=[],this.legends=[],this.updates=0,this.bandDomain=null,this.isReady=function(){return this.updates<=this.options.updateLimit}}return t.prototype.initialize=function(){var t,i
return this.i.template.get(),this.appendLoading(),this.initializePlots(),this.i.initialsync.stageAll(),t=this,(i=function(){return t.i.initialsync.isReady()?(t.append(),t.removeLoading(),t.listen()):(setTimeout(i,100),!0)})()},t.prototype.initializePlots=function(){var t,i,e,n,s
i=this.i.template.full(),n=[]
for(e in i)s=i[e],t={proto:null,__data__:[]},n.push(this.plots[e]=t)
return n},t.prototype.listen=function(t){var i,e,n,s,o,r,a,l
this.refreshCounter++,o=this.plots
for(s in o)if(n=o[s],null!=n&&n.proto.initialized){l=n.proto.getState(),r=l.request.data
for(e in r)a=r[e],a.min===!0&&this.isReady()&&n.proto.state.requested.data[e].min===!1&&(this.updates++,n.proto.state.requested.data[e].min=!0,this.i.livesync.prepend(s,e,l)),i=new Date,(this.refreshCounter%this.waitCounter===0||n.proto.state.range.data[0].max.getTime()<i.getTime()-36e5*this.options.newDataInterval)&&a.max===!0&&this.isReady()&&n.proto.state.requested.data[e].max===!1&&(this.updates++,n.proto.state.requested.data[e].max=!0,this.i.livesync.append(s,e,l))}if(!t)return setTimeout(Plotter.Handler.prototype.listen.bind(this),this.options.refresh)},t.prototype.append=function(){var t,i,e,n,s
t=this,n=this.plots
for(e in n)s=n[e],s.uuid=this.lib.uuid(),$(this.options.target).append('<div id="outer-'+s.uuid+'"></div>'),i=this.i.template.forPlots(e),i=this.i.colors.getInitial(i),i.target="#outer-"+s.uuid,i.requestInterval=this.options.requestPaddingInterval,i.uuid=s.uuid,null!=this.options.width&&(i.width=this.options.width),"bar"===i.plotType?s.proto=new window.Plotter.BarPlot(this,s.__data__,i):s.proto=new window.Plotter.LinePlot(this,s.__data__,i),s.proto.preAppend(),s.proto.append(),this.i.controls.append(e),this.legends[e]=new window.Plotter.Legend(this,e)
return this.bandDomain=this.plots[0].proto.definition.x1,this.appendSave()},t.prototype.appendLoading=function(){return $(this.options.target).append('<div class="plotter-loading" style="text-align: center; "> <span> <i class="icon-spinner icon-spin icon-large"></i> Loading Plots... </span> </div>')},t.prototype.removeLoading=function(){return $(this.options.target).find(".plotter-loading").remove()},t.prototype.remove=function(t){return $(this.plots[t].proto.options.target).fadeOut(500,function(){return $(this).remove()}),this.i.template.removePlot(t),delete this.plots[t]},t.prototype.move=function(t,i){var e,n,s,o,r,a
if(o=this.i.template.template,n=o[t],e=n.pageOrder,a=$(this.plots[t].proto.options.target),"up"===i){if(e>1)return r=this.lib.indexOfValue(o,"pageOrder",e-1),s=o[r],n.pageOrder--,s.pageOrder++,a.prev().insertAfter(a)}else if("down"===i&&e<o.length)return r=this.lib.indexOfValue(o,"pageOrder",e+1),s=o[r],n.pageOrder++,s.pageOrder--,a.next().insertBefore(a)},t.prototype.add=function(t,i){var e,n,s,o,r,a,l,p,h,d,u,c
for(c=this.lib.uuid(),o="outer-"+c,h={pageOrder:this.i.template.plotCount()+1,type:t,target:"#"+o,requestInterval:this.options.requestPaddingInterval,y:[]},a='<div id="'+o+'"></div>',$(this.options.target).append(a),e=this.i.template.add(h),this.plots[e]={},n=this.i.specs.getPlotType(i),"precipitation_line"===i&&(i="precipitation",n="line"),"bar"===n?this.plots[e].proto=new window.Plotter.BarPlot(this,[[]],h):this.plots[e].proto=new window.Plotter.LinePlot(this,[[]],h),this.plots[e].proto.preAppend(),this.plots[e].proto.options.plotType=n,this.plots[e].proto.options.plotId=e,this.plots[e].proto.options.uuid=c,this.appendSave(),r=this.i.specs.getOptions(i,null),d=this.i.template.template,l=0,p=d.length;l<p;l++)if(u=d[l],void 0!==u){this.i.template.template[e].x=$.extend(!0,{},u.x)
break}return this.i.template.template[e].y=[r],s=this.i.template.forPlots(e),this.plots[e].proto.options.x=s.x,this.plots[e].proto.options.y=s.y,this.i.controls.append(e)},t.prototype.addStation=function(t,i){var e,n,s,o
return this.plots[t].proto.initialized?"bar"===this.plots[t].proto.options.plotType?(this.i.controls.removeSpinner(t),alert("Bar plots only support one station. Please add a new Precipitation Line Plot to view multiple stations."),!1):(e=this.plots[t].proto.getState(),o=e.range.data[0].max.getTime(),n=$.extend(!0,{},this.plots[t].proto.options.y[0]),n.dataLoggerId=i,n.color=this.i.colors.get(i),s=this.plots[t].proto.options.y.push(n)-1,this.i.controls.updateStationDropdown(t),this.i.controls.updateStationMap(t),this.i.livesync.add(t,s,e),!0):(this.plots[t].proto.options.y[0].dataLoggerId=i,this.plots[t].proto.options.y[0].color=this.i.colors.get(i),this.i.initialsync.add(t),this.i.controls.updateStationDropdown(t),this.i.controls.updateStationMap(t),!0)},t.prototype.removeStation=function(t,i){var e
return e=this.lib.indexOfValue(this.plots[t].proto.options.y,"dataLoggerId",i),e>0&&(delete this.i.template.template[t].y[e],this.plots[t].proto.removeData(e),this.plots[t].proto.getDefinition(),this.plots[t].proto.update(),this.i.controls.updateStationDropdown(t),this.i.controls.updateStationMap(t)),this.i.controls.removeSpinner(t)},t.prototype.appendSave=function(){var t
if(t=this,$("#save-"+this.options.localId).parent().remove(),this.isAdmin()||null!=this.options.uuid)return $(this.options.target).prepend('<small><a style="cursor:pointer" id="save-'+this.options.localId+'">Save Graph</a></small>'),$("#save-"+this.options.localId).on("click",function(i){var e
return e=": Last Saved: "+t.lib.getNowDisplay(),"Save Graph"===$("#save-"+t.options.localId).html()?this.append(e):$("#save-"+t.options.localId).html("Save Graph"+e),t.i.template.put()})},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Specs=t=function(){function t(){}return t.prototype.getOptions=function(t,i){var e,n,s
return e=this.getVariableBounds(t),n=this.getVariableInfo(t),s={dataLoggerId:i,variable:t,plotType:this.getPlotType(t),min:e.min,max:e.max,maxBar:e.maxBar,title:n.title,units:n.units}},t.prototype.getVariableBounds=function(t){var i
return i={battery_voltage:{min:8,max:16,maxBar:null},temperature:{min:null,max:null,maxBar:32},equip_temperature:{min:null,max:null,maxBar:null},relative_humidity:{min:0,max:100,maxBar:null},net_solar:{min:0,max:800,maxBar:null},snow_depth:{min:0,max:150,maxBar:null},snowfall_24_hour:{min:0,max:24,maxBar:null},intermittent_snow:{min:0,max:null,maxBar:null},wind_direction:{min:0,max:350,maxBar:null},precipitation:{min:0,max:.35,maxBar:null},wind_speed_average:{min:0,max:null,maxBar:null},solar_pyranometer:{min:0,max:null,maxBar:null},barometric_pressure:{min:950,max:1050,maxBar:null}},i[t]},t.prototype.getVariableInfo=function(t){var i
return i={battery_voltage:{title:"Battery Voltage",units:"V"},net_solar:{title:"Solar Radiation",units:"W/m2"},solar_pyranometer:{title:"Solar Pyranometer",units:"W/m2"},relative_humidity:{title:"Relative Humidity",units:"%"},barometric_pressure:{title:"Barometric Pressure",units:"mb"},snow_depth:{title:"Snow Depth",units:'"'},snowfall_24_hour:{title:"24-Hour Snowfall",units:'"'},intermittent_snow:{title:"Intermittent Snow",units:'"'},wind_direction:{title:"Wind Direction",units:""},precipitation:{title:"Precipitation",units:'"'},temperature:{title:"Temperature",units:"F"},equip_temperature:{title:"Equipment Temperature",units:"F"},wind_speed_average:{title:"Wind Speed",units:"mph"}},i[t]},t.prototype.getPlotType=function(t){switch(t){case"precipitation":return"bar"
default:return"line"}},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Template=t=function(){function t(t){this.preError="Plotter.Template.",this.plotter=t,this.api=this.plotter.i.api,this.sapi=this.plotter.i.sapi,this.template=null,this.dataSets=0,this.isValid=function(t){var i,e,n,s,o,r,a
for(i=0,n=t.length;i<n;i++)if(r=t[i],null!=r&&r===!1){if(void 0===r.type)return!1
if(void 0===r.x)return!1
if(void 0===r.y)return!1
if(void 0===r.x.variable)return!1
if(void 0===r.x.min)return!1
if(void 0===r.x.max)return!1
if(void 0===r.y[0])return!1
for(o=r.y,e=0,s=o.length;e<s;e++){if(a=o[e],void 0===a.dataLoggerId)return!1
if(void 0===a.variable)return!1
if(void 0===a.title)return!1
if(void 0===a.units)return!1}}return!0},this.newIsValid=function(t){var i,e,n
for(i=0,e=t.length;i<e;i++)if(n=t[i],null!=n&&void 0===n.type)return!1
return!0},this.parse=function(t){var i,e,n,s,o,r
if(i=JSON.parse(t).templateData,this.isValid(i)){for(o=!1,n=e=s=i.length-1;s<=0?e<=0:e>=0;n=s<=0?++e:--e)r=i[n],null!=r?(r.x.min=new window.Plotter.Now(this.plotter.lib.format,r.x.min).get(),r.x.max=new window.Plotter.Now(this.plotter.lib.format,r.x.max).get()):(o=!0,i.splice(n,1))
return i.sort(function(t,i){return t.pageOrder-i.pageOrder}),i=this.resetPageOrder(i)}throw new Error("Plotter template format is invalid. Reference a working example.")},this.stringify=function(){var t
return t={templateData:this.template},JSON.stringify(t)},this.endpoint=function(){return this.plotter.options.href+"/api/v5/plothandler/"}}return t.prototype.get=function(){var t,i,e,n,s
return n=this.preError+"get()",s=this.endpoint()+this.plotter.options.templateId,i=null,t=this,e=function(i){if(null===i.responseJSON||i.responseJSON.error)throw new Error(n+".callback(data) error retrieving template.")
return t.template=t.parse(i.responseJSON.template_data),t.template.sort(function(t,i){return t.pageOrder-i.pageOrder})},this.sapi.get(s,i,e)},t.prototype.put=function(){var t,i,e,n,s
if(n=this.preError+"put()",!this.plotter.isAdmin()&&null==this.plotter.options.uuid)throw new Error(n+", not authorized for PUT requests.")
return s=this.endpoint()+(""+this.plotter.options.templateId),i={template_data:this.stringify(this.template)},t=this,e=function(t){return console.log("Template PUT completed (data)",t)},this.api.put(s,i,e)},t.prototype.add=function(t){var i,e,n
return n=this.preError+"add(options)",e=this.template.push(t)-1,i=function(){if(!this.newIsValid(this.template))throw new Error(n+" template invalid after adding new plot.")}.call(this),e},t.prototype.plotCount=function(){return this.template.length},t.prototype.dataSetCount=function(t){return this.template[t].y.length},t.prototype.full=function(){return this.template},t.prototype.forSync=function(t,i,e,n){var s,o
return s=null,null!=this.template[t].y[i]&&(s=this.template[t].y[i].dataLoggerId),o={data_logger:s,max_datetime:e,limit:n}},t.prototype.forControls=function(){},t.prototype.forPlots=function(t){var i,e,n,s,o,r,a
for(n=this.template[t].x,s=this.template[t].y,o=0,r=s.length;o<r;o++)i=s[o],"wind_speed_average"===i.variable&&(i.band={minVariable:"wind_speed_minimum",maxVariable:"wind_speed_maximum"})
return e="line",void 0!==this.template[t].plotType&&(e=this.template[t].plotType),a={plotId:t,plotType:e,x:n,y:s}},t.prototype.removePlot=function(t){return delete this.template[t]},t.prototype.resetPageOrder=function(t){var i,e
for(i in t)e=t[i],e.pageOrder=parseInt(i)+1
return t},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Zoom=t=function(){function t(t){this.preError="Plotter.Zoom.",this.plotter=t}return t.prototype.set=function(t){var i,e,n,s,o
for(s=this.plotter.plots,o=[],i=0,e=s.length;i<e;i++)n=s[i],null!=n?o.push(n.proto.setZoomTransform(t)):o.push(void 0)
return o},t}()}.call(this)
