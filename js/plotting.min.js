(function(){window.Plotter||(window.Plotter={}),window.Plotter.API=function(){function a(a,b){var c;this.preError="Plotter.API",c=this.preError+".constructor()",this.async=!0,void 0!==b&&(this.async=b),this.getAccessToken=function(){return a.token},this.getAccessTokenValue=function(){if(void 0===a.token)throw new Error(c+" Access token is not defined.");return"Token "+a.token},this.getCSRFToken=function(){if(void 0===a.csrfToken)throw new Error(c+" CSRF token is not defined.");return a.csrfToken}}return a.prototype.build=function(){var a,b,c;if(b=this.preError+".build()",c=null,XMLHttpRequest)c=new XMLHttpRequest;else try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(d){a=d;try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=c,console.error(b,"Cannot specify XMLHTTPRequest (error)",a)}}return c},a.prototype.get=function(a,b,c){var d,e,f;e=this.preError+".get(uri, params, callback)",f=this.build(),void 0!==c&&(f.onreadystatechange=function(){var a;if(4===f.readyState){if(200!==f.status&&304!==f.status)return console.log(e+" HTTP error, (status): "+f.status),void(f=null);a={response:f.response,responseText:f.responseText,responseJSON:null};try{a.responseJSON=JSON.parse(a.responseText)}catch(b){b,a.responseJSON=null}return c(a)}}),b=this.encodeArgs("GET",b);try{f.open("GET",a+b,this.async),f.setRequestHeader("Authorization",this.getAccessTokenValue()),f.send(null)}catch(a){throw d=a,new Error(e+", "+d)}},a.prototype.put=function(a,b,c){var d,e,f;e=this.preError+".put(uri, params, callback)",f=this.build(),void 0!==c&&(f.onreadystatechange=function(){var a;if(4===f.readyState){if(200!==f.status&&304!==f.status)return console.log(e+" HTTP error, (status): "+f.status),void(f=null);a={response:f.response,responseText:f.responseText,responseJSON:null};try{a.responseJSON=JSON.parse(a.responseText)}catch(b){b,a.responseJSON=null}return c(a)}}),b=this.encodeArgs("PUT",b);try{f.open("PUT",a,this.async),f.setRequestHeader("Authorization",this.getAccessToken()),f.setRequestHeader("X-CSRFToken",this.getCSRFToken()),f.setRequestHeader("Content-Type","application/json;charset=UTF-8"),f.send(b)}catch(a){d=a,console.log(e+"catch(error).",d)}},a.prototype.post=function(a,b,c){var d,e,f;e=this.preError+".post(uri, params, callback)",f=build(),void 0!==c&&(f.onreadystatechange=function(){var a;if(4===f.readyState){if(200!==f.status&&304!==f.status)return console.log(e+" HTTP error, (status): "+f.status),void(f=null);a={response:f.response,responseText:f.responseText,responseJSON:null};try{a.responseJSON=JSON.parse(a.responseText)}catch(b){b,a.responseJSON=null}return c(a)}}),b=this.encodeArgs("POST",b);try{f.open("POST",a,this.async),f.setRequestHeader("Authorization",this.getAccessToken()),f.setRequestHeader("Content-Type","application/json;charset=UTF-8"),f.send(b)}catch(a){d=a,console.log(e+"catch(error).",d)}},a.prototype.delete=function(a,b,c){var d,e,f;e=this.preError+".delete(uri, params, callback)",f=this.build(),void 0!==c&&(f.onreadystatechange=function(){var a;if(4===f.readyState){if(200!==f.status&&304!==f.status)return console.log(e+" HTTP error, (status): "+f.status),void(f=null);a={response:f.response,responseText:f.responseText,responseJSON:null};try{a.responseJSON=JSON.parse(a.responseText)}catch(b){b,a.responseJSON=null}return c(a)}}),b=this.encodeArgs("DELETE",b);try{f.open("DELETE",a,this.async),f.setRequestHeader("Authorization",this.getAccessToken()),f.setRequestHeader("Content-Type","application/json;charset=UTF-8"),f.send(b)}catch(a){d=a,console.log(e+"catch(error).",d)}},a.prototype.encodeArgs=function(a,b){var c,d,e,f,g;if(g=this.preError+"encodeArgs(type, json_args)",d="",c=0,"string"==typeof b)try{b=JSON.parse(b)}catch(a){f=a,console.log(g+"catch(error).",f)}if("POST"===a||"PUT"===a)d=JSON.stringify(b);else if("GET"===a)for(e in b)d=0===c?"?"+e+"="+b[e]:d+"&"+e+"="+b[e],c++;return d},a}()}).call(this),function(){var a=[].slice;window.Plotter||(window.Plotter={}),window.Plotter.BarPlot=function(){function b(b,c,d){var e,f,g;this.preError="BarPlot.",this.plotter=b,this.initialized=!1,g=[{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,maxBar:null,color:"rgb(41, 128, 185)",band:{minVariable:null,maxVariable:null}}],this.defaults={plotId:null,uuid:"",debug:!0,target:null,width:null,merge:!1,decimals:1,x:{variable:null,format:"%Y-%m-%dT%H:%M:%S-08:00",min:null,max:null,ticks:7},y:g,zoom:{scale:{min:.03,max:5}},aspectDivisor:5,transitionDuration:500,weight:2,axisColor:"rgb(0,0,0)",font:{weight:100,size:12},focusX:{color:"rgb(52, 52, 52)"},crosshairX:{weight:1,color:"rgb(149,165,166)"},requestInterval:336},d.x&&(d.x=this.plotter.lib.mergeDefaults(d.x,this.defaults.x)),d.y[0]=this.plotter.lib.mergeDefaults(d.y[0],this.defaults.y[0]),this.options=this.plotter.lib.mergeDefaults(d,this.defaults),this.device="full",this.transform=d3.zoomIdentity,this.links=[{variable:"battery_voltage",title:"Battery Voltage"},{variable:"temperature",title:"Temperature"},{variable:"relative_humidity",title:"Relative Humidity"},{variable:"precipitation",title:"Precipitation"},{variable:"snow_depth",title:"Snow Depth"},{variable:"wind_direction",title:"Wind Direction"},{variable:"wind_speed_average",title:"Wind Speed"},{variable:"net_solar",title:"Net Solar"},{variable:"solar_pyranometer",title:"Solar Pyranometer"},{variable:"equip_temperature",title:"Equipment Temperature"},{variable:"barometric_pressure",title:"Barometric Pressure"},{variable:"snowfall_24_hour",title:"24-Hr Snowfall"},{variable:"intermittent_snow",title:"Intermittent Snow"}],this.log=function(){1<=arguments.length&&a.call(arguments,0)},this.options.debug&&(this.log=function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],console.log(b)}),this.parseDate=d3.timeParse(this.options.x.format),this.bisectDate=d3.bisector(function(a){return a.x}).left,this.displayDate=d3.timeFormat("%b. %e, %I:%M %p"),this.displayDateRound=d3.timeFormat("%b. %e, %I:%M %p"),this.sortDatetimeAsc=function(a,b){return a.x-b.x},this.data=this.processData(c),this.getDefinition(),this.clipPathId="bar-plot-clip-path-"+this.plotter.lib.uuid(),this.bars=[],this.focusRect=[],this.focusText=[],this.skipBandDomainSet=!1,f=null,e=null,c.length>0&&(f=this.getDomainScale(this.definition.x),e=this.getDomainMean(this.definition.x)),this.state={range:{data:[],scale:f},length:{data:[]},interval:{data:[]},zoom:1,request:{data:[]},requested:{data:[]},mean:{scale:e}},c[0].length>0&&(this.setDataState(),this.setIntervalState(),this.setDataRequirement())}return b.prototype.processData=function(a){var b,c,d;b=[];for(d in a)c=a[d],b[d]=this.processDataSet(c,d);return b},b.prototype.processDataSet=function(a,b){var c,d,e,f,g;d=this.options.y[b],f=[];for(e in a)g=a[e],f[e]={x:new Date(this.parseDate(g[this.options.x.variable]).getTime()),y:g[d.variable]},null!=d.band&&(d.band.minVariable&&(f[e].yMin=g[d.band.minVariable]),d.band.maxVariable&&(f[e].yMax=g[d.band.maxVariable]));return c=new Plotter.Data(f),f=c._clean(c.get()),f.sort(this.sortDatetimeAsc)},b.prototype.setData=function(a){var b,c;if(this.data=[this.processDataSet(a,0)],this.getDefinition(),c=null,b=null,a.length>0&&(c=this.getDomainScale(this.definition.x),b=this.getDomainMean(this.definition.x)),this.state.range.scale=c,this.state.mean.scale=b,a.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},b.prototype.addData=function(a,b){var c,d;if(this.data[b]=this.processDataSet(a,b),this.getDefinition(),d=null,c=null,a.length>0&&(d=this.getDomainScale(this.definition.x),c=this.getDomainMean(this.definition.x)),this.state.range.scale=d,this.state.mean.scale=c,a.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},b.prototype.appendData=function(a,b){var c,d;if(c=this.processDataSet(a,b),d=new window.Plotter.Data(this.data[b]),d.append(c,["x"]),this.data[b]=d._clean(d.get()),this.data[b]=this.data[b].sort(this.sortDatetimeAsc),this.initialized)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},b.prototype.removeData=function(a){if(a>=0&&(delete this.data[a],delete this.options[a],this.svg.select(".bar-plot-area-"+a).remove(),this.svg.select(".bar-plot-path-"+a).remove(),this.svg.select(".focus-rect-"+a).remove(),this.svg.select(".focus-text-"+a).remove(),this.initialized))return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},b.prototype.setDataState=function(){var a,b,c;this.data.length,b=this.data,c=[];for(a in b)b[a],this.state.range.data[a]={min:d3.min(this.data[a],function(a){return a.x}),max:d3.max(this.data[a],function(a){return a.x})},c.push(this.state.length.data[a]=this.data[a].length);return c},b.prototype.setIntervalState=function(){var a,b,c;b=this.data,c=[];for(a in b)b[a],c.push(this.state.interval.data[a]={min:(this.state.range.scale.min.getTime()-this.state.range.data[a].min.getTime())/36e5,max:(this.state.range.data[a].max.getTime()-this.state.range.scale.max.getTime())/36e5});return c},b.prototype.setDataRequirement=function(){var a,b,c,d;new Date,c=this.data,d=[];for(b in c)c[b],a=this.state.interval.data[b].max<this.options.requestInterval,this.state.request.data[b]={min:this.state.interval.data[b].min<this.options.requestInterval,max:a},null==this.state.requested.data[b]?d.push(this.state.requested.data[b]={min:!1,max:!1}):d.push(void 0);return d},b.prototype.setZoomState=function(a){return this.state.zoom=a},b.prototype.getDomainScale=function(a){return{min:a.domain()[0],max:a.domain()[1]}},b.prototype.getDomainMean=function(a){var b;return b=new Date(d3.mean(a.domain())),b.setHours(b.getHours()+Math.round(b.getMinutes()/60)),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0),b},b.prototype.getDefinition=function(){var a,b;return this.preError+"getDefinition():",a=this,this.definition={},this.calculateChartDims(),this.calculateAxisDims(this.data),this.definition.xAxis=d3.axisBottom().scale(this.definition.x).ticks(Math.round(this.definition.dimensions.width/100)),this.definition.yAxis=d3.axisLeft().scale(this.definition.y).ticks(this.options.y[0].ticks),this.definition.x.domain([this.definition.x.min,this.definition.x.max]),this.skipBandDomainSet||(this.definition.x1.domain(this.data[0].map(function(a){return a.x})),this.skipBandDomainSet=!1),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),b=[[-1/0,0],[this.definition.x(new Date)+this.definition.dimensions.margin.left,this.definition.dimensions.innerHeight]],this.definition.zoom=d3.zoom().scaleExtent([this.options.zoom.scale.min,this.options.zoom.scale.max]).translateExtent(b).on("zoom",function(){var b;if(void 0!==d3.event&&null!=d3.event.sourceEvent&&("mousemove"!==(b=d3.event.sourceEvent.type)&&"wheel"!==b&&"touchmove"!==b||a.plotter.i.zoom.set(d3.event.transform,a.options.plotId),"zoom"===d3.event.sourceEvent.type))return a.drawZoomTransform(d3.event.transform)})},b.prototype.setBandDomain=function(a){return this.definition.x1=a},b.prototype.calculateChartDims=function(){var a,b,c,d;return d=null!=this.options.width?Math.round(this.options.width):Math.round($(this.options.target).width())-24,b=Math.round(d/this.options.aspectDivisor),d>900?(this.device="large",this.definition.font={size:this.options.font.size/1.2},c={top:Math.round(.04*b),right:Math.round(Math.pow(d,.3)),bottom:20,left:45}):d>400?(this.device="mid",this.definition.font={size:this.options.font.size/1.5},a=this.options.aspectDivisor/1.4,b=Math.round(d/a),c={top:Math.round(.04*b),right:Math.round(Math.pow(d,.3)),bottom:18,left:38}):(this.device="small",this.definition.font={size:this.options.font.size/1.6},a=this.options.aspectDivisor/2.2,b=Math.round(d/a),c={top:35,right:Math.round(Math.pow(d,.3)),bottom:17,left:33}),this.definition.dimensions={width:d,height:b,margin:c},this.definition.dimensions.topPadding=parseInt(this.definition.dimensions.margin.top),this.definition.dimensions.bottomPadding=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom),this.definition.dimensions.leftPadding=parseInt(this.definition.dimensions.margin.left),this.definition.dimensions.innerHeight=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom-this.definition.dimensions.margin.top),this.definition.dimensions.innerWidth=parseInt(this.definition.dimensions.width-this.definition.dimensions.margin.left-this.definition.dimensions.margin.right),this.definition.x=d3.scaleTime().range([c.left,d-c.right]),this.definition.x1=d3.scaleBand().rangeRound([c.left,d-c.right],.05).padding(.1),this.definition.y=d3.scaleLinear().range([b-c.bottom,c.top])},b.prototype.calculateAxisDims=function(a){return this.calculateXAxisDims(a),this.calculateYAxisDims(a)},b.prototype.calculateXAxisDims=function(a){return null===this.options.x.min?this.definition.x.min=d3.min(a[0],function(a){return a.x}):this.definition.x.min=this.parseDate(this.options.x.min),null===this.options.x.max?this.definition.x.max=d3.max(a[0],function(a){return a.x}):this.definition.x.max=this.parseDate(this.options.x.max)},b.prototype.calculateYAxisDims=function(a){var b,c,d,e;this.definition.y.min=0,this.definition.y.max=0;for(e in a)d=a[e],c=d3.min([d3.min(d,function(a){return a.y}),d3.min(d,function(a){return a.yMin})]),b=d3.max([d3.max(d,function(a){return a.y}),d3.max(d,function(a){return a.yMax})]),(c<this.definition.y.min||void 0===this.definition.y.min)&&(this.definition.y.min=c),(b>this.definition.y.max||void 0===this.definition.y.max)&&(this.definition.y.max=b);if(this.definition.y.min===this.definition.y.max&&(this.definition.y.min=.8*this.definition.y.min,this.definition.y.max=1.2*this.definition.y.min),null!=this.options.y[0].min&&(this.definition.y.min=this.options.y[0].min),null!=this.options.y[0].max)return this.definition.y.max=this.options.y[0].max},b.prototype.resize=function(){var a,b,c,d;a=this,this.getDefinition(),this.outer.style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px"),this.ctls.style("height",this.definition.dimensions.height+"px"),this.svg.attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.select("#"+this.clipPathId).select("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.select(".bar-plot-axis-x").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.select(".bar-plot-axis-y").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)"),this.svg.select(".bar-plot-y-label").attr("x",-this.definition.dimensions.margin.top).attr("y",-this.definition.dimensions.margin.left).style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight),c=this.data;for(b in c)c[b],this.svg.selectAll(".bar-"+b).attr("x",function(b){return a.definition.x(b.x)}).attr("width",d3.max([1,this.definition.x1.bandwidth()])).attr("y",function(b){return a.definition.y(b.y)}).attr("height",function(b){return a.definition.dimensions.innerHeight+a.definition.dimensions.margin.top-a.definition.y(b.y)});null!=this.options.y[0].maxBar&&this.svg.select(".bar-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(this.options.y[0].maxBar)).attr("width",this.definition.dimensions.innerWidth),d=this.data;for(b in d)d[b],this.svg.selectAll(".focus-rect-"+b).attr("width",this.definition.x1.bandwidth());return this.overlay.select(".overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.overlay.select(".zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")")},b.prototype.preAppend=function(){return this.preError+"preAppend()",this,this.outer=d3.select(this.options.target).append("div").attr("class","bar-plot-body").style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px").style("display","inline-block"),this.ctls=d3.select(this.options.target).append("div").attr("class","plot-controls").style("width","23px").style("height",this.definition.dimensions.height+"px").style("display","inline-block").style("vertical-align","top"),this.svg=this.outer.append("svg").attr("class","bar-plot").attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.append("defs").append("clipPath").attr("id",this.clipPathId).append("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.append("g").attr("class","bar-plot-axis-x").style("fill","none").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.append("g").attr("class","bar-plot-axis-y").style("fill","none").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)")},b.prototype.append=function(){var a,b,c,d,e,f;if(this.initialized=!0,this.initialized){this.preError+"append()",a=this,this.svg.select(".bar-plot-axis-x").call(this.definition.xAxis),this.svg.select(".bar-plot-axis-y").call(this.definition.yAxis),b=""+this.options.y[0].title,this.options.y[0].units&&(b=b+" "+this.options.y[0].units),this.svg.select(".bar-plot-axis-y").append("text").text(b).attr("class","bar-plot-y-label").attr("x",-this.definition.dimensions.margin.top).attr("y",-this.definition.dimensions.margin.left).attr("dy",".75em").attr("transform","rotate(-90)").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).attr("fill",this.options.axisColor),this.barWrapper=this.svg.append("g").attr("class","bar-wrapper"),d=this.data;for(c in d)f=d[c],this.bars[c]=this.barWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").selectAll(".bar-"+c).data(f).enter().append("rect").attr("class","bar-"+c).attr("x",function(b){return a.definition.x(b.x)}).attr("width",d3.max([1,this.definition.x1.bandwidth()])).attr("y",function(b){return a.definition.y(b.y)}).attr("height",function(b){return a.definition.dimensions.innerHeight+a.definition.dimensions.margin.top-a.definition.y(b.y)}).style("fill",this.options.y[c].color);null!=this.options.y[0].maxBar&&this.barWrapper.append("rect").attr("class","bar-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(this.options.y[0].maxBar)).attr("width",this.definition.dimensions.innerWidth).attr("height",1).style("color","#gggggg").style("opacity",.4),this.hoverWrapper=this.svg.append("g").attr("class","hover-wrapper"),this.crosshairs=this.hoverWrapper.append("g").attr("class","crosshair"),this.crosshairs.append("line").attr("class","crosshair-x").style("stroke",this.options.crosshairX.color).style("stroke-width",this.options.crosshairX.weight).style("stroke-dasharray","3, 3").style("fill","none"),this.crosshairs.append("rect").attr("class","crosshair-x-under").style("fill","rgb(255,255,255)").style("opacity",.1),this.focusDateText=this.hoverWrapper.append("text").attr("class","focus-date-text").attr("x",9).attr("y",7).style("display","none").style("fill","#000000").style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),e=this.data;for(c in e)f=e[c],this.focusRect[c]=this.hoverWrapper.append("rect").attr("width",this.definition.x1.bandwidth()).attr("height",2).attr("class","focus-rect-"+c).attr("fill",this.options.focusX.color).attr("transform","translate(-10, -10)").style("display","none").style("stroke","rgb(255,255,255)").style("opacity",.75),this.focusText[c]=this.hoverWrapper.append("text").attr("class","focus-text-"+c).attr("x",11).attr("y",7).style("display","none").style("fill",this.options.y[c].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)");return this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(this.transform),this.appendZoomTarget(this.transform)}},b.prototype.update=function(){var a,b,c,d,e,f;this.preError,a=this,c=this.transform.rescaleX(this.definition.x),b=Math.floor(this.transform.k*this.definition.x1.bandwidth()),e=this.data;for(d in e)null!=(f=e[d])&&null!=a.options.y[d]&&(null===this.svg.selectAll(".bar-"+d).node()[0]?(console.log("Adding new BarPlot data set."),this.bars[d]=this.barWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").selectAll(".bar-"+d).data(f).enter().append("rect").attr("class","bar-"+d).attr("x",function(a){return c(a.x)}).attr("width",d3.max([1,b])).attr("y",function(b){return a.definition.y(b.y)}).attr("height",function(b){return a.definition.dimensions.innerHeight+a.definition.dimensions.margin.top-a.definition.y(b.y)}).style("fill",this.options.y[d].color),this.focusRect[d]=this.hoverWrapper.append("rect").attr("width",this.definition.x1.bandwidth()).attr("height",2).attr("class","focus-rect-"+d).attr("fill",this.options.focusX.color).attr("transform","translate(-10, -10)").style("display","none").style("stroke","rgb(255,255,255)").style("opacity",.75),this.focusText[d]=this.hoverWrapper.append("text").attr("class","focus-text-"+d).attr("x",11).attr("y",7).style("display","none").style("fill",this.options.y[d].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)")):(this.bars[d]=this.barWrapper.select("g").selectAll(".bar-"+d).data(f),this.bars[d].enter().append("rect").attr("class","bar-"+d).attr("x",function(a){return c(a.x)}).attr("width",d3.max([1,b])).attr("y",function(b){return a.definition.y(b.y)}).attr("height",function(b){return a.definition.dimensions.innerHeight+a.definition.dimensions.margin.top-a.definition.y(b.y)}).style("fill",this.options.y[d].color),this.bars[d].exit().remove(),this.bars[d].attr("x",function(a){return c(a.x)}).attr("width",d3.max([1,b])).attr("y",function(b){return a.definition.y(b.y)}).attr("height",function(b){return a.definition.dimensions.innerHeight+a.definition.dimensions.margin.top-a.definition.y(b.y)})));return this.overlay.remove(),this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(this.transform),this.calculateYAxisDims(this.data),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),this.svg.select(".bar-plot-axis-y").call(this.definition.yAxis),null!=this.options.y[0].maxBar&&this.barWrapper.select(".bar-plot-max-bar").attr("y",this.definition.y(this.options.y[0].maxBar)),this.drawZoomTransform(this.transform)},b.prototype.removeTemp=function(){return this.temp.remove()},b.prototype.appendCrosshairTarget=function(a){var b;if(this.initialized)return this.preError+"appendCrosshairTarget()",b=this,this.overlay.datum(this.data).attr("class","overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").on("mouseover",function(){return b.plotter.i.crosshairs.show()}).on("mouseout",function(){return b.plotter.i.crosshairs.hide()}).on("mousemove",function(){var c;return c=b.setCrosshair(a),b.plotter.i.crosshairs.set(a,c)})},b.prototype.appendZoomTarget=function(){if(this.initialized)return this.preError+"appendZoomTarget()",this,this.overlay.attr("class","zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").style("cursor","move"),this.svg.call(this.definition.zoom)},b.prototype.setZoomTransform=function(a){if(this.initialized)return this.preError+".setZoomTransform(transform)",a?(this.transform=a,this.svg.call(this.definition.zoom.transform,a),a):void 0},b.prototype.drawZoomTransform=function(a){var b,c,d;b=a.rescaleX(this.definition.x),this.svg.select(".bar-plot-axis-x").call(this.definition.xAxis.scale(b)),this.state.range.scale=this.getDomainScale(b),this.state.mean.scale=this.getDomainMean(b),this.setDataState(),this.setIntervalState(),this.setDataRequirement(),this.setZoomState(a.k),d=this.data;for(c in d)d[c],this.svg.selectAll(".bar-"+c).attr("x",function(a){return b(a.x)}).attr("width",d3.max([1,Math.floor(a.k*this.definition.x1.bandwidth())]));return this.appendCrosshairTarget(a),a},b.prototype.setCrosshair=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(this.initialized){this.preError+".setCrosshair(mouse)",c=this,e=this.definition.dimensions,j=function(a){switch(!1){case!(a>360||a<0):return"INV";case!(a>=0&&a<11.25):return"N";case!(a>=11.25&&a<33.75):return"NNE";case!(a>=33.75&&a<56.25):return"NE";case!(a>=56.25&&a<78.75):return"ENE";case!(a>=78.75&&a<101.25):return"E";case!(a>=101.25&&a<123.75):return"ESE";case!(a>=123.75&&a<146.25):return"SE";case!(a>=146.25&&a<168.75):return"SSE";case!(a>=168.75&&a<191.25):return"S";case!(a>=191.25&&a<213.75):return"SSW";case!(a>=213.75&&a<236.25):return"SW";case!(a>=236.25&&a<258.75):return"WSW";case!(a>=258.75&&a<281.25):return"W";case!(a>=281.25&&a<303.75):return"WNW";case!(a>=303.75&&a<326.25):return"NW";case!(a>=326.25&&a<348.75):return"NNW";case!(a>=348.75&&a<=360):return"N"}},q=this.data;for(p in q)r=q[p],f=this.overlay.node(),d=r,b=b||d3.mouse(f),t=this.definition.x.invert(b[0]+e.leftPadding),a&&(t=this.definition.x.invert(a.invertX(b[0]+e.leftPadding))),o=c.bisectDate(d,t,1),n=t.getMinutes()>=30?o:o-1,t.getTime()<=this.state.range.data[p].min.getTime()&&(n=o),t.getTime()>=this.state.range.data[p].max.getTime()&&(n=o-1),this.crosshairs.select(".crosshair-x").attr("x1",b[0]).attr("y1",e.topPadding).attr("x2",b[0]).attr("y2",e.innerHeight+e.topPadding).attr("transform","translate("+e.leftPadding+", 0)"),this.crosshairs.select(".crosshair-x-under").attr("x",b[0]).attr("y",e.topPadding).attr("width",e.innerWidth-b[0]).attr("height",e.innerHeight).attr("transform","translate("+e.leftPadding+", 0)"),h=this.definition.x.invert(b[0]+e.leftPadding),a&&(h=this.definition.x.invert(a.invertX(b[0]+e.leftPadding))),g=this.displayDate(this.plotter.i.crosshairs.roundDate(h)),m=b[0]-120,this.focusDateText.attr("x",m).attr("y",e.topPadding+e.innerHeight-3).attr("transform","translate("+e.leftPadding+", 0)").text(g),null!=d[n]&&(k=a?a.applyX(this.definition.x(d[n].x)):this.definition.x(d[n].x),l=[],i=[],null!==this.options.y[p].variable&&(i[p]=d[n],null!=i[p]&&(l[p]=this.definition.y(i[p].y),this.displayDate(i[p].x),isNaN(l[p])||null==i[p].y||this.focusRect[p].attr("transform","translate(0, 0)"))),k-e.leftPadding>=0&&(null===this.options.y[p].variable||isNaN(l[p])||null==i[p].y||(this.focusRect[p].attr("width",a.k*this.definition.x1.bandwidth()).attr("x",k).attr("y",l[p]),s="start",this.focusText[p].attr("x",k+e.leftPadding/10+a.k*this.definition.x1.bandwidth()+2).attr("y",l[p]-e.topPadding/10).attr("text-anchor",s).text(null!=i[p].y?"wind_direction"===c.options.y[0].variable?j(i[p].y):i[p].y.toFixed(this.options.decimals)+" "+this.options.y[p].units:void 0))));return b}},b.prototype.showCrosshair=function(){var a,b,c,d;if(this.initialized){this.crosshairs.select(".crosshair-x").style("display",null),this.crosshairs.select(".crosshair-x-under").style("display",null),this.focusDateText.style("display",null),a=this.options.y,b=[];for(d in a)c=a[d],null!==c.variable?(null!=this.focusRect[d]&&this.focusRect[d].style("display",null).attr("fill",this.options.focusX.color),null!=this.focusText[d]?b.push(this.focusText[d].style("display",null).style("color",c.color).style("fill",c.color)):b.push(void 0)):b.push(void 0);return b}},b.prototype.hideCrosshair=function(){var a,b,c,d;if(this.initialized){this.crosshairs.select(".crosshair-x").style("display","none"),this.crosshairs.select(".crosshair-x-under").style("display","none"),this.focusDateText.style("display","none"),a=this.options.y,b=[];for(d in a)c=a[d],null!==c.variable?(null!=this.focusRect[d]&&this.focusRect[d].style("display","none"),null!=this.focusText[d]?b.push(this.focusText[d].style("display","none")):b.push(void 0)):b.push(void 0);return b}},b.prototype.appendTitle=function(a,b){var c,d,e;if(d=1,c="16px",e="12px","small"===this.device&&(d=.4,c="10px",e="7px"),this.title=this.svg.append("g").attr("class","bar-plot-title"),this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2-4*d).style("font-size",c).style("font-weight",600).text(a),b)return this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2+12*d).style("font-size",e).text(b)},b.prototype.getState=function(){return this.state},b}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Colors=function(){function a(){var a;a={light:["rgb(141,160,203)","rgb(252,141,98)","rgb(166,216,84)","rgb(231,138,195)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)","rgb(102,194,165)"],dark:["rgb(45, 62, 80)","rgb(210, 84, 0)","rgb(39, 174, 97)","rgb(192, 57, 43)","rgb(126, 140, 141)","rgb(42, 128, 185)","rgb(239, 154, 15)","rgb(143, 68, 173)","rgb(23, 160, 134)"]},this.color=function(b,c){return a[b][c]},this.templateColors={}}return a.prototype.getInitial=function(a){var b,c,d;c=a.y;for(b in c)d=c[b],d.color=this.get(d.dataLoggerId);return a},a.prototype.get=function(a){var b,c;return b=Object.keys(this.templateColors).length,c=b%7,null!=this.templateColors[a]==!1&&(this.templateColors[a]=this.color("light",c)),this.templateColors[a]},a}()}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};window.Plotter||(window.Plotter={}),window.Plotter.Controls=function(){function b(a){this.preError="Plotter.Dropdown",this.plotter=a,this.api=this.plotter.i.api,this.current=[],this.stations=[],this.maps=[],this.markers={},this.listeners={}}return b.prototype.append=function(a){var b,c,d,e,f,g;return c=this.plotter.i.template.full()[a],b=this.plotter.plots[a].proto,d=b.options.uuid,g="plot-controls-"+d,"",e="font-size: 12px;",$(window).width()>400&&(e="font-size: 14px;"),f='<ul id="'+g+'" class="unstyled" style="list-style-type: none; padding-left: 6px; '+e+'"> </ul>',$(b.options.target).find(".plot-controls").append(f),this.move(a,"#"+g,"up"),this.new("#"+g,"down"),this.remove(a,"#"+g),this.move(a,"#"+g,"down"),"station"===c.type?this.appendParameterDropdown(a,"#"+g,b.options.y.dataloggerid):"parameter"===c.type?this.appendStationDropdown(a,"#"+g,b.options.y[0].variable):void 0},b.prototype.setCurrent=function(a){var b,c,d,e,f,g;if(b=this.plotter.plots[a].proto,this.current[a]=[],b.initialized){e=b.options.y,f=[];for(d in e)g=e[d],null!==g.dataLoggerId?(c={dataLoggerId:parseInt(g.dataLoggerId),yTarget:d,color:g.color},f.push(this.current[a].push(c))):f.push(void 0);return f}
},b.prototype.getCurrent=function(a){return a>=0?this.current[a]:this.current},b.prototype.updateStationStates=function(a){var b,c,d,e,f,g,h,i,j;if(this.setCurrent(a),this.stations[a].length>0){for(g=this.stations[a],i=[],e=0,f=g.length;e<f;e++)h=g[e],h.displayed=[],i.push(function(){var e,f,g,i;for(g=h.dataloggers,i=[],e=0,f=g.length;e<f;e++)j=g[e],j.displayed=!1,j.color="",c=this.plotter.lib.indexOfValue(this.current[a],"dataLoggerId",j.id),c>-1?(b=this.current[a][c].color,j.displayed=!0,j.color=b,d={dataLoggerId:j.id,color:b},i.push(h.displayed.push(d))):i.push(void 0);return i}.call(this));return i}},b.prototype.appendStationDropdown=function(a,b,c){var d,e,f,g,h;return g=this.plotter.options.href+"/api/v5/dataloggerregion?sensor_name="+c,d=this,e={},this.getCurrent(a),h=this.plotter.lib.uuid(),f=function(c){var e,f,g,i,j,k,l,m,n,o;for(d.stations[a]=c.responseJSON.results,f='<li class="dropdown"> <a id="station-'+h+'" class="station-dropdown dropdown-toggle" role="button" title="Select Stations" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="station-dropdown-'+a+'" class="dropdown-menu pull-right">',l=d.stations[a],g=0,j=l.length;g<j;g++){for(n=l[g],e=d.plotter.lib.toLower(n.name),f=f+' <li class="subheader"> <a data-region="'+e+'" data-plot-id="'+a+'" href=""> <i class="icon-caret-down" style="margin-right: 6px"></i> <span class="region-name">'+n.name+'</span> <span class="region-dots"></span> </a> </li> <ul class="list-group-item sublist" style="display: none;">',m=n.dataloggers,i=0,k=m.length;i<k;i++)o=m[i],f=f+' <li class="station" data-station-id="'+o.id+'" data-plot-id="'+a+'" style="padding: 1px 5px; cursor: pointer; list-style-type: none"> <i class="icon-circle"></i> <span class="station-name"> '+o.datalogger_name+" | "+o.elevation+" ft </span> </li>";f+=" </ul>"}return f+=" </ul> </li>",$(b).prepend(f),$("#station-"+h).dropdown(),d.bindSubMenuEvent(".subheader"),d.setCurrent(a),d.updateStationDropdown(a),d.appendStationMap(a,b,c.responseJSON.results)},this.api.get(g,e,f)},b.prototype.updateStationDropdown=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(b=this,this.updateStationStates(a),d=function(a){var b,c,d,e;for(b="",c=0,d=a.length;c<d;c++)e=a[c],b=b+' <i style="color: '+e.color+';" class="icon-circle"></i>';return b},c=function(a,b,c){return c.displayed?$('[data-station-id="'+c.id+'"][data-plot-id="'+a+'"]').off("click").on("click",function(a){var c;return a.stopPropagation(),c=$(this).attr("data-plot-id"),$(this).append('<i class="icon-spinner icon-spin" data-plot-id="'+c+'"></i>'),b.removeStation(c,$(this).attr("data-station-id"))}):$('[data-station-id="'+c.id+'"][data-plot-id="'+a+'"]').off("click").on("click",function(a){var c;return a.stopPropagation(),c=$(this).attr("data-plot-id"),$(this).append('<i class="icon-spinner icon-spin" data-plot-id="'+c+'"></i>'),b.addStation(c,$(this).attr("data-station-id"))})},l=this.stations[a],h=0,j=l.length;h<j;h++){for(n=l[h],e=this.plotter.lib.toLower(n.name),f="",g="","",n.displayed.length>0&&("rgb(248, 248, 248)",g=700,f=d(n.displayed)),m=n.dataloggers,i=0,k=m.length;i<k;i++)o=m[i],$('[data-station-id="'+o.id+'"][data-plot-id="'+a+'"]> i.icon-circle').css("color",o.color),c(a,b.plotter,o);$('[data-region="'+e+'"][data-plot-id="'+a+'"]').css("font-weight",g),$('[data-region="'+e+'"][data-plot-id="'+a+'"] > span.region-dots').html(f)}if(null!=this.plotter.legends[a])return this.plotter.legends[a].draw()},b.prototype.removeSpinner=function(a){return $('i.icon-spinner[data-plot-id="'+a+'"]').remove()},b.prototype.appendParameterDropdown=function(b,c,d){var e,f,g,h,i;return h=this.plotter.options.href+"/api/v5/sensortype?sensors__data_logger="+d,e={},g=this.getCurrent(b),i=this.plotter.lib.uuid(),[],f=function(d){var e,f,h,j,k,l,m,n,o,p;for(j='<li class="dropdown"> <li><a id="param-'+i+'" class="parameter-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="param-dropdown-'+b+'" class="dropdown-menu pull-right" role="menu" aria-labelledby="'+i+'">',o=d.responseJSON.results,k=0,m=o.length;k<m;k++)n=o[k],"wind_speed_minimum"===n.field_name||"wind_speed_maximum"===n.field_name||("wind_speed_average"===n.field_name?(e=n.field_name,f=e.replace("_","-"),l=f+"-plot-"+b,p=g.variable,a.call(n.field_name,p)>=0&&(h='<i id="'+l+'" class="parameter-'+n.parameter+' icon-circle" style="color: '+g.color+'"></i>')):(e=n.field_name,f=e.replace("_","-"),l=f+"-plot-"+b,h=g.variable===n.field_name?'<i id="'+l+'" class="icon-circle" style="color: '+g.color+'"></i>':'<i id="'+l+'" class="icon-circle" style=""></i>')),j=j+' <li><a style="cursor: pointer" onclick="plotter.addVariable('+b+", '"+e+"')\">"+h+" "+n.sensortype_name+"</a></li>";return j+=" </ul> </li> </li>",$(c).prepend(j),$("#"+i).dropdown()},this.api.get(h,e,f)},b.prototype.appendStationMap=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(d=this,l=this.getCurrent(a),j=this.plotter.plots[a].proto.options.uuid,A="200px",v="244px",$(window).width()>400&&(A="312px",v="356px"),m='<li data-toggle="popover" data-placement="left"> <i id="map-'+j+'" class="icon-map-marker" title="Select Stations Map" style="cursor: pointer"></i> </li> <div id="map-pop-'+j+'" class="popover" style="max-width: '+v+';"> <div class="popover-content"> <a id="map-close-'+j+'" style="font-size: 10px; cursor: pointer">Close</a> <div id="map-control-'+j+'" style="width: '+A+"; height: "+A+';"></div> </div> </div>',$(b).prepend(m),$("#map-"+j).on("click",function(){return d.plotter.i.controls.toggleMap(a)}),$("#map-close-"+j).on("click",function(){return d.plotter.i.controls.toggleMap(a)}),this.maps[a]=new google.maps.Map(document.getElementById("map-control-"+j),{center:new google.maps.LatLng(46.98,-122.221),zoom:6,maxZoom:12,minZoom:6,mapTypeId:"terrain",zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1}),o=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),this.markers[a]=[],this.listeners[a]=[],f=new google.maps.LatLngBounds,e=[],n=0,r=c.length;n<r;n++)for(y=c[n],x=y.dataloggers,p=0,s=x.length;p<s;p++)B=x[p],k="rgb(200,200,200)",z=5,w=.5,i="map-plot-"+j+"-station-"+B.id,h=d.isCurrent(l,"dataLoggerId",B.id),h&&(k=h.color,z=7,w=.8,e.push(new google.maps.LatLng(B.lat,B.lon))),u=new google.maps.Marker({position:{lat:B.lat,lng:B.lon},id:i,tooltip:B.datalogger_name+" - "+B.elevation+" ft",dataLoggerId:B.id,icon:{path:google.maps.SymbolPath.CIRCLE,scale:z,strokeWeight:2,fillOpacity:w,fillColor:k},selected:!1}),u.addListener("mouseover",function(){return o.setContent(this.tooltip),o.open(d.maps[a],this)}),u.addListener("mouseout",function(){return o.close()}),this.listeners[a][i]=u.addListener("click",function(){return d.plotter.addStation(a,this.dataLoggerId)}),this.markers[a][i]=u,this.markers[a][i].setMap(this.maps[a]);if(e.length>0){for(q=0,t=e.length;q<t;q++)g=e[q],f.extend(g);this.maps[a].fitBounds(f),this.maps[a].panToBounds(f)}if(this.maps[a].getZoom()<6)return this.maps[a].setZoom(6)},b.prototype.resetStationMap=function(a){var b,c,d,e,f;b=this,e=this.markers[a],f=[];for(c in e)d=e[c],d.setIcon({path:google.maps.SymbolPath.CIRCLE,scale:5,strokeWeight:2,fillOpacity:.5,fillColor:"rgb(200,200,200)"}),d.set("selected",!1),b.listeners[a][c].remove(),f.push(b.listeners[a][c]=d.addListener("click",function(){var c;return c=this.get("dataLoggerId"),b.plotter.addStation(a,c)}));return f},b.prototype.updateStationMap=function(a){var b,c,d,e,f,g,h,i,j;b=this,e=this.plotter.plots[a].proto.options.uuid,this.resetStationMap(a),j=function(a,c,d){return b.markers[a][c].setIcon({path:google.maps.SymbolPath.CIRCLE,scale:7,strokeWeight:2,fillOpacity:.8,fillColor:d}),b.markers[a][c].set("selected",!0),b.listeners[a][c].remove(),b.listeners[a][c]=b.markers[a][c].addListener("click",function(){var c;return c=this.get("dataLoggerId"),b.plotter.removeStation(a,c)})},c=this.plotter.plots[a].proto.options,g=c.y,h=[];for(f in g)i=g[f],null!==i.variable?(i.variable.replace("_","-"),d="map-plot-"+e+"-station-"+i.dataLoggerId,h.push(j(a,d,i.color))):h.push(void 0);return h},b.prototype.boundOnSelected=function(a){var b,c,d,e,f,g,h,i;c=new google.maps.LatLngBounds,b=[],i=this.markers[a];for(d in i)e=i[d],!0===e.get("selected")&&b.push(e.getPosition());for(g=0,h=b.length;g<h;g++)f=b[g],c.extend(f);if(this.maps[a].fitBounds(c),this.maps[a].getZoom()<6)return this.maps[a].setZoom(6)},b.prototype.toggleMap=function(a){var b,c,d,e,f,g;return f=this.plotter.plots[a].proto.options.uuid,e=356,d=$("#outer-"+f).offset().top-$("#main-content").offset().top,c=$("#map-"+f).offset().left-$("#main-content").offset().left-e,location.origin.indexOf(":5000")>=0&&(c=$("#map-"+f).offset().left-e),$(window).width()<=400&&(e=200,c=$("#main-content").width()/2-$("#map-pop-"+f).width()/2),b=this.plotter.i.controls.maps[a].getCenter(),g=this.plotter.i.controls.maps[a].getZoom(),$("#map-control-"+f).parent().parent().prev().offset(),$("#map-control-"+f).parent().parent().toggle().css("left",c).css("top",d),google.maps.event.trigger(this.plotter.i.controls.maps[a],"resize"),this.plotter.i.controls.maps[a].setCenter(b),this.plotter.i.controls.maps[a].setZoom(g)},b.prototype.toggle=function(a){return $(a).toggle()},b.prototype.move=function(a,b,c){var d,e,f,g;return d=this,f=this.plotter.plots[a].proto.options.uuid,e="up"===c?"Up":"Down",g='<li> <i id="move-'+f+"-"+c+'" style="cursor: pointer;" title="Move Plot '+e+'" class="icon-arrow-'+c+' plot-control-button"></i> </li>',$(b).append(g),$("#move-"+f+"-"+c).on("click",function(){return d.plotter.move(a,c)})},b.prototype.remove=function(a,b){var c,d,e;return c=this,d=this.plotter.plots[a].proto.options.uuid,e='<li> <i id="remove-'+d+'" style="cursor: pointer;" title="Remove Plot" class="icon-remove plot-control-button"></i> </li>',$(b).append(e),$("#remove-"+d).on("click",function(){return c.plotter.remove(a)})},b.prototype.new=function(a){var b,c,d,e,f,g,h,i,j,k;for(b=this,k=this.plotter.lib.uuid(),c=[{variable:"battery_voltage",title:"Battery Voltage"},{variable:"net_solar",title:"Solar Radiation"},{variable:"solar_pyranometer",title:"Solar Pyranometer"},{variable:"relative_humidity",title:"Relative Humidity"},{variable:"barometric_pressure",title:"Barometric Pressure"},{variable:"snow_depth",title:"Snow Depth"},{variable:"snowfall_24_hour",title:"24-Hour Snowfall"},{variable:"intermittent_snow",title:"Intermittent Snow"},{variable:"wind_direction",title:"Wind Direction"},{variable:"precipitation",title:"Precipitation (Bar Plot)"},{variable:"precipitation_line",title:"Precipitation (Line Plot)"},{variable:"temperature",title:"Temperature"},{variable:"equip_temperature",title:"Equipment Temperature"},{variable:"wind_speed_average",title:"Wind Speed"}],'<ul id="new-'+k+'-dropdown" class="dropdown-menu pull-right plot-control-button" role="menu" aria-labelledby="new-'+k+'"> <li><a id="new-'+k+'-parameter" style="cursor: pointer">Add Parameter Plot</a></li> <li><a id="new-'+k+'-station" style="cursor: pointer">Add Station Plot</a></li> </ul>',d='<li class="dropdown"> <a id="new-'+k+'" class="dropdown-toggle" title="Add New Plot" data-toggle="dropdown" role="button" href="#"> <i class="icon-plus"></i></a> <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="'+k+'">',e=0,g=c.length;e<g;e++)j=c[e],d=d+' <li><a id="new_'+j.variable+"_"+k+'" data-variable="'+j.variable+'">'+j.title+"</a></li>";for(d+=" </ul> </li>",$(a).append(d),i=[],f=0,h=c.length;f<h;f++)j=c[f],i.push($("#new_"+j.variable+"_"+k).off("click").on("click",function(){var a;return a=$(this).attr("data-variable"),b.plotter.add("parameter",a)}));return i},b.prototype.isCurrent=function(a,b,c){var d,e;for(d in a)if(e=a[d],e[b]===c)return e;return!1},b.prototype.bindSubMenuEvent=function(a){return $(a).unbind().on("click",function(a){var b;return a.preventDefault(),a.stopPropagation(),b=$(this).next(),b.is(":visible")?($(this).find("i").removeClass("icon-caret-up").addClass("icon-caret-down"),b.slideUp()):($(this).find("i").removeClass("icon-caret-down").addClass("icon-caret-up"),b.slideDown())})},b.prototype.getLoggerName=function(a,b){var c,d,e,f,g,h,i;h="Station",f=this.stations[a];for(d in f){e=f[d],g=e.dataloggers;for(c in g)i=g[c],i.id===parseInt(b)&&(h=i.datalogger_name+" - "+i.elevation+" Ft.")}return h},b.prototype.resize=function(a){var b,c,d,e;return b=this.plotter.plots[a].proto.options.uuid,c="9px",e="200px",d="244px",$(window).width()>400&&(c="14px",e="312px",d="356px"),$("#plot-controls-"+b).css("font-size",c),$("#map-pop-"+b).css("max-width",d),$("#map-control-"+b).css("height",e).css("width",e)},b}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Crosshairs=function(){function a(a){this.preError="Plotter.Crosshairs.",this.plotter=a}return a.prototype.set=function(a,b){var c,d,e,f,g;for(f=this.plotter.plots,g=[],c=0,d=f.length;c<d;c++)e=f[c],null!=e?g.push(e.proto.setCrosshair(a,b)):g.push(void 0);return g},a.prototype.show=function(){var a,b,c,d,e;for(d=this.plotter.plots,e=[],a=0,b=d.length;a<b;a++)c=d[a],null!=c?e.push(c.proto.showCrosshair()):e.push(void 0);return e},a.prototype.hide=function(){var a,b,c,d,e;for(d=this.plotter.plots,e=[],a=0,b=d.length;a<b;a++)c=d[a],null!=c?e.push(c.proto.hideCrosshair()):e.push(void 0);return e},a.prototype.roundDate=function(a){return a.setHours(a.getHours()+Math.round(a.getMinutes()/60)),a.setMinutes(0),a},a}()}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};window.Plotter||(window.Plotter={}),window.Plotter.Data=function(){function b(a){var b;if(this.preError="Plotter.Data.",b=this.preError+".constructor(...)",!(a instanceof Array))return void console.log(b+" data not of type array.");this.data=$.extend(!0,[],a),this.sourceCount=1,this.test=function(a,c,d){var e,f,g,h,i,j;if(b=this.preError+"test(...):",null==d)throw new Error(b+" Missing onKeys (required)");for(f=d.length,e=0,i=!1,g=0,h=d.length;g<h;g++){if(j=d[g],void 0===a[j])throw new Error(b+" key '"+j+"' not found in primary data set.");if(void 0===c[j])throw new Error(b+" key '"+j+"' not found in joining data set.");a[j]instanceof Date?a[j].getTime()===c[j].getTime()&&e++:a[j]===c[j]&&e++}return e===f&&(i=!0),i}}return b.prototype.join=function(b,c){var d,e,f,g,h,i,j,k,l,m,n;this.preError,m=[],f="_"+parseInt(this.sourceCount+1),Object.keys(this.data[0]),Object.keys(b[0]),b.length>this.data.length?(g=$.extend(!0,[],b),i=$.extend(!0,[],this.data)):(g=$.extend(!0,[],this.data),i=$.extend(!0,[],b));for(l in g){n=g[l],e=m.push($.extend(!0,{},n));for(d in i)if(h=i[d],this.test(n,h,c)){for(j in h)k=h[j],a.call(c,j)<0&&(m[e-1][j+f]=k);i.splice(d,1);break}}return this.sourceCount++,this.data=this._clean(m),this.data},b.prototype.merge=function(b,c){var d,e,f,g,h,i,j,k,l,m;this.preError,l=[],Object.keys(this.data[0]),Object.keys(b[0]),b.length>this.data.length?(f=$.extend(!0,[],b),h=$.extend(!0,[],this.data)):(f=$.extend(!0,[],this.data),h=$.extend(!0,[],b));for(k in f){m=f[k],e=l.push($.extend(!0,{},m));for(d in h)if(g=h[d],this.test(m,g,c)){for(i in g)j=g[i],a.call(c,i)<0&&(l[e-1][i]=j);h.splice(d,1);break}}return this.data=this._clean(l),this.data},b.prototype.append=function(b,c){var d,e,f,g,h,i,j,k,l;this.preError,e=$.extend(!0,[],this.data),g=$.extend(!0,[],b);for(j in e){l=e[j];for(d in g)if(f=g[d],this.test(l,f,c)){for(h in f)i=f[h],a.call(c,h)<0&&(e[j][h]=i);g.splice(d,1)}}return k=e.concat(g),this.data=this._clean(k),this.data},b.prototype.appendKeys=function(a,b){var c,d,e;d=[];for(c in a)e=a[c],d[c+b]=e;return this._clean(d)},b.prototype.sub=function(a,b){return this.data=this._clean($.extend(!0,[],this.data.slice(a,b))),this.data},b.prototype.get=function(){return $.extend(!0,[],this.data)},b.prototype.getSourceCount=function(){return this.sourceCount},b.prototype._clean=function(a){var b,c,d,e,f;for(b=$.extend(!0,[],a),c=b.length-1,d=e=0,f=c;0<=f?e<=f:e>=f;d=0<=f?++e:--e)void 0===b[d]&&b.splice(d,1);return $.extend(!0,[],b)},b.prototype._tryError=function(a,b){var c,d,e,f,g;for(c=a.length-1,g=[],d=e=0,f=c;0<=f?e<=f:e>=f;d=0<=f?++e:--e){if(void 0===a[d])throw console.log("@data[i] is (i, row)",d,row),new Error(b+" undefined row");g.push(void 0)}return g},b}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.InitialSync=function(){function a(a){this.preError="Plotter.InitialSync",this.plotter=a,this.api=this.plotter.i.api,this.requests={},this.endpoint=function(){return this.plotter.options.href+"/api/v5/measurement"}}return a.prototype.stageAll=function(){var a,b,c,d;for(d=[],b=a=0,c=this.plotter.i.template.plotCount()-1;0<=c?a<=c:a>=c;b=0<=c?++a:--a)d.push(this.stage(b));return d},a.prototype.stage=function(a){var b,c,d,e,f,g,h,i;for(b=this.plotter.i.template.template[a],f=b.x.max,h=[],d=e=0,g=this.plotter.i.template.dataSetCount(a)-1;0<=g?e<=g:e>=g;d=0<=g?++e:--e)c=this.plotter.i.template.forSync(a,d,f,this.plotter.options.initialLength),i=this.plotter.lib.uuid(),this.requests[i]={plot:a,ready:!1,requested:!1},h.push(this.requests[i].requested=this.get(a,d,i,c));return h},a.prototype.add=function(a){var b,c,d,e,f,g,h,i,j;for(i=this.plotter.plots,d=0,e=i.length;d<e;d++)if(void 0!==(h=i[d])){b=h.proto.getState();break}return this.plotter.i.template.template[a],g=this.plotter.lib.format(b.range.data[0].max),f=b.length.data[0],c=this.plotter.i.template.forSync(a,0,g,f),j=this.plotter.lib.uuid(),this.requests[j]={plotId:a,ready:!1,requested:!1},this.requests[j].requested=this.getAppend(a,0,j,c)},a.prototype.get=function(a,b,c,d){var e,f,g,h;return g=this.preError+".get()",h=this.endpoint(),e=this,f=function(d){if(null==d.responseJSON)throw new Error(g+" error requesting data.");if(0===d.responseJSON.results.length)throw new Error(g+" no set found.");return e.requests[c].ready=!0,e.plotter.plots[a].__data__[b]=d.responseJSON.results},this.api.get(h,d,f),!0},a.prototype.getAppend=function(a,b,c,d){var e,f,g,h;return g=this.preError+".get()",h=this.endpoint(),e=this,f=function(d){var f,h,i,j;if(null==d.responseJSON)throw new Error(g+" error requesting data.");if(0===d.responseJSON.results.length)throw new Error(g+" no set found.");for(j=e.plotter.plots,f=0,h=j.length;f<h;f++)if(void 0!==(i=j[f])){i.proto.transform;break}return null==e.plotter.plots[a].__data__&&(e.plotter.plots[a].__data__=[]),e.requests[c].ready=!0,e.plotter.plots[a].__data__[b]=d.responseJSON.results,e.plotter.plots[a].proto.skipBandDomainSet=!0,e.plotter.plots[a].proto.setData(e.plotter.plots[a].__data__[b]),e.plotter.plots[a].proto.setBandDomain(e.plotter.bandDomain),e.plotter.plots[a].proto.append(),null==e.plotter.legends[a]&&(e.plotter.legends[a]=new window.Plotter.Legend(e.plotter,a),e.plotter.legends[a].draw()),e.plotter.i.controls.removeSpinner(a)},this.api.get(h,d,f),!0},a.prototype.isReady=function(){var a,b,c,d;a=0,c=this.requests;for(b in c)d=c[b],!1===d.ready&&a++;return 0===a},a}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Legend=function(){function a(a,b){this.preError="Plotter.Legend.",this.preError,this.plotter=a,this.svg=this.plotter.plots[b].proto.svg,this.plotId=this.plotter.plots[b].proto.options.plotId,this.definition=this.plotter.plots[b].proto.definition,this.dimensions=this.definition.dimensions,this.plotOptions=this.plotter.plots[b].proto.options,this.plotDevice=this.plotter.plots[b].proto.device,this.getDimensions(),this.legend=this.svg.append("g").attr("class","legend")}return a.prototype.getDimensions=function(){if(this.definition=this.plotter.plots[this.plotId].proto.definition,this.dimensions=this.definition.dimensions,this.plotOptions=this.plotter.plots[this.plotId].proto.options,this.legendOffset={rect:this.dimensions.margin.left+20,text:this.dimensions.margin.left+30},"small"===this.plotDevice)return this.legendOffset.rect=this.dimensions.margin.left+5,this.legendOffset.text=this.dimensions.margin.left+15},a.prototype.set=function(){var a,b,c,d,e,f,g;this.data=[],c=this.plotter.plots[this.plotId].proto.options,a=0,f=c.y;for(e in f)g=f[e],b=this.plotter.i.controls.getLoggerName(this.plotId,g.dataLoggerId),a++,d={offset:a,title:""+b,color:g.color},this.data.push(d);return this.data},a.prototype.draw=function(){var a,b;return this.set(),a=this.legend.selectAll("rect").data(this.data),a.attr("y",function(a){return 12*a.offset}).style("fill",function(a){return a.color}),a.enter().append("rect").attr("rx",1).attr("ry",1).attr("width",6).attr("height",6).attr("x",this.legendOffset.rect).attr("y",function(a){return 12*a.offset}).style("fill",function(a){return a.color}),a.exit().remove(),b=this.legend.selectAll("text").data(this.data),b.attr("y",function(a){return 12*a.offset+6}).text(function(a){return a.title}),b.enter().append("text").attr("x",this.legendOffset.text).attr("y",function(a){return 12*a.offset+6}).text(function(a){return a.title}).style("font-size",this.definition.font.size+"px").style("font-weight",500),b.exit().remove()},a.prototype.remove=function(){return this.legend.selectAll(".legend").remove()},a.prototype.resize=function(){return this.getDimensions(),this.legend.selectAll("rect").attr("x",this.legendOffset.rect),this.legend.selectAll("text").attr("x",this.legendOffset.text).style("font-size",this.definition.font.size+"px")},a}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Library=function(){function a(a){var b,c;c={dateFormat:"%Y-%m-%dT%H:%M:%S-08:00",displayDate:"%b. %e, %I:%M %p"},b=this.mergeDefaults(c,a),this.parseDate=d3.timeParse(b.dateFormat),this.format=d3.utcFormat(b.dateFormat),this.displayFormat=d3.timeFormat(b.displayDate),this.getNow=function(){return this.format(new Date)},this.getNowDisplay=function(){return this.displayFormat(new Date)}}return a.prototype.mergeDefaults=function(a,b){var c,d,e,f,g;e={};for(c in b)f=b[c],e[c]=f;for(d in a)g=a[d],e[d]=g;return e},a.prototype.indexOfValue=function(a,b,c){var d,e,f,g;if(e=-1,a.length>0)for(d=f=0,g=a.length-1;0<=g?f<=g:f>=g;d=0<=g?++f:--f)null!=a[d]&&a[d][b]==c&&(e=d);return e},a.prototype.uuid=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},a.prototype.utarget=function(a){return(a=a.replace("#",""))+"-"+this.uuid()},a.prototype.toLower=function(a){return a.replace(" ","_").toLowerCase()},a}()}.call(this),function(){var a=[].slice;window.Plotter||(window.Plotter={}),window.Plotter.LinePlot=function(){function b(b,c,d){var e,f,g;this.preError="LinePlot.",this.plotter=b,this.initialized=!1,g=[{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,maxBar:null,color:"rgb(41, 128, 185)",band:{minVariable:null,maxVariable:null}}],this.defaults={plotId:null,uuid:"",debug:!0,target:null,width:null,merge:!1,decimals:1,x:{variable:null,format:"%Y-%m-%dT%H:%M:%S-08:00",min:null,max:null,ticks:7},y:g,zoom:{scale:{min:.03,max:5}},aspectDivisor:5,transitionDuration:500,weight:2,axisColor:"rgb(0,0,0)",font:{weight:100,size:14},crosshairX:{weight:1,color:"rgb(149,165,166)"},requestInterval:336},d.x&&(d.x=this.plotter.lib.mergeDefaults(d.x,this.defaults.x)),d.y[0]=this.plotter.lib.mergeDefaults(d.y[0],this.defaults.y[0]),this.options=this.plotter.lib.mergeDefaults(d,this.defaults),this.device="full",this.transform=d3.zoomIdentity,this.links=[{variable:"battery_voltage",title:"Battery Voltage"},{variable:"temperature",title:"Temperature"},{variable:"relative_humidity",title:"Relative Humidity"},{variable:"precipitation",title:"Precipitation"},{variable:"snow_depth",title:"Snow Depth"},{variable:"wind_direction",title:"Wind Direction"},{variable:"wind_speed_average",title:"Wind Speed"},{variable:"net_solar",title:"Net Solar"},{variable:"solar_pyranometer",title:"Solar Pyranometer"},{variable:"equip_temperature",title:"Equipment Temperature"},{variable:"barometric_pressure",title:"Barometric Pressure"},{variable:"snowfall_24_hour",title:"24-Hr Snowfall"},{variable:"intermittent_snow",title:"Intermittent Snow"}],this.log=function(){1<=arguments.length&&a.call(arguments,0)},this.options.debug&&(this.log=function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],console.log(b)}),this.parseDate=d3.timeParse(this.options.x.format),this.bisectDate=d3.bisector(function(a){return a.x}).left,this.displayDate=d3.timeFormat("%b. %e, %I:%M %p"),this.sortDatetimeAsc=function(a,b){return a.x-b.x},this.data=this.processData(c),this.getDefinition(),this.clipPathId="line-plot-clip-path-"+this.plotter.lib.uuid(),this.bands=[],this.lines=[],this.focusCircle=[],this.focusText=[],this.skipBandDomainSet=!1,f=null,e=null,c.length>0&&(f=this.getDomainScale(this.definition.x),e=this.getDomainMean(this.definition.x)),this.state={range:{data:[],scale:f},length:{data:[]},interval:{data:[]},zoom:1,request:{data:[]},requested:{data:[]},mean:{scale:e}},c[0].length>0&&(this.setDataState(),this.setIntervalState(),this.setDataRequirement())}return b.prototype.processData=function(a){var b,c,d;b=[];for(d in a)c=a[d],b[d]=this.processDataSet(c,d);return b},b.prototype.processDataSet=function(a,b){var c,d,e,f,g;d=this.options.y[b],f=[];for(e in a)g=a[e],f[e]={x:new Date(this.parseDate(g[this.options.x.variable]).getTime()),y:g[d.variable]},null!=d.band&&(d.band.minVariable&&(f[e].yMin=g[d.band.minVariable]),d.band.maxVariable&&(f[e].yMax=g[d.band.maxVariable]));return c=new Plotter.Data(f),f=c._clean(c.get()),f.sort(this.sortDatetimeAsc)},b.prototype.setData=function(a){var b,c;if(this.data=[this.processDataSet(a,0)],this.getDefinition(),c=null,b=null,a.length>0&&(c=this.getDomainScale(this.definition.x),b=this.getDomainMean(this.definition.x)),this.state.range.scale=c,this.state.mean.scale=b,a.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},b.prototype.addData=function(a,b){var c,d;if(this.data[b]=this.processDataSet(a,b),this.getDefinition(),d=null,c=null,a.length>0&&(d=this.getDomainScale(this.definition.x),c=this.getDomainMean(this.definition.x)),this.state.range.scale=d,this.state.mean.scale=c,a.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},b.prototype.appendData=function(a,b){var c,d;if(c=this.processDataSet(a,b),d=new window.Plotter.Data(this.data[b]),d.append(c,["x"]),this.data[b]=d._clean(d.get()),this.data[b]=this.data[b].sort(this.sortDatetimeAsc),this.initialized)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},b.prototype.removeData=function(a){if(a>=0&&(delete this.data[a],delete this.options[a],this.svg.select(".line-plot-area-"+a).remove(),this.svg.select(".line-plot-path-"+a).remove(),this.svg.select(".focus-circle-"+a).remove(),this.svg.select(".focus-text-"+a).remove(),this.initialized))return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},b.prototype.setDataState=function(){var a,b,c;this.data.length,b=this.data,c=[];for(a in b)b[a],this.state.range.data[a]={min:d3.min(this.data[a],function(a){return a.x}),max:d3.max(this.data[a],function(a){return a.x})},c.push(this.state.length.data[a]=this.data[a].length);return c},b.prototype.setIntervalState=function(){var a,b,c;b=this.data,c=[];for(a in b)b[a],c.push(this.state.interval.data[a]={min:(this.state.range.scale.min.getTime()-this.state.range.data[a].min.getTime())/36e5,max:(this.state.range.data[a].max.getTime()-this.state.range.scale.max.getTime())/36e5});return c},b.prototype.setDataRequirement=function(){var a,b,c,d;new Date,c=this.data,d=[];for(b in c)c[b],a=this.state.interval.data[b].max<this.options.requestInterval,this.state.request.data[b]={min:this.state.interval.data[b].min<this.options.requestInterval,max:a},null==this.state.requested.data[b]?d.push(this.state.requested.data[b]={min:!1,max:!1}):d.push(void 0);return d},b.prototype.setZoomState=function(a){return this.state.zoom=a},b.prototype.getDomainScale=function(a){return{min:a.domain()[0],max:a.domain()[1]}},b.prototype.getDomainMean=function(a){var b;return b=new Date(d3.mean(a.domain())),b.setHours(b.getHours()+Math.round(b.getMinutes()/60)),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0),b},b.prototype.setBandDomain=function(a){return this.definition.x1=a},b.prototype.getDefinition=function(){var a,b;return this.preError+"getDefinition():",a=this,this.definition={},this.calculateChartDims(),this.calculateAxisDims(this.data),this.definition.xAxis=d3.axisBottom().scale(this.definition.x).ticks(Math.round(this.definition.dimensions.width/100)),this.definition.yAxis=d3.axisLeft().scale(this.definition.y).ticks(this.options.y[0].ticks),this.definition.x.domain([this.definition.x.min,this.definition.x.max]),this.skipBandDomainSet||(this.definition.x1.domain(this.data[0].map(function(a){return a.x})),this.skipBandDomainSet=!1),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),b=[[-1/0,0],[this.definition.x(new Date)+this.definition.dimensions.margin.left,this.definition.dimensions.innerHeight]],this.definition.zoom=d3.zoom().scaleExtent([this.options.zoom.scale.min,this.options.zoom.scale.max]).translateExtent(b).on("zoom",function(){var b;if(void 0!==d3.event&&null!=d3.event.sourceEvent&&("mousemove"!==(b=d3.event.sourceEvent.type)&&"wheel"!==b&&"touchmove"!==b||a.plotter.i.zoom.set(d3.event.transform,a.options.plotId),"zoom"===d3.event.sourceEvent.type))return a.drawZoomTransform(d3.event.transform)}),this.definition.line=d3.line().defined(function(a){return!isNaN(a.y)&&null!==a.y}).x(function(b){return a.definition.x(b.x)}).y(function(b){return a.definition.y(b.y)}),this.definition.area=d3.area().defined(function(a){return!isNaN(a.yMin)&&null!==a.yMin&&!isNaN(a.yMax)&&null!==a.yMax}).x(function(b){return a.definition.x(b.x)}).y0(function(b){return a.definition.y(b.yMin)}).y1(function(b){return a.definition.y(b.yMax)})},b.prototype.calculateChartDims=function(){var a,b,c,d;return d=null!=this.options.width?Math.round(this.options.width):Math.round($(this.options.target).width())-24,b=Math.round(d/this.options.aspectDivisor),d>900?(this.device="large",this.definition.font={size:this.options.font.size/1.2},c={top:Math.round(.04*b),right:Math.round(Math.pow(d,.3)),bottom:20,left:45}):d>400?(this.device="mid",this.definition.font={size:this.options.font.size/1.5},a=this.options.aspectDivisor/1.4,b=Math.round(d/a),c={top:Math.round(.04*b),right:Math.round(Math.pow(d,.3)),bottom:18,left:38}):(this.device="small",this.definition.font={size:this.options.font.size/1.6},a=this.options.aspectDivisor/2.2,b=Math.round(d/a),c={top:35,right:Math.round(Math.pow(d,.3)),bottom:17,left:33}),this.definition.dimensions={width:d,height:b,margin:c},this.definition.dimensions.topPadding=parseInt(this.definition.dimensions.margin.top),this.definition.dimensions.bottomPadding=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom),this.definition.dimensions.leftPadding=parseInt(this.definition.dimensions.margin.left),this.definition.dimensions.innerHeight=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom-this.definition.dimensions.margin.top),this.definition.dimensions.innerWidth=parseInt(this.definition.dimensions.width-this.definition.dimensions.margin.left-this.definition.dimensions.margin.right),this.definition.x=d3.scaleTime().range([c.left,d-c.right]),this.definition.x1=d3.scaleBand().rangeRound([c.left,d-c.right],.05).padding(.1),this.definition.y=d3.scaleLinear().range([b-c.bottom,c.top])},b.prototype.calculateAxisDims=function(a){return this.calculateXAxisDims(a),this.calculateYAxisDims(a)},b.prototype.calculateXAxisDims=function(a){return null===this.options.x.min?this.definition.x.min=d3.min(a[0],function(a){return a.x}):this.definition.x.min=this.parseDate(this.options.x.min),null===this.options.x.max?this.definition.x.max=d3.max(a[0],function(a){return a.x}):this.definition.x.max=this.parseDate(this.options.x.max)},b.prototype.calculateYAxisDims=function(a){var b,c,d,e;this.definition.y.min=0,this.definition.y.max=0;for(e in a)d=a[e],c=d3.min([d3.min(d,function(a){
return a.y}),d3.min(d,function(a){return a.yMin})]),b=d3.max([d3.max(d,function(a){return a.y}),d3.max(d,function(a){return a.yMax})]),(c<this.definition.y.min||void 0===this.definition.y.min)&&(this.definition.y.min=c),(b>this.definition.y.max||void 0===this.definition.y.max)&&(this.definition.y.max=b);if(this.definition.y.min===this.definition.y.max&&(this.definition.y.min=.8*this.definition.y.min,this.definition.y.max=1.2*this.definition.y.min),null!=this.options.y[0].min&&(this.definition.y.min=this.options.y[0].min),null!=this.options.y[0].max)return this.definition.y.max=this.options.y[0].max},b.prototype.resize=function(){var a,b;this.getDefinition(),this.outer.style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px"),this.ctls.style("height",this.definition.dimensions.height+"px"),this.svg.attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.select("#"+this.clipPathId).select("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.select(".line-plot-axis-x").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.select(".line-plot-axis-y").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)"),this.svg.select(".line-plot-y-label").attr("x",-this.definition.dimensions.margin.top).attr("y",-this.definition.dimensions.margin.left).style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight),b=this.data;for(a in b)b[a],this.svg.select(".line-plot-area-"+a).attr("d",this.definition.area),this.svg.select(".line-plot-path-"+a).attr("d",this.definition.line).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1)));return null!=this.options.y[0].maxBar&&this.lineWrapper.select(".line-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(this.options.y[0].maxBar)).attr("width",this.definition.dimensions.innerWidth),this.overlay.select(".overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.overlay.select(".zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")")},b.prototype.preAppend=function(){return this.preError+"preAppend()",this,this.outer=d3.select(this.options.target).append("div").attr("class","line-plot-body").style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px").style("display","inline-block"),this.ctls=d3.select(this.options.target).append("div").attr("class","plot-controls").style("width","23px").style("height",this.definition.dimensions.height+"px").style("display","inline-block").style("vertical-align","top"),this.svg=this.outer.append("svg").attr("class","line-plot").attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.append("defs").append("clipPath").attr("id",this.clipPathId).append("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.append("g").attr("class","line-plot-axis-x").style("fill","none").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.append("g").attr("class","line-plot-axis-y").style("fill","none").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)")},b.prototype.append=function(){var a,b,c,d,e,f;if(this.initialized=!0,this.initialized){this.preError+"append()",a=this,this.svg.select(".line-plot-axis-x").call(this.definition.xAxis),this.svg.select(".line-plot-axis-y").call(this.definition.yAxis),b=""+this.options.y[0].title,this.options.y[0].units&&(b=b+" "+this.options.y[0].units),this.svg.select(".line-plot-axis-y").append("text").text(b).attr("fill",this.options.axisColor).attr("class","line-plot-y-label").attr("x",-this.definition.dimensions.margin.top).attr("y",-this.definition.dimensions.margin.left).attr("dy",".75em").attr("transform","rotate(-90)").style("font-size",this.definition.font.size).style("font-weight",this.options.font.weight),this.lineWrapper=this.svg.append("g").attr("class","line-wrapper"),d=this.data;for(c in d)f=d[c],this.bands[c]=this.lineWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").append("path").datum(f).attr("d",this.definition.area).attr("class","line-plot-area-"+c).style("fill",this.options.y[c].color).style("opacity",.15).style("stroke",function(){return d3.color(a.options.y[c].color).darker(1)}),this.lines[c]=this.lineWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").append("path").datum(f).attr("d",this.definition.line).attr("class","line-plot-path-"+c).style("stroke",this.options.y[c].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none");null!=this.options.y[0].maxBar&&this.lineWrapper.append("rect").attr("class","line-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(this.options.y[0].maxBar)).attr("width",this.definition.dimensions.innerWidth).attr("height",1).style("color","#gggggg").style("opacity",.4),this.hoverWrapper=this.svg.append("g").attr("class","hover-wrapper"),this.crosshairs=this.hoverWrapper.append("g").attr("class","crosshair"),this.crosshairs.append("line").attr("class","crosshair-x").style("stroke",this.options.crosshairX.color).style("stroke-width",this.options.crosshairX.weight).style("stroke-dasharray","3, 3").style("fill","none"),this.crosshairs.append("rect").attr("class","crosshair-x-under").style("fill","rgb(255,255,255)").style("opacity",.1),this.focusDateText=this.hoverWrapper.append("text").attr("class","focus-date-text").attr("x",9).attr("y",7).style("display","none").style("fill","#000000").style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),e=this.data;for(c in e)f=e[c],this.focusCircle[c]=this.hoverWrapper.append("circle").attr("r",4).attr("class","focus-circle-"+c).attr("fill",this.options.y[c].color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText[c]=this.hoverWrapper.append("text").attr("class","focus-text focus-text-"+c).attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y[c].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)");return this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(this.transform),this.appendZoomTarget(this.transform)}},b.prototype.update=function(){var a,b,c,d,e;this.preError,a=this,c=this.data;for(b in c)null!=(e=c[b])&&null!=a.options.y[b]&&(null===this.svg.select(".line-plot-area-"+b).node()?this.bands[b]=this.lineWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").append("path").datum(e).attr("d",this.definition.area).attr("class","line-plot-area-"+b).style("fill",this.options.y[b].color).style("opacity",.15).style("stroke",function(){return d3.color(a.options.y[b].color).darker(1)}):this.svg.select(".line-plot-area-"+b).datum(e).attr("d",this.definition.area).style("fill",this.options.y[b].color).style("stroke",function(){return d3.rgb(a.options.y[b].color).darker(1)}),null===this.svg.select(".line-plot-path-"+b).node()?(this.lines[b]=this.lineWrapper.append("g").attr("clip-path","url(#"+this.clipPathId+")").append("path").datum(e).attr("d",this.definition.line).attr("class","line-plot-path-"+b).style("stroke",this.options.y[b].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.focusCircle[b]=this.hoverWrapper.append("circle").attr("r",4).attr("class","focus-circle-"+b).attr("fill",this.options.y[b].color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText[b]=this.hoverWrapper.append("text").attr("class","focus-text focus-text-"+b).attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y[b].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)")):this.svg.select(".line-plot-path-"+b).datum(e).attr("d",this.definition.line).style("stroke",this.options.y[b].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"));this.overlay.remove(),this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(this.transform),this.calculateYAxisDims(this.data),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),d=this.data;for(b in d)e=d[b],this.svg.select(".line-plot-area-"+b).datum(e).attr("d",this.definition.area),this.svg.select(".line-plot-path-"+b).datum(e).attr("d",this.definition.line);return this.svg.select(".line-plot-axis-y").call(this.definition.yAxis),null!=this.options.y[0].maxBar&&this.lineWrapper.select(".line-plot-max-bar").attr("y",this.definition.y(this.options.y[0].maxBar)),this.drawZoomTransform(this.transform)},b.prototype.appendCrosshairTarget=function(a){var b;if(this.initialized)return this.preError+"appendCrosshairTarget()",b=this,this.overlay.datum(this.data).attr("class","overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").on("mouseover",function(){return b.plotter.i.crosshairs.show()}).on("mouseout",function(){return b.plotter.i.crosshairs.hide()}).on("mousemove",function(){var c;return c=b.setCrosshair(a),b.plotter.i.crosshairs.set(a,c)})},b.prototype.appendZoomTarget=function(){if(this.initialized)return this.preError+"appendZoomTarget()",this,this.overlay.attr("class","zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").style("cursor","move"),this.svg.call(this.definition.zoom)},b.prototype.setZoomTransform=function(a){if(this.initialized)return this.preError+".setZoomTransform(transform)",a?(this.transform=a,this.svg.call(this.definition.zoom.transform,a),a):void 0},b.prototype.drawZoomTransform=function(a){var b,c,d,e;if(this.initialized){this.preError+".drawZoomTransform()",b=this,c=a.rescaleX(this.definition.x),this.svg.select(".line-plot-axis-x").call(this.definition.xAxis.scale(c),a),this.state.range.scale=this.getDomainScale(c),this.state.mean.scale=this.getDomainMean(c),this.setDataState(),this.setIntervalState(),this.setDataRequirement(),this.setZoomState(a.k),this.definition.area=d3.area().defined(function(a){return!isNaN(a.yMin)&&null!==a.yMin&&!isNaN(a.yMax)&&null!==a.yMax}).x(function(c){return a.applyX(b.definition.x(c.x))}).y0(function(a){return b.definition.y(a.yMin)}).y1(function(a){return b.definition.y(a.yMax)}),this.definition.line=d3.line().defined(function(a){return!isNaN(a.y)&&null!==a.y}).x(function(c){return a.applyX(b.definition.x(c.x))}).y(function(a){return b.definition.y(a.y)}),e=this.data;for(d in e)e[d],this.svg.select(".line-plot-area-"+d).attr("d",this.definition.area),this.svg.select(".line-plot-path-"+d).attr("d",this.definition.line);return this.appendCrosshairTarget(a)}},b.prototype.setCrosshair=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(this.initialized){this.preError+".setCrosshair(mouse)",c=this,f=this.definition.dimensions,l=function(a){switch(!1){case!(a>360||a<0):return"INV";case!(a>=0&&a<11.25):return"N";case!(a>=11.25&&a<33.75):return"NNE";case!(a>=33.75&&a<56.25):return"NE";case!(a>=56.25&&a<78.75):return"ENE";case!(a>=78.75&&a<101.25):return"E";case!(a>=101.25&&a<123.75):return"ESE";case!(a>=123.75&&a<146.25):return"SE";case!(a>=146.25&&a<168.75):return"SSE";case!(a>=168.75&&a<191.25):return"S";case!(a>=191.25&&a<213.75):return"SSW";case!(a>=213.75&&a<236.25):return"SW";case!(a>=236.25&&a<258.75):return"WSW";case!(a>=258.75&&a<281.25):return"W";case!(a>=281.25&&a<303.75):return"WNW";case!(a>=303.75&&a<326.25):return"NW";case!(a>=326.25&&a<348.75):return"NNW";case!(a>=348.75&&a<=360):return"N"}},s=this.data;for(r in s)t=s[r],g=this.overlay.node(),e=t,b=b||d3.mouse(g),v=this.definition.x.invert(b[0]+f.leftPadding),a&&(v=this.definition.x.invert(a.invertX(b[0]+f.leftPadding))),q=c.bisectDate(e,v,1),p=v.getMinutes()>=30?q:q-1,v.getTime()<=this.state.range.data[r].min.getTime()&&(p=q),v.getTime()>=this.state.range.data[r].max.getTime()&&(p=q-1),k=b[0],this.crosshairs.select(".crosshair-x").attr("x1",k).attr("y1",f.topPadding).attr("x2",k).attr("y2",f.innerHeight+f.topPadding).attr("transform","translate("+f.leftPadding+", 0)"),this.crosshairs.select(".crosshair-x-under").attr("x",k).attr("y",f.topPadding).attr("width",f.innerWidth-k).attr("height",f.innerHeight).attr("transform","translate("+f.leftPadding+", 0)"),i=this.definition.x.invert(b[0]+f.leftPadding),a&&(i=this.definition.x.invert(a.invertX(b[0]+f.leftPadding))),h=this.displayDate(this.plotter.i.crosshairs.roundDate(i)),o=b[0]-120,this.focusDateText.attr("x",o).attr("y",f.topPadding+f.innerHeight-3).attr("transform","translate("+f.leftPadding+", 0)").text(h),null!=e[p]&&(d=Math.abs(e[p].x.getTime()-v.getTime())>25e5,m=a?a.applyX(this.definition.x(e[p].x)):this.definition.x(e[p].x),n=[],j=[],null!==this.options.y[r].variable&&(j[r]=e[p],null!=j[r]&&(n[r]=this.definition.y(j[r].y),this.displayDate(j[r].x),isNaN(n[r])||null==j[r].y||void 0===j[r].y||!1!==d||this.focusCircle[r].attr("transform","translate(0, 0)"),d?this.focusCircle[r].style("display","none"):this.focusCircle[r].style("display",null))),m-f.leftPadding>=0&&(null===this.options.y[r].variable||isNaN(n[r])||null==j[r].y||void 0===j[r].y||(this.focusCircle[r].attr("cx",m).attr("cy",n[r]),u="start",this.focusText[r].attr("x",m+f.leftPadding/10).attr("y",n[r]-f.topPadding/10).attr("text-anchor",u).text(j[r].y?"wind_direction"===c.options.y[0].variable?l(j[r].y):j[r].y.toFixed(this.options.decimals)+" "+this.options.y[r].units:void 0),d?this.focusText[r].style("display","none"):this.focusText[r].style("display",null))));return void 0!==this.options.y[1]&&(w=[],this.svg.selectAll(".focus-text").attr("transform",function(a,b){return t={ind:b,y:parseInt(d3.select(this).attr("y")),offset:0},w.push(t),""}).call(function(a){return w.sort(function(a,b){return a.y-b.y}),w.forEach(function(a,b){var c,d;if(b>0)return d=0,w[b].y<w[b-1].y+w[b-1].offset&&(d=w[b-1].y+w[b-1].offset-w[b].y),c=Math.max(0,w[b-1].y+w[b-1].offset+18-(w[b].y+d)),w[b].offset=c+d})}).attr("transform",function(a,b){var d;return d=c.plotter.lib.indexOfValue(w,"ind",b),"translate (0, "+w[d].offset+")"})),b}},b.prototype.showCrosshair=function(){var a,b,c,d;if(this.initialized){this.crosshairs.select(".crosshair-x").style("display",null),this.crosshairs.select(".crosshair-x-under").style("display",null),this.focusDateText.style("display",null),a=this.options.y,b=[];for(d in a)c=a[d],null!==c.variable?(null!=this.focusCircle[d]&&this.focusCircle[d].style("display",null).attr("fill",c.color),null!=this.focusText[d]?b.push(this.focusText[d].style("display",null).style("color",c.color).style("fill",c.color)):b.push(void 0)):b.push(void 0);return b}},b.prototype.hideCrosshair=function(){var a,b,c,d;if(this.initialized){this.crosshairs.select(".crosshair-x").style("display","none"),this.crosshairs.select(".crosshair-x-under").style("display","none"),this.focusDateText.style("display","none"),a=this.options.y,b=[];for(d in a)c=a[d],null!==c.variable?(null!=this.focusCircle[d]&&this.focusCircle[d].style("display","none"),null!=this.focusText[d]?b.push(this.focusText[d].style("display","none")):b.push(void 0)):b.push(void 0);return b}},b.prototype.appendTitle=function(a,b){var c,d,e;if(d=1,c="16px",e="12px","small"===this.device&&(d=.4,c="10px",e="7px"),this.title=this.svg.append("g").attr("class","line-plot-title"),this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2-4*d).style("font-size",c).style("font-weight",600).text(a),b)return this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2+12*d).style("font-size",e).text(b)},b.prototype.getState=function(){return this.state},b}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.LiveSync=function(){function a(a){this.preError="Plotter.LiveSync",this.plotter=a,this.api=this.plotter.i.api,this.requests={},this.endpoint=function(){return this.plotter.options.href+"/api/v5/measurement"}}return a.prototype.append=function(a,b,c){var d,e,f,g,h,i,j,k,l;return d=new Date,f=d.getTimezoneOffset()/60,e=new Date(d.getTime()-36e5*f),c.range.data[b].max>=e||(i=this.plotter.options.updateLength,h=c.range.data[b].max.getTime(),k=new Date(h+36e5*this.plotter.options.updateLength),k>e&&(i=Math.round((k.getTime()-e.getTime())/36e5)),j=this.plotter.lib.format(new Date(k)),i<this.plotter.options.minUpdateLength||(g=this.plotter.i.template.forSync(a,b,j,i),l=this.plotter.lib.uuid(),this.requests[l]={ready:!1,requested:!1},this.requests[l].requested=this.get(a,b,l,g,"max")))},a.prototype.prepend=function(a,b,c){var d,e,f,g;return f=this.plotter.lib.format(c.range.data[b].min),e=this.plotter.options.updateLength,d=this.plotter.i.template.forSync(a,b,f,e),g=this.plotter.lib.uuid(),this.requests[g]={ready:!1,requested:!1},this.requests[g].requested=this.get(a,b,g,d,"min")},a.prototype.add=function(a,b,c){var d,e,f,g,h;return d=new Date,c.range.data[0].max>=d||(g=this.plotter.lib.format(c.range.data[0].max),f=c.length.data[0],e=this.plotter.i.template.forSync(a,b,g,f),h=this.plotter.lib.uuid(),this.requests[h]={ready:!1,requested:!1},this.requests[h].requested=this.getNew(a,b,h,e))},a.prototype.get=function(a,b,c,d,e){var f,g,h,i;return h=this.preError+".get()",i=this.endpoint(),f=this,g=function(d){var g,i;if(g=f.plotter.plots[a].proto,null==d.responseJSON)throw new Error(h+" error requesting data.");if(i=d.responseJSON.results,void 0===f.plotter.plots[a].__data__)throw new Error(h+" appending to empty data set.");if(0===d.responseJSON.results.length)throw new Error(h+" no new data found.");return g.appendData(i,b),g.update(),f.requests[c].ready=!0,g.state.requested.data[b][e]=!1,f.plotter.updates=f.plotter.updates<0?0:f.plotter.updates-1},this.api.get(i,d,g),!0},a.prototype.getNew=function(a,b,c,d){var e,f,g,h;return g=this.preError+".getNew()",h=this.endpoint(),e=this,f=function(d){var f,h;if(f=e.plotter.plots[a].proto,null==d.responseJSON)throw new Error(g+" error requesting data.");if(h=d.responseJSON.results,void 0===e.plotter.plots[a].__data__)throw new Error(g+" appending to empty data set.");if(0===d.responseJSON.results.length)throw new Error(g+" no new data found.");return f.addData(h,b),f.update(),e.requests[c].ready=!0,e.plotter.i.controls.removeSpinner(a),e.plotter.updates=e.plotter.updates<0?0:e.plotter.updates-1},this.api.get(h,d,f),!0},a}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Now=function(){function a(a,b){return this.parse=function(b){var c,d;return b.indexOf("now")>=0&&(d=new Date,b.indexOf("(")>=0&&(c=parseInt(b.replace("(","").replace(")","").replace("now","")),d=new Date(d.getTime()+36e5*c)),b=a(d)),b},this.datetime=this.parse(b),this.datetime}return a.prototype.set=function(a){return this.datetime=this.parse(a),!0},a.prototype.get=function(){return this.datetime},a}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Handler=function(){function a(a,b,c){var d,e,f,g,h,i;this.preError="Plotter.Handler",f=b.dateFormat?b.dateFormat:"%Y-%m-%dT%H:%M:%S-08:00",g={dateFormat:f},this.lib=new window.Plotter.Library(g),e=location.origin.indexOf(":5000")>=0?"http://dev.nwac.us":location.origin,i={templateId:null,uuid:null,localId:this.lib.uuid(),href:e,target:null,dateFormat:"%Y-%m-%dT%H:%M:%S-08:00",refresh:500,futureWait:18e4,updateLength:168,initialLength:168,requestPaddingInterval:336,newDataInterval:168,minUpdateLength:0,updateLimit:6,width:null,responsive:!1},this.options=this.lib.mergeDefaults(b,i),this.waitCounter=parseInt(this.options.futureWait/this.options.refresh),this.refreshCounter=0,d={token:null,csrfToken:null,admin:!1},h=this.lib.mergeDefaults(a,d),this.isAdmin=function(){return h.admin},this.i={api:new window.Plotter.API(h),sapi:new window.Plotter.API(h,!1)},this.i.template=new window.Plotter.Template(this),this.i.controls=new window.Plotter.Controls(this),this.i.initialsync=new window.Plotter.InitialSync(this),this.i.livesync=new window.Plotter.LiveSync(this),this.i.zoom=new window.Plotter.Zoom(this),this.i.crosshairs=new window.Plotter.Crosshairs(this),this.i.specs=new window.Plotter.Specs,this.i.colors=new window.Plotter.Colors,this.plots=[],this.legends=[],this.updates=0,this.bandDomain=null,this.isReady=function(){return this.updates<=this.options.updateLimit}}return a.prototype.initialize=function(){var a,b;return this.i.template.get(),this.appendLoading(),this.initializePlots(),this.i.initialsync.stageAll(),a=this,(b=function(){return a.i.initialsync.isReady()?(a.append(),a.removeLoading(),a.listen()):(setTimeout(b,100),!0)})()},a.prototype.initializePlots=function(){var a,b,c,d;b=this.i.template.full(),d=[];for(c in b)b[c],a={proto:null,__data__:[]},d.push(this.plots[c]=a);return d},a.prototype.listen=function(a){var b,c,d,e,f,g,h,i;this.refreshCounter++,f=this.plots;for(e in f)if(null!=(d=f[e])&&d.proto.initialized){i=d.proto.getState(),g=i.request.data;for(c in g)h=g[c],!0===h.min&&this.isReady()&&!1===d.proto.state.requested.data[c].min&&(this.updates++,d.proto.state.requested.data[c].min=!0,this.i.livesync.prepend(e,c,i)),b=new Date,(this.refreshCounter%this.waitCounter==0||d.proto.state.range.data[0].max.getTime()<b.getTime()-36e5*this.options.newDataInterval)&&!0===h.max&&this.isReady()&&!1===d.proto.state.requested.data[c].max&&(this.updates++,d.proto.state.requested.data[c].max=!0,this.i.livesync.append(e,c,i))}if(!a)return setTimeout(Plotter.Handler.prototype.listen.bind(this),this.options.refresh)},a.prototype.append=function(){var a,b,c,d,e;a=this,d=this.plots;for(c in d)e=d[c],e.uuid=this.lib.uuid(),$(this.options.target).append('<div id="outer-'+e.uuid+'"></div>'),b=this.i.template.forPlots(c),b=this.i.colors.getInitial(b),b.target="#outer-"+e.uuid,b.requestInterval=this.options.requestPaddingInterval,b.uuid=e.uuid,null!=this.options.width&&(b.width=this.options.width),"bar"===b.plotType?e.proto=new window.Plotter.BarPlot(this,e.__data__,b):e.proto=new window.Plotter.LinePlot(this,e.__data__,b),e.proto.preAppend(),e.proto.append(),this.i.controls.append(c),this.legends[c]=new window.Plotter.Legend(this,c);if(this.bandDomain=this.plots[0].proto.definition.x1,this.appendSave(),this.appendPoweredBy(),this.options.responsive)return this.__windowWidth=$(window).width(),$(window).on("resize",function(){return a.resize()})},a.prototype.appendLoading=function(){return $(this.options.target).append('<div class="plotter-loading" style="text-align: center; "> <span> <i class="icon-spinner icon-spin icon-large"></i> Loading Plots... </span> </div>')},a.prototype.removeLoading=function(){return $(this.options.target).find(".plotter-loading").remove()},a.prototype.remove=function(a){return $(this.plots[a].proto.options.target).fadeOut(500,function(){return $(this).remove()}),this.i.template.removePlot(a),delete this.plots[a]},a.prototype.move=function(a,b){var c,d,e,f,g,h;if(f=this.i.template.template,d=f[a],c=d.pageOrder,h=$(this.plots[a].proto.options.target),"up"===b){if(c>1)return g=this.lib.indexOfValue(f,"pageOrder",c-1),e=f[g],d.pageOrder--,e.pageOrder++,h.prev().insertAfter(h)}else if("down"===b&&c<f.length)return g=this.lib.indexOfValue(f,"pageOrder",c+1),e=f[g],d.pageOrder++,e.pageOrder--,h.next().insertBefore(h)},a.prototype.add=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(o=this.lib.uuid(),g="outer-"+o,l={width:this.options.width,pageOrder:this.i.template.plotCount()+1,type:a,target:"#"+g,requestInterval:this.options.requestPaddingInterval,y:[]},i='<div id="'+g+'"></div>',$(this.options.target).append(i),d=this.i.template.add(l),this.plots[d]={},e=this.i.specs.getPlotType(b),"precipitation_line"===b&&(b="precipitation",e="line"),c=this.i.specs.getPlotDecimals(b),this.plots[d].proto="bar"===e?new window.Plotter.BarPlot(this,[[]],l):new window.Plotter.LinePlot(this,[[]],l),this.plots[d].proto.preAppend(),this.plots[d].proto.options.plotType=e,this.plots[d].proto.options.plotId=d,this.plots[d].proto.options.uuid=o,this.plots[d].proto.options.decimals=c,this.appendSave(),h=this.i.specs.getOptions(b,null),m=this.i.template.template,j=0,k=m.length;j<k;j++)if(void 0!==(n=m[j])){this.i.template.template[d].x=$.extend(!0,{},n.x);break}return this.i.template.template[d].y=[h],f=this.i.template.forPlots(d),this.plots[d].proto.options.x=f.x,this.plots[d].proto.options.y=f.y,this.i.controls.append(d)},a.prototype.addStation=function(a,b){var c,d,e;return this.plots[a].proto.initialized?"bar"===this.plots[a].proto.options.plotType?(this.i.controls.removeSpinner(a),alert("Bar plots only support one station. Please add a new Precipitation Line Plot to view multiple stations."),!1):(c=this.plots[a].proto.getState(),c.range.data[0].max.getTime(),d=$.extend(!0,{},this.plots[a].proto.options.y[0]),d.dataLoggerId=b,d.color=this.i.colors.get(b),e=this.plots[a].proto.options.y.push(d)-1,this.i.controls.updateStationDropdown(a),this.i.controls.updateStationMap(a),this.i.livesync.add(a,e,c),!0):(this.plots[a].proto.options.y[0].dataLoggerId=b,this.plots[a].proto.options.y[0].color=this.i.colors.get(b),this.i.initialsync.add(a),this.i.controls.updateStationDropdown(a),this.i.controls.updateStationMap(a),!0)},a.prototype.removeStation=function(a,b){var c;return c=this.lib.indexOfValue(this.plots[a].proto.options.y,"dataLoggerId",b),c>0&&(delete this.i.template.template[a].y[c],this.plots[a].proto.removeData(c),this.plots[a].proto.getDefinition(),this.plots[a].proto.update(),this.i.controls.updateStationDropdown(a),this.i.controls.updateStationMap(a)),this.i.controls.removeSpinner(a)},a.prototype.appendSave=function(){var a;if(a=this,$("#save-"+this.options.localId).parent().remove(),this.isAdmin()||null!=this.options.uuid)return $(this.options.target).prepend('<small><a style="cursor:pointer" id="save-'+this.options.localId+'">Save Graph</a></small>'),$("#save-"+this.options.localId).on("click",function(b){var c;return c=": Last Saved: "+a.lib.getNowDisplay(),"Save Graph"===$("#save-"+a.options.localId).html()?this.append(c):$("#save-"+a.options.localId).html("Save Graph"+c),a.i.template.put()})},a.prototype.appendPoweredBy=function(){return $(this.options.target).parent().append('<p style="font-size: 11px; font-weight: 300">Powered by Air Sciences Inc. | <a href="http://airsci.com">www.airsci.com</a></p>')},a.prototype.resize=function(){var a,b,c,d,e,f;e=this.plots,f=[];for(d in e)c=e[d],a=c.proto.definition.dimensions.width,c.proto.resize(),b=c.proto.definition.dimensions.width/a,this.legends[d].resize(),this.i.controls.resize(d),c.proto.setZoomTransform(this.i.zoom.scale(b,c.proto.transform)),f.push(c.proto.drawZoomTransform(c.proto.transform));return f},a}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Specs=function(){function a(){}return a.prototype.getOptions=function(a,b){var c,d;return c=this.getVariableBounds(a),d=this.getVariableInfo(a),{dataLoggerId:b,variable:a,plotType:this.getPlotType(a),min:c.min,max:c.max,maxBar:c.maxBar,title:d.title,units:d.units}},a.prototype.getVariableBounds=function(a){var b;return b={battery_voltage:{min:8,max:16,maxBar:null},temperature:{min:null,max:null,maxBar:32},equip_temperature:{min:null,max:null,maxBar:null},relative_humidity:{min:0,max:100,maxBar:null},net_solar:{min:0,max:800,maxBar:null},snow_depth:{min:0,max:200,maxBar:null},snowfall_24_hour:{min:0,max:24,maxBar:null},intermittent_snow:{min:0,max:null,maxBar:null},wind_direction:{min:0,max:350,maxBar:null},precipitation:{min:0,max:.35,maxBar:null},wind_speed_average:{min:0,max:null,maxBar:null},solar_pyranometer:{min:0,max:null,maxBar:null},barometric_pressure:{min:950,max:1050,maxBar:null}},b[a]},a.prototype.getVariableInfo=function(a){var b;return b={battery_voltage:{title:"Battery Voltage",units:"V"},net_solar:{title:"Solar Radiation",units:"W/m2"},solar_pyranometer:{title:"Solar Pyranometer",units:"W/m2"},relative_humidity:{title:"Relative Humidity",units:"%"},barometric_pressure:{title:"Barometric Pressure",units:"mb"},snow_depth:{title:"Snow Depth",units:'"'},snowfall_24_hour:{title:"24-Hour Snowfall",units:'"'},intermittent_snow:{title:"Intermittent Snow",units:'"'},wind_direction:{title:"Wind Direction",units:""},precipitation:{title:"Precipitation",units:'"'},temperature:{title:"Temperature",units:"F"},equip_temperature:{title:"Equipment Temperature",units:"F"},wind_speed_average:{title:"Wind Speed",units:"mph"}},b[a]},a.prototype.getPlotType=function(a){switch(a){case"precipitation":return"bar";default:return"line"}},a.prototype.getPlotDecimals=function(a){switch(a){case"precipitation":return 2;default:return 1}},a}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Template=function(){function a(a){this.preError="Plotter.Template.",this.plotter=a,this.api=this.plotter.i.api,this.sapi=this.plotter.i.sapi,this.template=null,this.dataSets=0,this.isValid=function(a){var b,c,d,e,f,g,h;for(b=0,d=a.length;b<d;b++)if(null!=(g=a[b])&&g===![]){if(void 0===g.type)return!1;if(void 0===g.x)return!1;if(void 0===g.y)return!1;if(void 0===g.x.variable)return!1;if(void 0===g.x.min)return!1;if(void 0===g.x.max)return!1;if(void 0===g.y[0])return!1;for(f=g.y,c=0,e=f.length;c<e;c++){if(h=f[c],void 0===h.dataLoggerId)return!1;if(void 0===h.variable)return!1;if(void 0===h.title)return!1;if(void 0===h.units)return!1}}return!0},this.newIsValid=function(a){var b,c,d;for(b=0,c=a.length;b<c;b++)if(null!=(d=a[b])&&void 0===d.type)return!1;return!0},this.parse=function(a){var b,c,d,e,f;if(b=JSON.parse(a).templateData,this.isValid(b)){for(!1,d=c=e=b.length-1;e<=0?c<=0:c>=0;d=e<=0?++c:--c)f=b[d],null!=f?(f.x.min=new window.Plotter.Now(this.plotter.lib.format,f.x.min).get(),f.x.max=new window.Plotter.Now(this.plotter.lib.format,f.x.max).get(),f.y=this.spliceArrayY(f.y)):(!0,b.splice(d,1));return b.sort(function(a,b){return a.pageOrder-b.pageOrder}),b=this.resetPageOrder(b)}throw new Error("Plotter template format is invalid. Reference a working example.")},this.stringify=function(){var a;return a={templateData:this.template},JSON.stringify(a)},this.endpoint=function(){return this.plotter.options.href+"/api/v5/plothandler/"}}
return a.prototype.get=function(){var a,b,c,d,e;return d=this.preError+"get()",e=this.endpoint()+this.plotter.options.templateId,b=null,a=this,c=function(b){if(null===b.responseJSON||b.responseJSON.error)throw new Error(d+".callback(data) error retrieving template.");return a.template=a.parse(b.responseJSON.template_data)},this.sapi.get(e,b,c)},a.prototype.put=function(){var a,b,c,d;if(c=this.preError+"put()",!this.plotter.isAdmin()&&null==this.plotter.options.uuid)throw new Error(c+", not authorized for PUT requests.");return d=this.endpoint()+""+this.plotter.options.templateId,a={template_data:this.stringify(this.template)},this,b=function(a){return console.log("Template PUT completed (data)",a)},this.api.put(d,a,b)},a.prototype.add=function(a){var b,c;return c=this.preError+"add(options)",b=this.template.push(a)-1,function(){if(!this.newIsValid(this.template))throw new Error(c+" template invalid after adding new plot.")}.call(this),b},a.prototype.plotCount=function(){return this.template.length},a.prototype.dataSetCount=function(a){return this.template[a].y.length},a.prototype.full=function(){return this.template},a.prototype.forSync=function(a,b,c,d){var e;return e=null,null!=this.template[a].y[b]&&(e=this.template[a].y[b].dataLoggerId),{data_logger:e,max_datetime:c,limit:d}},a.prototype.forControls=function(){},a.prototype.forPlots=function(a){var b,c,d,e,f,g,h;for(d=this.template[a].x,e=this.template[a].y,f=0,g=e.length;f<g;f++)b=e[f],"wind_speed_average"===b.variable&&(b.band={minVariable:"wind_speed_minimum",maxVariable:"wind_speed_maximum"});return c="line",void 0!==this.template[a].plotType&&(c=this.template[a].plotType),h=$.extend(!0,{},this.template[a]),h.plotId=a,h.plotType=c,h.x=d,h.y=e,h},a.prototype.removePlot=function(a){return delete this.template[a]},a.prototype.resetPageOrder=function(a){var b,c;for(b in a)c=a[b],c.pageOrder=parseInt(b)+1;return a},a.prototype.spliceArrayY=function(a){var b,c,d;for(c=b=d=a.length-1;d<=0?b<=0:b>=0;c=d<=0?++b:--b)null==a[c]&&a.splice(c,1);return a},a}()}.call(this),function(){window.Plotter||(window.Plotter={}),window.Plotter.Zoom=function(){function a(a){this.preError="Plotter.Zoom.",this.plotter=a}return a.prototype.set=function(a,b){var c,d,e,f;e=this.plotter.plots,f=[];for(d in e)c=e[d],null!=c?f.push(c.proto.setZoomTransform(a)):f.push(void 0);return f},a.prototype.scale=function(a,b){var c,d;return c=a*b.x,d=(c-b.x)/b.k,b.translate(d,0)},a}()}.call(this);