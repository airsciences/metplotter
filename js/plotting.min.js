(function(){var t
window.Plotting||(window.Plotting={}),window.Plotting.API=t=function(){function t(t,i){var e
this.preError="Plotting.API",e=this.preError+".constructor()",this.async=!0,"undefined"!=typeof i&&(this.async=i),this.getAccessToken=function(){return t},this.getAccessTokenValue=function(){return"Token "+t}}return t.prototype.build=function(){var t,i,e,o,n
if(o=this.preError+".build()",n=null,XMLHttpRequest)n=new XMLHttpRequest
else try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){t=i
try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=e,console.error(o,"Cannot specify XMLHTTPRequest (error)",t)}}return n},t.prototype.get=function(t,i,e){var o,n,a,s
a=this.preError+".get(uri, params, callback)",s=this.build(),"undefined"!=typeof e&&(s.onreadystatechange=function(){var t,i,o
if(4===s.readyState){if(200!==s.status&&304!==s.status)return console.log(a+" HTTP error, (status): "+s.status),void(s=null)
o={response:s.response,responseText:s.responseText,responseJSON:null}
try{o.responseJSON=JSON.parse(o.responseText)}catch(i){t=i,o.responseJSON=null}return e(o)}}),i=this.encodeArgs("GET",i)
try{s.open("GET",t+i,this.async),s.setRequestHeader("Authorization",this.getAccessTokenValue()),s.send(null)}catch(n){o=n,console.log(a+"catch(error).",o)}},t.prototype.put=function(){var t,i,e,o,n
o=this.preError+".put(uri, params, callback)",n=this.build(),"undefined"!=typeof callback&&(n.onreadystatechange=function(){var t,i,e
if(4===n.readyState){if(200!==n.status&&304!==n.status)return console.log(o+" HTTP error, (status): "+n.status),void(n=null)
e={response:n.response,responseText:n.responseText,responseJSON:null}
try{e.responseJSON=JSON.parse(e.responseText)}catch(i){t=i,e.responseJSON=null}return callback(e)}}),t=this.encodeArgs("PUT",t)
try{n.open("PUT",uri,this.async),n.setRequestHeader("Authorization",this.getAccessToken()),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(t)}catch(e){i=e,console.log(o+"catch(error).",i)}},t.prototype.post=function(){var t,i,e,o,n
o=this.preError+".post(uri, params, callback)",n=build(),"undefined"!=typeof callback&&(n.onreadystatechange=function(){var t,i,e
if(4===n.readyState){if(200!==n.status&&304!==n.status)return console.log(o+" HTTP error, (status): "+n.status),void(n=null)
e={response:n.response,responseText:n.responseText,responseJSON:null}
try{e.responseJSON=JSON.parse(e.responseText)}catch(i){t=i,e.responseJSON=null}return callback(e)}}),t=this.encodeArgs("POST",t)
try{n.open("POST",uri,this.async),n.setRequestHeader("Authorization",this.getAccessToken()),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(t)}catch(e){i=e,console.log(o+"catch(error).",i)}},t.prototype["delete"]=function(){var t,i,e,o,n
o=this.preError+".delete(uri, params, callback)",n=this.build(),"undefined"!=typeof callback&&(n.onreadystatechange=function(){var t,i,e
if(4===n.readyState){if(200!==n.status&&304!==n.status)return console.log(o+" HTTP error, (status): "+n.status),void(n=null)
e={response:n.response,responseText:n.responseText,responseJSON:null}
try{e.responseJSON=JSON.parse(e.responseText)}catch(i){t=i,e.responseJSON=null}return callback(e)}}),t=this.encodeArgs("DELETE",t)
try{n.open("DELETE",uri,this.async),n.setRequestHeader("Authorization",this.getAccessToken()),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(t)}catch(e){i=e,console.log(o+"catch(error).",i)}},t.prototype.encodeArgs=function(t,i){var e,o,n,a,s,r
if(r=this.preError+"encodeArgs(type, json_args)",o="",e=0,"string"==typeof i)try{i=JSON.parse(i)}catch(s){a=s,console.log(r+"catch(error).",a)}if("POST"===t||"PUT"===t)o=JSON.stringify(i)
else if("GET"===t)for(n in i)o=0===e?"?"+n+"="+i[n]:o+"&"+n+"="+i[n],e++
return o},t}()}).call(this),function(){var t,i=[].indexOf||function(t){for(var i=0,e=this.length;e>i;i++)if(i in this&&this[i]===t)return i
return-1}
window.Plotting||(window.Plotting={}),window.Plotting.Controls=t=function(){function t(t,i,e){var o,n
this.preError="Plotting.Dropdown",this.plotter=t,n={target:null},this.options=Object.mergeDefaults(e,n),o={token:null,expires:null,expired:!0},i=Object.mergeDefaults(i,o),this.maps=[],this.stations={},this.markers={},this.listeners={},this.api=new window.Plotting.API(i.token)}return t.prototype.appendStationDropdown=function(t,i,e,o){var n,a,s,r,l
return r=location.protocol+"//dev.nwac.us/api/v5/dataloggerregion?sensor_name="+e,n=this,a={},l=this.uuid(),s=function(e){var a,s,r,p,d,h,u,c,f,m,y,g,v,x,b,w,P,D,S,T,k,_,M,C,O,N,I,A
for(f='<div class="dropdown"> <li><a id="'+l+'" class="station-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="station-dropdown-'+t+'" class="dropdown-menu pull-right">',n.stations[t]=e.responseJSON.results,_=e.responseJSON.results,m=0,b=_.length;b>m;m++){for(I=_[m],u="",k="",a='<span class="station-dots">',p=0,M=I.dataloggers,g=0,w=M.length;w>g;g++)h=M[g],d=n.isCurrent(o,"dataLoggerId",h.id),d&&(p++,a=a+' <i class="icon-circle" style="color: '+d.color+'"></i>')
for(p>0&&(k='style="background-color: rgb(248,248,248)"',u='style="font-weight: 700"'),f=f+' <li class="subheader" '+k+"> <a "+u+' href="#"><i class="icon-caret-down" style="margin-right: 6px"></i> '+I.name+" "+a+'</span></a> </li> <ul class="list-group-item sublist" style="display: none;">',C=I.dataloggers,v=0,P=C.length;P>v;v++)A=C[v],d=n.isCurrent(o,"dataLoggerId",A.id),c="",d&&(c='style="color: '+d.color+'"'),y="data-logger-"+A.id+"-plot-"+t,r='<i id="'+y+'" class="icon-circle" '+c+"></i>",s="add-station-"+t+"-"+A.id,f=f+' <li class="station" id="'+s+'" data-station-id="'+A.id+'" data-plot-id="'+t+'" style="padding: 1px 5px; cursor: pointer; list-style-type: none" onclick=""> '+r+" "+A.datalogger_name+" | "+A.elevation+" ft</li>"
f+=" </ul>"}for(f+=" </ul> </li>",$(i).prepend(f),O=e.responseJSON.results,x=0,D=O.length;D>x;x++)for(I=O[x],N=I.dataloggers,T=0,S=N.length;S>T;T++)A=N[T],s="add-station-"+t+"-"+A.id,$("#"+s).off("click").on("click",function(t){var i,e
return t.stopPropagation(),i=$(this).attr("data-plot-id"),e=$(this).attr("data-station-id"),n.plotter.addStation(i,e)})
return $("#"+l).dropdown(),n.bindSubMenuEvent(".subheader"),n.appendStationMap(t,i,e.responseJSON.results,o)},this.api.get(r,a,s)},t.prototype.resetStationDropdown=function(t){var i,e,o,n,a,s,r,l
for(i=this,a=this.stations[t],r=[],o=0,n=a.length;n>o;o++)s=a[o],r.push(function(){var o,n,a,r
for(a=s.dataloggers,r=[],o=0,n=a.length;n>o;o++)l=a[o],e="add-station-"+t+"-"+l.id,console.log("Reset Station (color)",$("#"+e).find("i.icon-circle").css("color")),$("#"+e).find("i.icon-circle").css("color",""),r.push($("#"+e).off("click").on("click",function(t){var e,o
return t.stopPropagation(),e=$(this).attr("data-plot-id"),o=$(this).attr("data-station-id"),i.plotter.addStation(e,o)}))
return r}())
return r},t.prototype.updateStationDropdown=function(t){var i,e,o,n,a,s
return i=this,a=this.plotter.template[t].proto.options,e="",this.resetStationDropdown(t),null!==a.y.dataLoggerId&&(n=a.y.dataLoggerId,o="circle-plot"+t+"-station"+n,e=' <i class="icon-circle" id="'+o+'" style="color: '+a.y.color+'"></i>',s="data-logger-"+n+"-plot-"+t,0===$("#"+o).length&&$(a.target).find("#"+s).css("color",a.y.color).parent().parent().prev().css("background-color","rgb(248,248,248)").css("font-weight",700).children(":first").children(".station-dots").empty().append(e),$("#add-station-"+t+"-"+n).off("click").on("click",function(t){var e,o,n
return t.stopPropagation(),console.log("this",$(this)),o=$(this).attr("data-plot-id"),n=$(this).attr("data-station-id"),i.plotter.removeStation(o,n),e="circle-plot"+o+"-station"+n,$("#"+e).remove()})),null!==a.y2.variable&&(n=a.y2.dataLoggerId,o="circle-plot"+t+"-station"+n,e=' <i class="icon-circle" id="'+o+'" style="color: '+a.y2.color+'"></i>',s="data-logger-"+n+"-plot-"+t,0===$("#"+o).length&&$(a.target).find("#"+s).css("color",a.y2.color).parent().parent().prev().css("background-color","rgb(248,248,248)").css("font-weight",700).children(":first").append(e),$("#add-station-"+t+"-"+n).off("click").on("click",function(t){var e,o,n
return t.stopPropagation(),o=$(this).attr("data-plot-id"),n=$(this).attr("data-station-id"),i.plotter.removeStation(o,n),e="circle-plot"+o+"-station"+n,$("#"+e).remove()})),null!==a.y3.variable?(n=a.y3.dataLoggerId,o="circle-plot"+t+"-station"+n,e=' <i class="icon-circle" id="'+o+'" style="color: '+a.y3.color+'"></i>',s="data-logger-"+n+"-plot-"+t,0===$("#"+o).length&&$(a.target).find("#"+s).css("color",a.y3.color).parent().parent().prev().css("background-color","rgb(248,248,248)").css("font-weight",700).children(":first").append(e),$("#add-station-"+t+"-"+n).off("click").on("click",function(t){var e,o,n
return t.stopPropagation(),o=$(this).attr("data-plot-id"),n=$(this).attr("data-station-id"),i.plotter.removeStation(o,n),e="circle-plot"+o+"-station"+n,$("#"+e).remove()})):void 0},t.prototype.appendParameterDropdown=function(t,e,o,n){var a,s,r,l,p
return l=location.protocol+"//dev.nwac.us/api/v5/sensortype?sensors__data_logger="+o,s={},p=this.uuid(),a=[],r=function(o){var a,s,r,l,d,h,u,c,f,m
for(l='<div class="dropdown"> <li><a id="'+p+'" class="parameter-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="param-dropdown-'+t+'" class="dropdown-menu pull-right" role="menu" aria-labelledby="'+p+'">',f=o.responseJSON.results,d=0,u=f.length;u>d;d++)c=f[d],"wind_speed_minimum"===c.field_name||"wind_speed_maximum"===c.field_name||("wind_speed_average"===c.field_name?(a=c.field_name,s=a.replace("_","-"),h=s+"-plot-"+t,m=n.variable,i.call(c.field_name,m)>=0&&(r='<i id="'+h+'" class="parameter-'+c.parameter+' icon-circle" style="color: '+n.color+'"></i>')):(a=c.field_name,s=a.replace("_","-"),h=s+"-plot-"+t,r=n.variable===c.field_name?'<i id="'+h+'" class="icon-circle" style="color: '+n.color+'"></i>':'<i id="'+h+'" class="icon-circle" style=""></i>')),l=l+' <li><a style="cursor: pointer" onclick="plotter.addVariable('+t+", '"+a+"')\">"+r+" "+c.sensortype_name+"</a></li>"
return l+=" </ul> </li> </div>",$(e).prepend(l),$("#"+p).dropdown()},this.api.get(l,s,r)},t.prototype.updateParameterDropdown=function(t){var i,e,o
return e=this.plotter.template[t].proto.options,null!==e.y.variable&&(i=e.y.variable.replace("_","-"),o=i+"-plot-"+t,$(e.target).find("#"+o).css("color",e.y.color)),null!==e.y2.variable&&(i=e.y2.variable.replace("_","-"),o=i+"-plot-"+t,$(e.target).find("#"+o).css("color",e.y2.color)),null!==e.y3.variable?(i=e.y3.variable.replace("_","-"),o=i+"-plot-"+t,$(e.target).find("#"+o).css("color",e.y3.color)):void 0},t.prototype.appendStationMap=function(t,i,e,o){var n,a,s,r,l,p,d,h,u,c,f,m,y,g,v,x,b,w,P,D,S,T,k,_
for(n=this,_=this.uuid(),u="map-control-"+t,c='<li data-toggle="popover" data-placement="left"> <i id="map-'+t+'" class="icon-map-marker" style="cursor: pointer"></i> </li> <div class="popover" style="max-width: 356px;"> <div class="arrow"></div> <div class="popover-content"> <div id="'+u+'" style="width: 312px; height: 312px;"></div> </div> </div>',$(i).prepend(c),$("#map-"+t).on("click",function(){return n.plotter.controls.toggleMap(t)}),this.maps[t]=new google.maps.Map(document.getElementById(u),{center:new google.maps.LatLng(46.98,-121.98),zoom:6,maxZoom:12,mapTypeId:"terrain",zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1}),m=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),this.markers[t]=[],this.listeners[t]=[],s=new google.maps.LatLngBounds,a=[],f=0,v=e.length;v>f;f++)for(S=e[f],D=S.dataloggers,y=0,x=D.length;x>y;y++)k=D[y],h="rgb(200,200,200)",T=5,P=.5,d="map-plot-"+t+"-station-"+k.id,p=n.isCurrent(o,"dataLoggerId",k.id),p&&(h=p.color,T=7,P=.8,a.push(new google.maps.LatLng(k.lat,k.lon))),w=new google.maps.Marker({position:{lat:k.lat,lng:k.lon},id:d,tooltip:k.datalogger_name+" - "+k.elevation+" ft",dataloggerid:k.id,icon:{path:google.maps.SymbolPath.CIRCLE,scale:T,strokeWeight:2,fillOpacity:P,fillColor:h},selected:!1}),w.addListener("mouseover",function(){return m.setContent(this.tooltip),m.open(n.maps[t],this)}),w.addListener("mouseout",function(){return m.close()}),this.listeners[t][d]=w.addListener("click",function(){return console.log("Marker clicked",this),n.plotter.addStation(t,this.dataloggerid)}),r=this.markers[t][d]=w,this.markers[t][d].setMap(this.maps[t])
for(g=0,b=a.length;b>g;g++)l=a[g],s.extend(l)
return this.maps[t].fitBounds(s)},t.prototype.resetStationMap=function(t){var i,e,o,n,a
i=this,n=this.markers[t],a=[]
for(e in n)o=n[e],o.setIcon({path:google.maps.SymbolPath.CIRCLE,scale:5,strokeWeight:2,fillOpacity:.5,fillColor:"rgb(200,200,200)"}),o.set("selected",!1),i.listeners[t][e].remove(),a.push(i.listeners[t][e]=o.addListener("click",function(){var e
return e=this.get("dataloggerid"),i.plotter.addStation(t,e)}))
return a},t.prototype.updateStationMap=function(t){var i,e,o,n,a,s
return i=this,this.resetStationMap(t),s=function(t,e,o){return i.markers[t][e].setIcon({path:google.maps.SymbolPath.CIRCLE,scale:7,strokeWeight:2,fillOpacity:.8,fillColor:o}),i.markers[t][e].set("selected",!0),i.listeners[t][e].remove(),i.listeners[t][e]=i.markers[t][e].addListener("click",function(){var e
return e=this.get("dataloggerid"),i.plotter.removeStation(t,e)})},n=this.plotter.template[t].proto.options,null!==n.y.variable&&(o=n.y.variable.replace("_","-"),a="map-plot-"+t+"-station-"+n.y.dataLoggerId,e=n.y.color,s(t,a,e)),null!==n.y2.variable&&(o=n.y2.variable.replace("_","-"),a="map-plot-"+t+"-station-"+n.y2.dataLoggerId,e=n.y2.color,s(t,a,e)),null!==n.y3.variable&&(o=n.y3.variable.replace("_","-"),a="map-plot-"+t+"-station-"+n.y3.dataLoggerId,e=n.y3.color,s(t,a,e)),this.boundOnSelected(t)},t.prototype.boundOnSelected=function(t){var i,e,o,n,a,s,r,l,p,d
i=this,o=new google.maps.LatLngBounds,e=[],d=this.markers[t]
for(n in d)a=d[n],r=a.get("selected"),r===!0&&e.push(a.getPosition())
for(l=0,p=e.length;p>l;l++)s=e[l],o.extend(s)
return this.maps[t].fitBounds(o),this.maps[t].getZoom()<6?this.maps[t].setZoom(6):void 0},t.prototype.toggleMap=function(t){var i,e,o,n,a
return i=128,e=256,o=this.plotter.controls.maps[t].getCenter(),a=this.plotter.controls.maps[t].getZoom(),n=$("#map-control-"+t).parent().parent().prev().offset(),$("#map-control-"+t).parent().parent().toggle().css("left",n.left-356-i).css("top",n.top-e),google.maps.event.trigger(this.plotter.controls.maps[t],"resize"),this.plotter.controls.maps[t].setCenter(o),this.plotter.controls.maps[t].setZoom(a)},t.prototype.toggle=function(t){return $(t).toggle()},t.prototype.move=function(t,i,e){var o,n
return o=this,n='<i id="move-'+t+"-"+e+'" style="cursor: pointer;" class="icon-arrow-'+e+'"></i>',$(i).append(n),$("#move-"+t+"-"+e).on("click",function(){return o.plotter.move(t,e)})},t.prototype.remove=function(t,i){var e,o
return e=this,o='<i id="remove-'+t+'" style="cursor: pointer;" class="icon-remove"></i>',$(i).append(o),$("#remove-"+t).on("click",function(){return e.plotter.remove(t)})},t.prototype["new"]=function(t){var i,e,o,n
return i=this,n=this.uuid(),e='<ul id="new-'+n+'-dropdown" class="dropdown-menu pull-right" role="menu" aria-labelledby="new-'+n+'"> <li><a id="new-'+n+'-parameter" style="cursor: pointer">Add Parameter Plot</a></li> <li><a id="new-'+n+'-station" style="cursor: pointer">Add Station Plot</a></li> </ul>',o='<div class="dropdown"> <li><a id="new-'+n+'" role="button" href="#"> <i class="icon-plus"></i> </a></li> </div>',$(t).append(o),$("#new-"+n).on("click",function(){return i.plotter.add("parameter")})},t.prototype.uuid=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},t.prototype.isCurrent=function(t,i,e){var o,n
for(o in t)if(n=t[o],n[i]===e)return n
return!1},t.prototype.bindSubMenuEvent=function(t){return $(t).unbind().on("click",function(t){var i
return t.preventDefault(),t.stopPropagation(),i=$(this).next(),i.is(":visible")?($(this).find("i").removeClass("icon-caret-up").addClass("icon-caret-down"),i.slideUp()):($(this).find("i").removeClass("icon-caret-down").addClass("icon-caret-up"),i.slideDown())})},t}()}.call(this),function(){var t,i=[].indexOf||function(t){for(var i=0,e=this.length;e>i;i++)if(i in this&&this[i]===t)return i
return-1}
window.Plotting||(window.Plotting={}),window.Plotting.Data=t=function(){function t(t){var i,e,o,n,a
if(this.preError="Plotting.Data.",n=this.preError+".constructor(...)",!(t instanceof Array))return void console.log(n+" data not of type array.")
for(this.data=$.extend(!0,[],t),this.sourceCount=1,i=this.data.length-1,e=o=0,a=i;a>=0?a>=o:o>=a;e=a>=0?++o:--o)void 0===this.data[e]&&console.log(n+" on construct, @data[i] is (i, row)",e,this.data[e])
this.test=function(t,i,e){var o,a,s,r,l,p
for(n=this.preError+"test(...):",a=e.length,o=0,l=!1,s=0,r=e.length;r>s;s++){if(p=e[s],void 0===t[p])throw new Error(n+" key '"+p+"' not found in primary data set.")
if(void 0===i[p])throw new Error(n+" key '"+p+"' not found in joining data set.")
t[p]instanceof Date?t[p].getTime()===i[p].getTime()&&o++:t[p]===i[p]&&o++}return o===a&&(l=!0),l}}return t.prototype.join=function(t,e){var o,n,a,s,r,l,p,d,h,u,c,f,m,y,g
m=this.preError+".join(data, onKeys)",y=[],s="_"+parseInt(this.sourceCount+1),l=Object.keys(this.data[0]),o=Object.keys(t[0]),t.length>this.data.length?(r=$.extend(!0,[],t),d=$.extend(!0,[],this.data)):(r=$.extend(!0,[],this.data),d=$.extend(!0,[],t))
for(f in r){g=r[f],a=y.push($.extend(!0,{},g))
for(n in d)if(p=d[n],u=this.test(g,p,e)){for(h in p)c=p[h],i.call(e,h)<0&&(y[a-1][h+s]=c)
d.splice(n,1)
break}}return this.sourceCount++,this.data=this._clean(y),this.data},t.prototype.merge=function(t,e){var o,n,a,s,r,l,p,d,h,u,c,f,m,y
f=this.preError+".merge(data, onKeys)",m=[],r=Object.keys(this.data[0]),o=Object.keys(t[0]),t.length>this.data.length?(s=$.extend(!0,[],t),p=$.extend(!0,[],this.data)):(s=$.extend(!0,[],this.data),p=$.extend(!0,[],t))
for(c in s){y=s[c],a=m.push($.extend(!0,{},y))
for(n in p)if(l=p[n],h=this.test(y,l,e)){for(d in l)u=l[d],i.call(e,d)<0&&(m[a-1][d]=u)
p.splice(n,1)
break}}return this.data=this._clean(m),this.data},t.prototype.append=function(t,e){var o,n,a,s,r,l,p,d,h,u,c
h=this.preError+".append(data, onKeys)",n=$.extend(!0,[],this.data),s=$.extend(!0,[],t)
for(d in n){c=n[d]
for(o in s)if(a=s[o],l=this.test(c,a,e)){for(r in a)p=a[r],i.call(e,r)<0&&(n[d][r]=p)
s.splice(o,1)}}return u=n.concat(s),this.data=this._clean(u),this.data},t.prototype.sub=function(t,i){return this.data=this._clean($.extend(!0,[],this.data.slice(t,i))),this.data},t.prototype.get=function(){return $.extend(!0,[],this.data)},t.prototype.getSourceCount=function(){return this.sourceCount},t.prototype._clean=function(t){var i,e,o,n,a
for(i=$.extend(!0,[],t),e=i.length-1,o=n=0,a=e;a>=0?a>=n:n>=a;o=a>=0?++n:--n)void 0===i[o]&&i.splice(o,1)
return $.extend(!0,[],i)},t.prototype._tryError=function(t,i){var e,o,n,a,s
for(e=t.length-1,s=[],o=n=0,a=e;a>=0?a>=n:n>=a;o=a>=0?++n:--n){if(void 0===t[o])throw console.log("@data[i] is (i, row)",o,row),new Error(i+" undefined row")
s.push(void 0)}return s},t}()}.call(this),function(){Object.mergeDefaults||(Object.mergeDefaults=function(t,i){var e,o,n,a,s
n={}
for(e in i)a=i[e],n[e]=a
for(o in t)s=t[o],n[o]=s
return n})}.call(this),function(){var t,i=[].slice
window.Plotting||(window.Plotting={}),window.Plotting.LinePlot=t=function(){function t(t,e,o){var n,a
this.preError="LinePlot.",this.plotter=t,this.initialized=!1,this.defaults={plotId:null,uuid:"",debug:!0,target:null,dataParams:null,merge:!1,x:{variable:null,format:"%Y-%m-%dT%H:%M:%SZ",min:null,max:null,ticks:7},y:{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,maxBarValue:null,color:"rgb(41, 128, 185)"},yBand:{minVariable:null,maxVariable:null},y2:{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,color:"rgb(39, 174, 96)"},y2Band:{minVariable:null,maxVariable:null},y3:{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,color:"rgb(142, 68, 173)"},y3Band:{minVariable:null,maxVariable:null},zoom:{scale:{min:.3,max:5}},aspectDivisor:5,transitionDuration:500,weight:2,axisColor:"rgb(0,0,0)",font:{weight:100,size:12},crosshairX:{weight:1,color:"rgb(149,165,166)"},requestInterval:{data:336}},o.x&&(o.x=Object.mergeDefaults(o.x,this.defaults.x)),o.y&&(o.y=Object.mergeDefaults(o.y,this.defaults.y)),o.y2&&(o.y2=Object.mergeDefaults(o.y2,this.defaults.y2)),o.y3&&(o.y3=Object.mergeDefaults(o.y3,this.defaults.y3)),this.options=Object.mergeDefaults(o,this.defaults),this.device="full",this.links=[{variable:"battery_voltage",title:"Battery Voltage"},{variable:"temperature",title:"Temperature"},{variable:"relative_humidity",title:"Relative Humidity"},{variable:"precitation",title:"Precipitation"},{variable:"snow_depth",title:"Snow Depth"},{variable:"wind_direction",title:"Wind Direction"},{variable:"wind_speed_average",title:"Wind Speed"},{variable:"net_solar",title:"Net Solar"},{variable:"solar_pyranometer",title:"Solar Pyranometer"},{variable:"equip_temperature",title:"Equipment Temperature"},{variable:"barometric_pressure",title:"Barometric Pressure"},{variable:"snowfall_24_hour",title:"24-Hr Snowfall"},{variable:"intermittent_snow",title:"Intermittent Snow"}],this.log=function(){var t
t=1<=arguments.length?i.call(arguments,0):[]},this.options.debug&&(this.log=function(){var t
return t=1<=arguments.length?i.call(arguments,0):[],console.log(t)}),this.parseDate=d3.timeParse(this.options.x.format),this.bisectDate=d3.bisector(function(t){return t.x}).left,this.sortDatetimeAsc=function(t,i){return t.x-i.x},this.data=this.processData(e),this.getDefinition(),a=null,n=null,e.length>0&&(a=this.getDomainScale(this.definition.x),n=this.getDomainMean(this.definition.x)),this.state={range:{data:null,scale:a},length:{data:null},interval:{data:null},zoom:1,request:{data:null},mean:{scale:n}},e.length>0&&(this.setDataState(),this.setIntervalState(),this.setDataRequirement())}return t.prototype.processData=function(t){var i,e,o,n
o=[]
for(e in t)n=t[e],o[e]={x:new Date(this.parseDate(n[this.options.x.variable]).getTime()-288e5),y:n[this.options.y.variable]},null!==this.options.y2.variable&&(this.options.y.variable===this.options.y2.variable?o[e].y2=n[this.options.y2.variable+"_2"]:o[e].y2=n[this.options.y2.variable]),null!==this.options.y3.variable&&(this.options.y.variable===this.options.y3.variable||this.options.y2.variable===this.options.y3.variable?o[e].y3=n[this.options.y3.variable+"_3"]:o[e].y3=n[this.options.y3.variable]),null!==this.options.yBand.minVariable&&null!==this.options.yBand.maxVariable&&(o[e].yMin=n[this.options.yBand.minVariable],o[e].yMax=n[this.options.yBand.maxVariable]),null!==this.options.y2Band.minVariable&&null!==this.options.y2Band.maxVariable&&(o[e].y2Min=n[this.options.y2Band.minVariable],o[e].y2Max=n[this.options.y2Band.maxVariable]),null!==this.options.y3Band.minVariable&&null!==this.options.y3Band.maxVariable&&(o[e].y3Min=n[this.options.y3Band.minVariable],o[e].y3Max=n[this.options.y3Band.maxVariable])
return i=new Plotting.Data(o),o=i._clean(i.get()),o.sort(this.sortDatetimeAsc)},t.prototype.setData=function(t){var i,e
return this.data=this.processData(t),this.getDefinition(),e=null,i=null,t.length>0&&(e=this.getDomainScale(this.definition.x),i=this.getDomainMean(this.definition.x)),this.state.range.scale=e,this.state.mean.scale=i,t.length>0?(this.setDataState(),this.setIntervalState(),this.setDataRequirement()):void 0},t.prototype.appendData=function(t){var i,e
return i=this.processData(t),e=new Plotting.Data(this.data),e.append(i,["x"]),this.data=e._clean(e.get()),this.data=this.data.sort(this.sortDatetimeAsc),this.initialized?(this.setDataState(),this.setIntervalState(),this.setDataRequirement()):void 0},t.prototype.removeData=function(t){var i,e,o,n,a
a=[],n=this.data
for(e in n)o=n[e],delete o[t],a[e]=o
return i=new Plotting.Data(a),this.data=i.get(),this.data=this.data.sort(this.sortDatetimeAsc),this.initialized?(this.setDataState(),this.setIntervalState(),this.setDataRequirement()):void 0},t.prototype.setDataState=function(){var t,i,e,o
for(t=this.data.length-1,i=e=0,o=t;o>=0?o>=e:e>=o;i=o>=0?++e:--e)void 0===this.data[i]&&console.log("data[i] is (i, row)",i,this.data[i])
return this.state.range.data={min:d3.min(this.data,function(t){return t.x}),max:d3.max(this.data,function(t){return t.x})},this.state.length.data=this.data.length},t.prototype.setIntervalState=function(){return this.state.interval.data={min:(this.state.range.scale.min.getTime()-this.state.range.data.min.getTime())/36e5,max:(this.state.range.data.max.getTime()-this.state.range.scale.max.getTime())/36e5}},t.prototype.setDataRequirement=function(){var t,i
return i=new Date,t=!1,this.state.range.data.max<i&&(t=this.state.interval.data.max<this.options.requestInterval.data),this.state.request.data={min:this.state.interval.data.min<this.options.requestInterval.data,max:t}},t.prototype.setZoomState=function(t){return this.state.zoom=t},t.prototype.getDomainScale=function(t){var i
return i={min:t.domain()[0],max:t.domain()[1]}},t.prototype.getDomainMean=function(t){var i
return i=new Date(d3.mean(t.domain())),i.setHours(i.getHours()+Math.round(i.getMinutes()/60)),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),i},t.prototype.getDefinition=function(){var t,i,e
return e=this.preError+"getDefinition():",t=this,this.definition={colorScale:d3.schemeCategory20},this.calculateChartDims(),this.calculateAxisDims(this.data),this.definition.xAxis=d3.axisBottom().scale(this.definition.x).ticks(Math.round($(this.options.target).width()/100)),this.definition.yAxis=d3.axisLeft().scale(this.definition.y).ticks(this.options.y.ticks),this.definition.x.domain([this.definition.x.min,this.definition.x.max]),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),i=[[-(1/0),0],[this.definition.x(new Date),this.definition.dimensions.innerHeight]],this.definition.zoom=d3.zoom().scaleExtent([this.options.zoom.scale.min,this.options.zoom.scale.max]).translateExtent(i).on("zoom",function(){var i
return i=t.setZoomTransform(),t.plotter.zoom(i)}),this.definition.line=d3.line().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(i){return t.definition.x(i.x)}).y(function(i){return t.definition.y(i.y)}),this.definition.line2=d3.line().defined(function(t){return!isNaN(t.y2)&&null!==t.y2}).x(function(i){return t.definition.x(i.x)}).y(function(i){return t.definition.y(i.y2)}),this.definition.line3=d3.line().defined(function(t){return!isNaN(t.y3)&&null!==t.y3}).x(function(i){return t.definition.x(i.x)}).y(function(i){return t.definition.y(i.y3)}),this.definition.area=d3.area().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(i){return t.definition.x(i.x)}).y0(function(i){return t.definition.y(i.yMin)}).y1(function(i){return t.definition.y(i.yMax)}),this.definition.area2=d3.area().defined(function(t){return!isNaN(t.y2)&&null!==t.y2}).x(function(i){return t.definition.x(i.x)}).y0(function(i){return t.definition.y(i.y2Min)}).y1(function(i){return t.definition.y(i.y2Max)}),this.definition.area3=d3.area().defined(function(t){return!isNaN(t.y3)&&null!==t.y3}).x(function(i){return t.definition.x(i.x)}).y0(function(i){return t.definition.y(i.y3Min)}).y1(function(i){return t.definition.y(i.y3Max)})},t.prototype.calculateChartDims=function(){var t,i,e
return e=Math.round($(this.options.target).width())-24,t=Math.round(e/this.options.aspectDivisor),e>1e3?i={top:Math.round(.04*t),right:Math.round(Math.pow(e,.3)),bottom:Math.round(.12*t),left:Math.round(Math.pow(e,.6))}:e>600?(this.device="mid",this.options.font.size=this.options.font.size/1.25,t=Math.round(e/(this.options.aspectDivisor/1.25)),i={top:Math.round(.04*t),right:Math.round(Math.pow(e,.3)),bottom:Math.round(.14*t),left:Math.round(Math.pow(e,.6))}):(this.device="small",this.options.font.size=this.options.font.size/1.5,t=Math.round(e/(this.options.aspectDivisor/1.5)),i={top:Math.round(.04*t),right:Math.round(Math.pow(e,.3)),bottom:Math.round(.18*t),left:Math.round(Math.pow(e,.6))}),this.definition.dimensions={width:e,height:t,margin:i},this.definition.dimensions.topPadding=parseInt(this.definition.dimensions.margin.top),this.definition.dimensions.bottomPadding=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom),this.definition.dimensions.leftPadding=parseInt(this.definition.dimensions.margin.left),this.definition.dimensions.innerHeight=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom-this.definition.dimensions.margin.top),this.definition.dimensions.innerWidth=parseInt(this.definition.dimensions.width-this.definition.dimensions.margin.left-this.definition.dimensions.margin.right),this.definition.x=d3.scaleTime().range([i.left,e-i.right]),this.definition.y=d3.scaleLinear().range([t-i.bottom,i.top])},t.prototype.calculateAxisDims=function(t){return this.calculateXAxisDims(t),this.calculateYAxisDims(t)},t.prototype.calculateXAxisDims=function(t){return this.definition.x.min=null===this.options.x.min?d3.min(t,function(t){return t.x}):this.parseDate(this.options.x.min),this.definition.x.max=null===this.options.x.max?d3.max(t,function(t){return t.x}):this.parseDate(this.options.x.max)},t.prototype.calculateYAxisDims=function(t){return this.definition.y.min=d3.min([d3.min(t,function(t){return t.y}),d3.min(t,function(t){return t.y2}),d3.min(t,function(t){return t.y2}),d3.min(t,function(t){return t.yMin}),d3.min(t,function(t){return t.y2Min}),d3.min(t,function(t){return t.y3Min})]),this.definition.y.max=d3.max([d3.max(t,function(t){return t.y}),d3.max(t,function(t){return t.y2}),d3.max(t,function(t){return t.y3}),d3.max(t,function(t){return t.yMax}),d3.max(t,function(t){return t.y2Max}),d3.max(t,function(t){return t.y3Max})]),this.definition.y.min===this.definition.y.max&&(this.definition.y.min=.8*this.definition.y.min,this.definition.y.max=1.2*this.definition.y.min),this.definition.y.min=null===this.options.y.min?this.definition.y.min:this.options.y.min,this.definition.y.max=null===this.options.y.max?this.definition.y.max:this.options.y.max},t.prototype.preAppend=function(){var t,i,e,o,n
return o=this.preError+"preAppend()",t=this,this.outer=d3.select(this.options.target).append("div").attr("class","line-plot-body").style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px").style("display","inline-block"),this.ctls=d3.select(this.options.target).append("div").attr("class","line-plot-controls").style("width","23px").style("height",this.definition.dimensions.height+"px").style("display","inline-block").style("vertical-align","top"),0===this.data.length&&("station"===this.options.type?(e="Select the Plot's Station",n="Station type plots allow comparison of different variables from the same station."):"parameter"===this.options.type&&(e="Select the Plot's Parameter",n="Parameter type plots allow comparison of a single paramater at multiple stations"),i=$(this.options.target).offset(),this.temp=this.outer.append("div").attr("class","new-temp-"+this.options.plotId).style("position","absolute").style("top",parseInt(i.top+this.definition.dimensions.innerHeight/2-18)+"px").style("left",parseInt(i.left+this.definition.dimensions.margin.left)+"px").style("width",this.definition.dimensions.innerWidth+"px").style("text-align","center"),this.dropdown=this.temp.append("div").attr("class","dropdown"),this.dropdown.append("a").text(e).attr("class","dropdown-toggle").attr("data-toggle","dropdown"),this.dropdown.append("ul").attr("class","dropdown-menu").selectAll("li").data(t.links).enter().append("li").append("a").text(function(t){return t.title}).on("click",function(i){return t.plotter.initVariable(t.options.plotId,i.variable,i.title)}),this.temp.append("p").text(n).style("color","#ggg").style("font-size","12px")),this.svg=this.outer.append("svg").attr("class","line-plot").attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.append("defs").append("clipPath").attr("id",this.options.target+"_clip").append("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.append("g").attr("class","line-plot-axis-x").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.append("g").attr("class","line-plot-axis-y").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)")},t.prototype.append=function(){var t,i,e,o,n,a,s
return this.initialized=!0,this.initialized?(s=this.preError+"append()",t=this,n=""+this.options.y.title,this.options.y.units&&(n=n+" "+this.options.y.units),a=-95,o=-52,"small"===this.device&&(a=-50,o=-30),this.svg.select(".line-plot-axis-y").append("text").text(n).attr("class","line-plot-y-label").attr("x",a).attr("y",o).attr("dy",".75em").attr("transform","rotate(-90)").style("font-size",this.options.font.size).style("font-weight",this.options.font.weight),this.options.y2.title&&(i=i+" "+this.options.y2.title),this.options.y3.units&&(e=e+" "+this.options.y3.units),null!==this.options.yBand.minVariable&&null!==this.options.yBand.maxVariable&&(this.lineband=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.area).attr("class","line-plot-area").style("fill",this.options.y.color).style("opacity",.15).style("stroke",function(){return d3.color(t.options.y.color).darker(1)})),null!==this.options.y2Band.minVariable&&null!==this.options.y2Band.maxVariable&&(this.lineband2=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.area2).attr("class","line-plot-area2").style("fill",this.options.y2.color).style("opacity",.25).style("stroke",function(){return d3.rgb(t.options.y2.color).darker(1)})),null!==this.options.y3Band.minVariable&&null!==this.options.y3Band.maxVariable&&(this.lineband3=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.area3).attr("class","line-plot-area3").style("fill",this.options.y3.color).style("opacity",.25).style("stroke",function(){return d3.rgb(t.options.y3.color).darker(1)})),this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.line).attr("class","line-plot-path").style("stroke",this.options.y.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.line2).attr("class","line-plot-path2").style("stroke",this.options.y2.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.line3).attr("class","line-plot-path3").style("stroke",this.options.y3.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),null!==this.options.y.maxBarValue&&this.svg.append("rect").attr("class","line-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(32)).attr("width",this.definition.dimensions.innerWidth).attr("height",1).style("color","#gggggg").style("opacity",.4),this.crosshairs=this.svg.append("g").attr("class","crosshair"),this.crosshairs.append("line").attr("class","crosshair-x").style("stroke",this.options.crosshairX.color).style("stroke-width",this.options.crosshairX.weight).style("stroke-dasharray","3, 3").style("fill","none"),this.crosshairs.append("rect").attr("class","crosshair-x-under").style("fill","rgb(255,255,255)").style("opacity",.1),this.focusCircle=this.svg.append("circle").attr("r",4).attr("id","focus-circle-1").attr("class","focus-circle").attr("fill",this.options.y.color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText=this.svg.append("text").attr("id","focus-text-1").attr("class","focus-text").attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y.color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),this.focusCircle2=this.svg.append("circle").attr("r",4).attr("id","focus-circle-2").attr("class","focus-circle").attr("fill",this.options.y2.color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText2=this.svg.append("text").attr("id","focus-text-2").attr("class","focus-text").attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y2.color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),this.focusCircle3=this.svg.append("circle").attr("r",4).attr("id","focus-circle-3").attr("class","focus-circle").attr("fill",this.options.y3.color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText3=this.svg.append("text").attr("id","focus-text-3").attr("class","focus-text").attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y3.color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(),this.appendZoomTarget()):void 0},t.prototype.update=function(){var t,i
return i=this.preError+"update()",t=this,this.svg.select(".line-plot-area").datum(this.data).attr("d",this.definition.area),this.svg.select(".line-plot-area2").datum(this.data).attr("d",this.definition.area2),this.svg.select(".line-plot-area3").datum(this.data).attr("d",this.definition.area3),this.svg.select(".line-plot-path").datum(this.data).attr("d",this.definition.line).style("stroke",this.options.y.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.svg.select(".line-plot-path2").datum(this.data).attr("d",this.definition.line2).style("stroke",this.options.y2.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.svg.select(".line-plot-path3").datum(this.data).attr("d",this.definition.line3).style("stroke",this.options.y3.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.overlay.datum(this.data),this.calculateYAxisDims(this.data),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),this.svg.select(".line-plot-area").datum(this.data).attr("d",this.definition.area),this.svg.select(".line-plot-area2").datum(this.data).attr("d",this.definition.area2),this.svg.select(".line-plot-area3").datum(this.data).attr("d",this.definition.area3),this.svg.select(".line-plot-path").datum(this.data).attr("d",this.definition.line),this.svg.select(".line-plot-path2").datum(this.data).attr("d",this.definition.line2),this.svg.select(".line-plot-path3").datum(this.data).attr("d",this.definition.line3),this.svg.select(".line-plot-axis-y").call(this.definition.yAxis)},t.prototype.removeTemp=function(){return this.temp.remove()},t.prototype.appendCrosshairTarget=function(t){var i,e
if(this.initialized)return e=this.preError+"appendCrosshairTarget()",i=this,this.overlay.datum(this.data).attr("class","overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").on("mouseover",function(){return i.plotter.showCrosshairs()}).on("mouseout",function(){return i.plotter.hideCrosshairs()}).on("mousemove",function(){var e
return e=i.setCrosshair(t),i.plotter.crosshair(t,e)})},t.prototype.appendZoomTarget=function(){var t,i
if(this.initialized)return i=this.preError+"appendZoomTarget()",t=this,this.overlay.attr("class","zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").style("cursor","move").call(this.definition.zoom,d3.zoomIdentity)},t.prototype.setZoomTransform=function(t){var i,e,o,n
if(this.initialized)return n=this.preError+".setZoomTransform(transform)",i=this,o=t?t:d3.event.transform,e=o.rescaleX(this.definition.x),this.svg.select(".line-plot-axis-x").call(this.definition.xAxis.scale(e)),this.state.range.scale=this.getDomainScale(e),this.state.mean.scale=this.getDomainMean(e),this.setDataState(),this.setIntervalState(),this.setDataRequirement(),this.setZoomState(o.k),this.definition.area=d3.area().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(t){return o.applyX(i.definition.x(t.x))}).y0(function(t){return i.definition.y(t.yMin)}).y1(function(t){return i.definition.y(t.yMax)}),this.svg.select(".line-plot-area").attr("d",this.definition.area),this.definition.line=d3.line().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(t){return o.applyX(i.definition.x(t.x))}).y(function(t){return i.definition.y(t.y)}),this.svg.select(".line-plot-path").attr("d",this.definition.line),this.definition.area2=d3.area().defined(function(t){return!isNaN(t.y2Max)&&null!==t.y2Max}).x(function(t){return o.applyX(i.definition.x(t.x))}).y0(function(t){return i.definition.y(t.y2Min)}).y1(function(t){return i.definition.y(t.y2Max)}),this.svg.select(".line-plot-area2").attr("d",this.definition.area2),this.definition.line2=d3.line().defined(function(t){return!isNaN(t.y2)&&null!==t.y2}).x(function(t){return o.applyX(i.definition.x(t.x))}).y(function(t){return i.definition.y(t.y2)}),this.svg.select(".line-plot-path2").attr("d",this.definition.line2),this.definition.area3=d3.area().defined(function(t){return!isNaN(t.y3Max)&&null!==t.y3Max}).x(function(t){return o.applyX(i.definition.x(t.x))}).y0(function(t){return i.definition.y(t.y3Min)}).y1(function(t){return i.definition.y(t.y3Max)}),this.svg.select(".line-plot-area3").attr("d",this.definition.area3),this.definition.line3=d3.line().defined(function(t){return!isNaN(t.y3)&&null!==t.y3}).x(function(t){return o.applyX(i.definition.x(t.x))}).y(function(t){return i.definition.y(t.y3)}),this.svg.select(".line-plot-path3").attr("d",this.definition.line3),this.appendCrosshairTarget(o),o},t.prototype.setCrosshair=function(t,i){var e,o,n,a,s,r,l,p,d,h,u,c,f,m
if(this.initialized)return c=this.preError+".setCrosshair(mouse)",e=this,n=this.definition.dimensions,a=this.overlay.node(),o=this.overlay.datum(),i=i?i:d3.mouse(a),f=this.definition.x.invert(i[0]+n.leftPadding),t&&(f=this.definition.x.invert(t.invertX(i[0]+n.leftPadding))),u=e.bisectDate(o,f,1),r=f.getMinutes()>=30?o[u]:o[u-1],f.getTime()<this.state.range.data.min.getTime()&&(r=o[u-1]),f.getTime()>this.state.range.data.max.getTime()&&(r=o[u-1]),l=t?t.applyX(this.definition.x(r.x)):this.definition.x(r.x),null!==this.options.y.variable&&(p=this.definition.y(r.y),isNaN(p)||this.focusCircle.attr("transform","translate(0, 0)")),null!==this.options.y2.variable&&(d=this.definition.y(r.y2),isNaN(d)||this.focusCircle2.attr("transform","translate(0, 0)")),null!==this.options.y3.variable&&(h=this.definition.y(r.y3),isNaN(h)||this.focusCircle3.attr("transform","translate(0, 0)")),(null===r||void 0===r)&&console.log("d is broken (d)",r),s=l-n.leftPadding,this.crosshairs.select(".crosshair-x").attr("x1",s).attr("y1",n.topPadding).attr("x2",s).attr("y2",n.innerHeight+n.topPadding).attr("transform","translate("+n.leftPadding+", 0)"),this.crosshairs.select(".crosshair-x-under").attr("x",s).attr("y",n.topPadding).attr("width",n.innerWidth-s).attr("height",n.innerHeight).attr("transform","translate("+n.leftPadding+", 0)"),null===this.options.y.variable||isNaN(p)||(this.focusCircle.attr("cx",l).attr("cy",p),this.focusText.attr("x",l+n.leftPadding/10).attr("y",p-n.topPadding/10).text(r.y.toFixed(2)+" "+this.options.y.units)),null===this.options.y2.variable||isNaN(d)||(this.focusCircle2.attr("cx",l).attr("cy",d),this.focusText2.attr("x",l+n.leftPadding/10).attr("y",d-n.topPadding/10).text(r.y2.toFixed(2)+" "+this.options.y2.units)),null===this.options.y3.variable||isNaN(h)||(this.focusCircle3.attr("cx",l).attr("cy",h),this.focusText3.attr("x",l+n.leftPadding/10).attr("y",h-n.topPadding/10).text(r.y3.toFixed(2)+" "+this.options.y3.units)),null!==this.options.y.variable&&null!==this.options.y2.variable&&null!==this.options.y3.variable&&(m=[],this.svg.selectAll(".focus-text").attr("transform",function(t,i){var e
return e={ind:i,y:parseInt(d3.select(this).attr("y")),offset:0},m.push(e),""}).call(function(t){return m.sort(function(t,i){return t.y-i.y}),m.forEach(function(t,i){var e
return i>0?(e=Math.max(0,m[i-1].y+18-m[i].y),0===m[i].ind&&(e=-e),m[i].offset=e):void 0})}).attr("transform",function(t,i){return"translate (0, "+m[i].offset+")"})),i},t.prototype.showCrosshair=function(){return this.initialized?(this.crosshairs.select(".crosshair-x").style("display",null),this.crosshairs.select(".crosshair-x-under").style("display",null),null!==this.options.y.variable&&(this.focusCircle.style("display",null).attr("fill",this.options.y.color),this.focusText.style("display",null).style("color",this.options.y.color).style("fill",this.options.y.color)),null!==this.options.y2.variable&&(this.focusCircle2.style("display",null).attr("fill",this.options.y2.color),this.focusText2.style("display",null).style("color",this.options.y2.color).style("fill",this.options.y2.color)),null!==this.options.y3.variable?(this.focusCircle3.style("display",null).attr("fill",this.options.y3.color),this.focusText3.style("display",null).style("color",this.options.y3.color).style("fill",this.options.y3.color)):void 0):void 0},t.prototype.hideCrosshair=function(){return this.initialized?(this.crosshairs.select(".crosshair-x").style("display","none"),this.crosshairs.select(".crosshair-x-under").style("display","none"),null!==this.options.y.variable&&(this.focusCircle.style("display","none"),this.focusText.style("display","none")),null!==this.options.y2.variable&&(this.focusCircle2.style("display","none"),this.focusText2.style("display","none")),null!==this.options.y3.variable?(this.focusCircle3.style("display","none"),this.focusText3.style("display","none")):void 0):void 0},t.prototype.appendTitle=function(t,i){var e,o,n
return o=1,e="16px",n="12px","small"===this.device&&(o=.4,e="10px",n="7px"),this.title=this.svg.append("g").attr("class","line-plot-title"),this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2-4*o).style("font-size",e).style("font-weight",600).text(t),i?this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2+12*o).style("font-size",n).text(i):void 0},t.prototype.getState=function(){return this.state},t}()}.call(this),function(){var t
window.Plotting||(window.Plotting={}),window.Plotting.Handler=t=function(){function t(t,i,e){var o,n
this.preError="Plotting.Handler",n={templateId:null,href:location.origin,target:null,dateFormat:"%Y-%m-%dT%H:%M:%SZ",refresh:500,updateLength:256,colors:{light:["rgb(53, 152, 219)","rgb(241, 196, 14)","rgb(155, 88, 181)","rgb(27, 188, 155)","rgb(52, 73, 94)","rgb(231, 126, 35)","rgb(45, 204, 112)","rgb(232, 76, 61)","rgb(149, 165, 165)"],dark:["rgb(45, 62, 80)","rgb(210, 84, 0)","rgb(39, 174, 97)","rgb(192, 57, 43)","rgb(126, 140, 141)","rgb(42, 128, 185)","rgb(239, 154, 15)","rgb(143, 68, 173)","rgb(23, 160, 134)"]}},this.options=Object.mergeDefaults(i,n),this.now=new Date,"http://localhost:5000"===this.options.href&&(this.options.href="http://dev.nwac.us"),this.endpoint=null,o={token:null,expires:null,expired:!0,admin:!1},t=Object.mergeDefaults(t,o),this.api=new window.Plotting.API(t.token),this.syncronousapi=new window.Plotting.API(t.token,!1),this.controls=new window.Plotting.Controls(this,t),this.parseDate=d3.timeParse(this.options.dateFormat),this.format=d3.utcFormat(this.options.dateFormat),this.getNow=function(){return this.format(this.now)},this.isAdmin=function(){return t.admin},this.hasAccess=function(){return this.parseDate(t.expires)>new Date&&(t.expired=!0),t.expired?!1:!0}}return t.prototype.initialize=function(){return this.getTemplate(),this.getTemplatePlotData(),this.append(),this.listen()},t.prototype.listen=function(){var t,i,e,o
e=this.template
for(t in e)i=e[t],i.proto.initialized&&(o=i.proto.getState(),o.request.data.min&&this.prependData(t),o.request.data.max&&this.appendData(t))
return setTimeout(Plotting.Handler.prototype.listen.bind(this),this.options.refresh)},t.prototype.listenTest=function(){var t,i,e
return t=0,i=this.template[t],e=i.proto.getState(),e.request.data.min&&this.prependData(t),e.request.data.max?this.appendData(t):void 0},t.prototype.listenTestLoop=function(){var t,i,e,o,n
e=this.template,o=[]
for(t in e)i=e[t],n=i.proto.getState(),n.request.data.min&&this.prependData(t),n.request.data.max?o.push(this.appendData(t)):o.push(void 0)
return o},t.prototype.getTemplate=function(t){var i,e,o,n,a
return n=this.preError+".getTemplate(...)",a=this.options.href+"/api/v5/plothandler/"+this.options.plotHandlerId,e=null,i=this,o=function(t){var e,o,a
if(null===t.responseJSON||t.responseJSON.error)return void console.log(n+".callback(...) error detected (data)",t)
try{e=JSON.parse(t.responseJSON.template_data),i.template=e.templateData}catch(a){o=a,console.log(n+".callback(...) JSON.parse error",o)}return i.parseDates(i.template)},this.syncronousapi.get(a,e,o)},t.prototype.parseDates=function(t){var i,e,o,n,a,s,r,l,p,d
for(i=this,s=function(t){var i,e
return t.includes("now")&&(e=new Date,t.includes("(")&&(i=parseInt(t.replace("(","").replace(")","").replace("now","")),e=new Date(e.getTime()+36e5*i)),t=this.format(e)),t},l=[],e=0,n=t.length;n>e;e++){for(p=t[e],r=p.dataParams,o=0,a=r.length;a>o;o++)d=r[o],d.max_datetime=s(d.max_datetime)
p.options.x.min=s(p.options.x.min),l.push(p.options.x.max=s(p.options.x.max))}return l},t.prototype.putTemplate=function(){var t,i,e,o,n
if(this.isAdmin()!==!1)return o=this.preError+".putTemplate()",n=this.options.href+"/api/v5/plothandler/",i={id:this.options.templateId,template_data:{templateData:this.template}},t=this,e=function(t){return null===t.responseJSON||t.responseJSON.error?void console.log(o+".callback(...) error detected (data)",t):console.log(o+".callback() success saving template.")},this.api.put(n,i,e)},t.prototype.getStationParamData=function(t,i){var e,o,n,a,s
return a=this.preError+".getStationParamData()",s=this.options.href+"/api/v5/measurement",e=this,o=this.template[t].dataParams[i],n=function(i){return void 0===e.template[t].data?e.template[t].data=[i.responseJSON.results]:e.template[t].data.push(i.responseJSON.results)},this.syncronousapi.get(s,o,n)},t.prototype.getTemplatePlotData=function(){var t,i,e,o,n,a,s
o=this.preError+".getPlotData()",n=this.template,a=[]
for(t in n)e=n[t],a.push(function(){var e,o
e=this.template[t].dataParams,o=[]
for(s in e)i=e[s],o.push(this.getStationParamData(t,s))
return o}.call(this))
return a},t.prototype.append=function(){var t,i,e,o,n,a,s,r,l,p,d,h,u,c
p=this.preError+".append()",t=this,d=this.template
for(r in d){if(l=d[r],u=this.utarget(this.options.target),$(this.options.target).append("<div id='"+u+"'></div>"),this.mergeTemplateOption(r),void 0===l.options.y2&&(l.options.y2={}),void 0===l.options.y3&&(l.options.y3={}),l.options.plotId=r,l.options.uuid=this.uuid(),l.options.target="#"+u,l.options.y.color=this.getColor("light",r),l.options.y2.color=this.getColor("light",parseInt(r+4)),l.options.y3.color=this.getColor("light",parseInt(r+6)),e=this.getVariableBounds(l.options.y.variable),e&&(l.options.y.min=e.min,l.options.y.max=e.max),"temperature"===l.options.y.variable&&(l.options.y.maxBarValue=32),i=new window.Plotting.Data(l.data[0]),o=l.data.length-1,o>0)for(n=s=1,h=o;h>=1?h>=s:s>=h;n=h>=1?++s:--s)i.join(l.data[n],[l.options.x.variable])
c=this.getTitle(l),a=new window.Plotting.LinePlot(this,i.get(),l.options),a.preAppend(),a.append(),this.template[r].proto=a,this.appendControls(r)}return this.isAdmin()?($(this.options.target).append('<small><a style="cusor:pointer" id="save-'+u+'">Save Template</a></small>'),$("#save-"+u).on("click",function(i){return t.putTemplate()})):void 0},t.prototype.mergeTemplateOption=function(t){var i,e
return e=this.template[t],e.options.dataParams=e.dataParams,i=e.options.dataParams.length,i>0&&(e.options.y.dataLoggerId=e.options.dataParams[0].data_logger),i>1&&(e.options.y2.dataLoggerId=e.options.dataParams[1].data_logger),i>2?e.options.y2.dataLoggerId=e.options.dataParams[2].data_logger:void 0},t.prototype.getAppendData=function(t,i,e){var o,n,a,s,r,l
return r=this.preError+".getAppendData(key, dataParams)",l=this.options.href+"/api/v5/measurement",o=this,a=this.template[i].proto.options.dataParams[e],n=this.template[i].proto.options.dataParams.length,s=function(e){var a
return a=o.template[i],void 0===a.__data&&(a.__data=[]),void 0===a.__data[t]?a.__data[t]=new window.Plotting.Data(e.responseJSON.results):a.__data[t].join(e.responseJSON.results,[a.proto.options.x.variable]),a.__data[t].getSourceCount()===n?(a.proto.initialized?(a.proto.appendData(a.__data[t].get()),a.proto.update()):(a.proto.setData(a.__data[t].get()),a.proto.append()),delete a.__data[t]):void 0},this.api.get(l,a,s)},t.prototype.prependData=function(t){var i,e,o,n,a,s,r,l
a=this.preError+".prependData()",n=this.template[t],l=n.proto.getState(),i=this.uuid(),s=n.proto.options.dataParams,r=[]
for(o in s)e=s[o],n.proto.options.dataParams[o].max_datetime=this.format(l.range.data.min),n.proto.options.dataParams[o].limit=this.options.updateLength,r.push(this.getAppendData(i,t,o))
return r},t.prototype.appendData=function(t){var i,e,o,n,a,s,r,l,p,d,h
if(l=this.preError+".appendData()",r=this.template[t],h=r.proto.getState(),o=new Date,!(h.range.data.max>=o)){i=h.range.data.max.getTime(),e=i+36e5*this.options.updateLength,n=this.uuid(),p=r.proto.options.dataParams,d=[]
for(s in p)a=p[s],r.proto.options.dataParams[s].max_datetime=this.format(new Date(e)),r.proto.options.dataParams[s].limit=this.options.updateLength,d.push(this.getAppendData(n,t,s))
return d}},t.prototype.addVariable=function(t,i){var e,o,n,a,s,r,l
r=this.template[t].proto.getState(),e=r.range.data.max.getTime(),this.setNewOptions(t,i),l=this.uuid(),a=this.template[t].proto.options.dataParams,s=[]
for(n in a)o=a[n],this.template[t].proto.options.dataParams[n].max_datetime=this.format(new Date(e)),this.template[t].proto.options.dataParams[n].limit=r.length.data,s.push(this.getAppendData(l,t,n))
return s},t.prototype.addStation=function(t,i){var e,o,n,a,s,r,l,p,d
if(!this.template[t].proto.initialized)return this.appendNew(t,i)
if(this.template[t].proto.options.y.dataLoggerId&&this.template[t].proto.options.y2.dataLoggerId&&this.template[t].proto.options.y3.dataLoggerId)return console.log("Maximum of 3 Plot selected."),null
p=this.template[t].proto.getState(),a=this.template[t].proto.options.y.variable,o=p.range.data.max.getTime(),n=$.extend(!0,{},this.template[t].proto.options.dataParams[0]),n.data_logger=i,e=this.template[t].proto.options.dataParams.push(n),this.setNewOptions(t,a,i),d=this.uuid(),l=this.template[t].proto.options.dataParams
for(r in l)s=l[r],this.template[t].proto.options.dataParams[r].max_datetime=this.format(new Date(o)),this.template[t].proto.options.dataParams[r].limit=p.length.data,this.getAppendData(d,t,r)
return this.controls.updateStationDropdown(t),this.controls.updateStationMap(t)},t.prototype.removeStation=function(t,i){var e,o,n,a
return e=null,a=this.template[t],n=this.template[t].proto,o=this.indexOfValue(a.dataParams,"data_logger",i),n.options.y.dataLoggerId===i?e="y":n.options.y2.dataLoggerId===i?e="y2":n.options.y3.dataLoggerId===i&&(e="y3"),o>-1&&(a.dataParams.splice(o,1),n.options[e]=null,n.appendData(),"y"===e&&(n.options.y=Object.mergeDefaults(n.options.y,n.defaults.y)),"y2"===e&&(n.options.y2=Object.mergeDefaults(n.options.y2,n.defaults.y2)),"y3"===e&&(n.options.y3=Object.mergeDefaults(n.options.y3,n.defaults.y3)),n.getDefinition(),n.removeData(e),n.update()),this.controls.updateStationDropdown(t),this.controls.updateStationMap(t)},t.prototype.zoom=function(t){var i,e,o,n,a
for(n=this.template,a=[],i=0,e=n.length;e>i;i++)o=n[i],a.push(o.proto.setZoomTransform(t))
return a},t.prototype.crosshair=function(t,i){var e,o,n,a,s
for(a=this.template,s=[],e=0,o=a.length;o>e;e++)n=a[e],s.push(n.proto.setCrosshair(t,i))
return s},t.prototype.showCrosshairs=function(){var t,i,e,o,n
for(o=this.template,n=[],t=0,i=o.length;i>t;t++)e=o[t],n.push(e.proto.showCrosshair())
return n},t.prototype.hideCrosshairs=function(){var t,i,e,o,n
for(o=this.template,n=[],t=0,i=o.length;i>t;t++)e=o[t],n.push(e.proto.hideCrosshair())
return n},t.prototype.appendControls=function(t){var i,e,o,n
return n="plot-controls-"+t,i="",o='<ul id="'+n+'" class="unstyled" style="list-style-type: none; padding-left: 6px;"> </ul>',$(this.template[t].proto.options.target).find(".line-plot-controls").append(o),this.controls.move(t,"#"+n,"up"),this.controls["new"]("#"+n,"down"),this.controls.remove(t,"#"+n),this.controls.move(t,"#"+n,"down"),"station"===this.template[t].type?(e=[this.template[t].proto.options.y,this.template[t].proto.options.y2,this.template[t].proto.options.y3],this.controls.appendParameterDropdown(t,"#"+n,this.template[t].proto.options.y.dataloggerid,e)):"parameter"===this.template[t].type?(e=[this.template[t].proto.options.y,this.template[t].proto.options.y2,this.template[t].proto.options.y3],this.controls.appendStationDropdown(t,"#"+n,this.template[t].proto.options.y.variable,e)):void 0},t.prototype.remove=function(t){return $(this.template[t].proto.options.target).fadeOut(500,function(){return $(this).remove()}),this.template[t]=null},t.prototype.move=function(t,i){var e,o,n
if(e=this.template[t].pageOrder,n=$(this.template[t].proto.options.target),"up"===i){if(e>1)return o=this.indexOfValue(this.template,"pageOrder",e-1),this.template[t].pageOrder--,this.template[o].pageOrder++,n.prev().insertAfter(n)}else if("down"===i&&e<this.template.length)return o=this.indexOfValue(this.template,"pageOrder",e+1),this.template[t].pageOrder++,this.template[o].pageOrder--,n.next().insertBefore(n)},t.prototype.add=function(t){var i,e,o,n,a,s
if(this.template[this.template.length-1].proto.initialized!==!1)return n=this.utarget(this.options.target),o={plotOrder:this.template.length,type:t},e={target:"#"+n,type:t,x:{variable:"datetime"}},a='<div id="'+n+'"></div>',$(this.options.target).append(a),i=this.template.push(o)-1,s=new window.Plotting.LinePlot(this,[],e),s.preAppend(),this.template[i].proto=s,this.template[i].proto.options.plotId=i,this.template[i].proto.initialized?this.appendControls(i):void 0},t.prototype.initVariable=function(t,i,e){return this.template[t].dataParams=[this.template[t-1].dataParams[0]],this.template[t].dataParams[0].data_logger=null,this.template[t].proto.options.y.variable=i,this.template[t].proto.options.y.title=e,this.appendControls(t),this.template[t].proto.removeTemp()},t.prototype.appendNew=function(t,i){var e
return e=this.template[t],e.dataParams[0].data_logger=i,e.proto.options.dataParams=e.dataParams,e.proto.options.y.dataloggerid=i,this.getAppendData(this.uuid(),t,0)},t.prototype.setNewOptions=function(t,i,e){var o,n
if(o=this.getVariableBounds(i),n=this.getVariableInfo(i),null===this.template[t].proto.options.y.variable){if(this.template[t].proto.options.y={dataLoggerId:e,variable:i,color:this.getColor("light",parseInt(t))},n&&(this.template[t].proto.options.y.title=n.title,this.template[t].proto.options.y.units=n.units),o)return this.template[t].proto.options.y.min=o.min,this.template[t].proto.options.y.max=o.max}else if(null===this.template[t].proto.options.y2.variable){if(this.template[t].proto.options.y2={dataLoggerId:e,variable:i,color:this.getColor("light",parseInt(t)+4)},n&&(this.template[t].proto.options.y2.title=n.title,this.template[t].proto.options.y2.units=n.units),o)return this.template[t].proto.options.y2.min=o.min,this.template[t].proto.options.y2.max=o.max}else if(null===this.template[t].proto.options.y3.variable&&(this.template[t].proto.options.y3={dataLoggerId:e,variable:i,color:this.getColor("light",parseInt(t)+6)},n&&(this.template[t].proto.options.y2.title=n.title,this.template[t].proto.options.y2.units=n.units),o))return this.template[t].proto.options.y3.min=o.min,this.template[t].proto.options.y3.max=o.max},t.prototype.getVariableBounds=function(t){var i
return i={battery_voltage:{min:8,max:16},net_solar:{min:0,max:800},relative_humidity:{min:0,max:100},snow_depth:{min:0,max:40},wind_direction:{min:0,max:360},precipitation:{min:0,max:.7},temperature:{min:0,max:60},wind_speed:{min:0,max:60}},i[t]},t.prototype.getVariableInfo=function(t){var i
return i={battery_voltage:{title:"Battery Voltage",units:"V"},net_solar:{title:"Solar Radiation",units:"W/m2"},relative_humidity:{title:"Relative Humidity",units:"%"},barometric_pressure:{title:"Barometric Pressure",units:"atm"},snow_depth:{title:"Snow Depth",units:'"'},wind_direction:{title:"Wind Direction",units:"°"},precipitation:{title:"Precipitation",units:'"'},temperature:{title:"Temperature",units:"°F"},wind_speed:{title:"Wind Speed",units:"mph"}},i[t]},t.prototype.getColor=function(t,i){return this.options.colors[t][i]},t.prototype.getTitle=function(t){var i
return i={},"station"===t.type?(i.title=t.station.station,i.subtitle=""):"parameter"===t.type&&(i.title=t.options.y.title,i.subtitle=""),i},t.prototype.indexOfValue=function(t,i,e){var o,n,a,s
for(n=-1,o=a=0,s=t.length-1;s>=0?s>=a:a>=s;o=s>=0?++a:--a)t[o][i]===e&&(n=o)
return n},t.prototype.uuid=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},t.prototype.utarget=function(t){return t=t.replace("#",""),t+"-"+this.uuid()},t}()}.call(this)
