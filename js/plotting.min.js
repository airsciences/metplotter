(function(){var t
window.Plotting||(window.Plotting={}),window.Plotting.API=t=function(){function t(t,i){var e
this.preError="Plotting.API",e=this.preError+".constructor()",this.async=!0,"undefined"!=typeof i&&(this.async=i),this.getAccessToken=function(){return t},this.getAccessTokenValue=function(){return"Token "+t}}return t.prototype.build=function(){var t,i,e
if(i=this.preError+".build()",e=null,XMLHttpRequest)e=new XMLHttpRequest
else try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){t=n
try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=e,console.error(i,"Cannot specify XMLHTTPRequest (error)",t)}}return e},t.prototype.get=function(t,i,e){var n,o,s
o=this.preError+".get(uri, params, callback)",s=this.build(),"undefined"!=typeof e&&(s.onreadystatechange=function(){var t,i
if(4===s.readyState){if(200!==s.status&&304!==s.status)return console.log(o+" HTTP error, (status): "+s.status),void(s=null)
i={response:s.response,responseText:s.responseText,responseJSON:null}
try{i.responseJSON=JSON.parse(i.responseText)}catch(e){t=e,i.responseJSON=null}return e(i)}}),i=this.encodeArgs("GET",i)
try{s.open("GET",t+i,this.async),s.setRequestHeader("Authorization",this.getAccessTokenValue()),s.send(null)}catch(t){n=t,console.log(o+"catch(error).",n)}},t.prototype.put=function(){var t,i,e,n
e=this.preError+".put(uri, params, callback)",n=this.build(),"undefined"!=typeof callback&&(n.onreadystatechange=function(){var t,i
if(4===n.readyState){if(200!==n.status&&304!==n.status)return console.log(e+" HTTP error, (status): "+n.status),void(n=null)
i={response:n.response,responseText:n.responseText,responseJSON:null}
try{i.responseJSON=JSON.parse(i.responseText)}catch(e){t=e,i.responseJSON=null}return callback(i)}}),t=this.encodeArgs("PUT",t)
try{n.open("PUT",uri,this.async),n.setRequestHeader("Authorization",this.getAccessToken()),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(t)}catch(t){i=t,console.log(e+"catch(error).",i)}},t.prototype.post=function(){var t,i,e,n
e=this.preError+".post(uri, params, callback)",n=build(),"undefined"!=typeof callback&&(n.onreadystatechange=function(){var t,i
if(4===n.readyState){if(200!==n.status&&304!==n.status)return console.log(e+" HTTP error, (status): "+n.status),void(n=null)
i={response:n.response,responseText:n.responseText,responseJSON:null}
try{i.responseJSON=JSON.parse(i.responseText)}catch(e){t=e,i.responseJSON=null}return callback(i)}}),t=this.encodeArgs("POST",t)
try{n.open("POST",uri,this.async),n.setRequestHeader("Authorization",this.getAccessToken()),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(t)}catch(t){i=t,console.log(e+"catch(error).",i)}},t.prototype.delete=function(){var t,i,e,n
e=this.preError+".delete(uri, params, callback)",n=this.build(),"undefined"!=typeof callback&&(n.onreadystatechange=function(){var t,i
if(4===n.readyState){if(200!==n.status&&304!==n.status)return console.log(e+" HTTP error, (status): "+n.status),void(n=null)
i={response:n.response,responseText:n.responseText,responseJSON:null}
try{i.responseJSON=JSON.parse(i.responseText)}catch(e){t=e,i.responseJSON=null}return callback(i)}}),t=this.encodeArgs("DELETE",t)
try{n.open("DELETE",uri,this.async),n.setRequestHeader("Authorization",this.getAccessToken()),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(t)}catch(t){i=t,console.log(e+"catch(error).",i)}},t.prototype.encodeArgs=function(t,i){var e,n,o,s,a
if(a=this.preError+"encodeArgs(type, json_args)",n="",e=0,"string"==typeof i)try{i=JSON.parse(i)}catch(t){s=t,console.log(a+"catch(error).",s)}if("POST"===t||"PUT"===t)n=JSON.stringify(i)
else if("GET"===t)for(o in i)n=0===e?"?"+o+"="+i[o]:n+"&"+o+"="+i[o],e++
return n},t}()}).call(this),function(){var t,i=[].indexOf||function(t){for(var i=0,e=this.length;i<e;i++)if(i in this&&this[i]===t)return i
return-1}
window.Plotting||(window.Plotting={}),window.Plotting.Controls=t=function(){function t(t,i,e){var n,o
this.preError="Plotting.Dropdown",this.plotter=t,o={target:null},this.options=Object.mergeDefaults(e,o),n={token:null,expires:null,expired:!0},i=Object.mergeDefaults(i,n),this.maps=[],this.markers=[],this.api=new window.Plotting.API(i.token)}return t.prototype.appendStationDropdown=function(t,i,e,n){var o,s,a,r,l
return r=location.protocol+"//dev.nwac.us/api/v5/dataloggerregion?sensor_name="+e,o=this,s={},l=this.uuid(),a=function(e){var s,a,r,p,d,h,u,c,f,m,y,g,x,v,b,w,P,D,T,S,M
for(c='<div class="dropdown"> <li><a id="'+l+'" class="station-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="station-dropdown-'+t+'" class="dropdown-menu dropdown-menu-right">',P=e.responseJSON.results,f=0,x=P.length;f<x;f++){for(S=P[f],h="",w="",s='<span class="station-dots">',r=0,D=S.dataloggers,y=0,v=D.length;y<v;y++)d=D[y],p=o.isCurrent(n,"dataLoggerId",d.id),p&&(r++,s=s+' <i class="icon-circle" style="color: '+p.color+'"></i>')
for(r>0&&(w='style="background-color: rgb(248,248,248)"',h='style="font-weight: 700"'),c=c+' <li class="subheader" '+w+"> <a "+h+' href="#"><i class="icon-caret-down" style="margin-right: 6px"></i> '+S.name+" "+s+'</span></a> </li> <ul class="list-group-item sublist" style="display: none;">',T=S.dataloggers,g=0,b=T.length;g<b;g++)M=T[g],p=o.isCurrent(n,"dataLoggerId",M.id),u="",p&&(u='style="color: '+p.color+'"'),m="data-logger-"+M.id+"-plot-"+t,a='<i id="'+m+'" class="icon-circle" '+u+"></i>",c=c+' <li class="station" style="padding: 1px 5px; cursor: pointer; list-style-type: none" onclick="plotter.addStation('+t+", "+M.id+')"> '+a+" "+M.datalogger_name+"</li>"
c+=" </ul>"}return c+=" </ul> </li>",$(i).prepend(c),$("#"+l).dropdown(),o.bindSubMenuEvent(".subheader"),o.appendStationMap(t,i,e.responseJSON.results,n)},this.api.get(r,s,a)},t.prototype.updateStationDropdown=function(t){var i,e,n,o
if(n=this.plotter.template[t].proto.options,i="",null!==n.y.dataLoggerId&&(e=n.y.dataLoggerId,i=' <i class="icon-circle" style="color: '+n.y.color+'"></i>',o="data-logger-"+e+"-plot-"+t,$(n.target).find("#"+o).css("color",n.y.color).attr("onclic","removeStation("+t+", "+n.y.dataLoggerId+")").parent().parent().prev().css("background-color","rgb(248,248,248)").children(":first").children(".station-dots").empty().append(i)),null!==n.y2.variable&&(e=n.y2.dataLoggerId,i=' <i class="icon-circle" style="color: '+n.y2.color+'"></i>',o="data-logger-"+e+"-plot-"+t,$(n.target).find("#"+o).css("color",n.y2.color).attr("onclic","removeStation("+t+", "+n.y2.dataLoggerId+")").parent().parent().prev().css("background-color","rgb(248,248,248)").children(":first").append(i)),null!==n.y3.variable)return e=n.y3.dataLoggerId,i=' <i class="icon-circle" style="color: '+n.y3.color+'"></i>',o="data-logger-"+e+"-plot-"+t,$(n.target).find("#"+o).css("color",n.y3.color).attr("onclic","removeStation("+t+", "+n.y3.dataLoggerId+")").parent().parent().prev().css("background-color","rgb(248,248,248)").children(":first").append(i)},t.prototype.appendParameterDropdown=function(t,e,n,o){var s,a,r,l,p
return l=location.protocol+"//dev.nwac.us/api/v5/sensortype?sensors__data_logger="+n,a={},p=this.uuid(),s=[],r=function(n){var s,a,r,l,d,h,u,c,f,m
for(l='<div class="dropdown"> <li><a id="'+p+'" class="parameter-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="param-dropdown-'+t+'" class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="'+p+'">',f=n.responseJSON.results,d=0,u=f.length;d<u;d++)c=f[d],"wind_speed_minimum"===c.field_name||"wind_speed_maximum"===c.field_name||("wind_speed_average"===c.field_name?(s=c.field_name,a=s.replace("_","-"),h=a+"-plot-"+t,m=o.variable,i.call(c.field_name,m)>=0&&(r='<i id="'+h+'" class="parameter-'+c.parameter+' icon-circle" style="color: '+o.color+'"></i>')):(s=c.field_name,a=s.replace("_","-"),h=a+"-plot-"+t,r=o.variable===c.field_name?'<i id="'+h+'" class="icon-circle" style="color: '+o.color+'"></i>':'<i id="'+h+'" class="icon-circle" style=""></i>')),l=l+' <li><a style="cursor: pointer" onclick="plotter.addVariable('+t+", '"+s+"')\">"+r+" "+c.sensortype_name+"</a></li>"
return l+=" </ul> </li> </div>",$(e).prepend(l),$("#"+p).dropdown()},this.api.get(l,a,r)},t.prototype.updateParameterDropdown=function(t){var i,e,n
if(e=this.plotter.template[t].proto.options,null!==e.y.variable&&(i=e.y.variable.replace("_","-"),n=i+"-plot-"+t,console.log("Update-Dropdown y",n),$(e.target).find("#"+n).css("color",e.y.color)),null!==e.y2.variable&&(i=e.y2.variable.replace("_","-"),n=i+"-plot-"+t,console.log("Update-Dropdown y2",n),$(e.target).find("#"+n).css("color",e.y2.color)),null!==e.y3.variable)return i=e.y3.variable.replace("_","-"),n=i+"-plot-"+t,console.log("Update-Dropdown y3",n),$(e.target).find("#"+n).css("color",e.y3.color)},t.prototype.appendStationMap=function(t,i,e,n){var o,s,a,r,l,p,d,h,u,c,f,m,y,g,x,v,b,w,P,D,T,S,M
for(o=this,M=this.uuid(),h="map-control-"+M,u='<li data-toggle="popover" data-placement="left"> <i class="icon-map-marker" style="cursor: pointer" onclick="plotter.controls.toggleMap(\''+M+'\')"></i> </li> <div class="popover" style="max-width: 356px;"> <div class="arrow"></div> <div class="popover-content"> <div id="'+h+'" style="width: 312px; height: 312px;"></div> </div> </div>',$(i).prepend(u),this.markers[M]=[],this.maps[M]=new google.maps.Map(document.getElementById(h),{center:new google.maps.LatLng(46.98,-121.98),zoom:6,mapTypeId:"terrain",zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1}),f=new google.maps.InfoWindow({content:""}),a=new google.maps.LatLngBounds,s=[],c=0,g=e.length;c<g;c++)for(D=e[c],P=D.dataloggers,m=0,x=P.length;m<x;m++)S=P[m],d="rgb(200,200,200)",T=5,w=.5,p=o.isCurrent(n,"dataLoggerId",S.id),p&&(d=p.color,T=7,w=.8,s.push(new google.maps.LatLng(S.lat,S.lon))),b=new google.maps.Marker({position:{lat:S.lat,lng:S.lon},tooltip:S.datalogger_name+" - "+S.elevation+" ft",dataloggerid:S.id,icon:{path:google.maps.SymbolPath.CIRCLE,scale:T,strokeWeight:2,fillOpacity:w,fillColor:d},selected:!1}),b.addListener("mouseover",function(){return f.setContent(this.tooltip),f.open(o.maps[M],this)}),b.addListener("mouseout",function(){return f.close()}),b.addListener("click",function(){return o.plotter.addStation(t,this.dataloggerid)}),r=this.markers[M].push(b),this.markers[M][r-1].setMap(this.maps[M])
for(y=0,v=s.length;y<v;y++)l=s[y],a.extend(l)
return this.maps[M].fitBounds(a),this.maps[M].setZoom(12)},t.prototype.toggleMap=function(t){var i,e,n
return e=$("#map-control-"+t).parent().parent().prev().offset(),$("#map-control-"+t).parent().parent().toggle().css("left",e.left-356).css("top",e.top),i=this.plotter.controls.maps[t].getCenter(),n=this.plotter.controls.maps[t].getZoom(),google.maps.event.trigger(this.plotter.controls.maps[t],"resize"),this.plotter.controls.maps[t].setCenter(i),this.plotter.controls.maps[t].setZoom(n)},t.prototype.toggle=function(t){return $(t).toggle()},t.prototype.move=function(t,i,e){var n,o
return n=this,o='<i id="move-'+t+"-"+e+'" style="cursor: pointer;" class="icon-arrow-'+e+'"></i>',$(i).append(o),$("#move-"+t+"-"+e).on("click",function(){return n.plotter.move(t,e)})},t.prototype.remove=function(t,i){var e,n
return e=this,n='<i id="remove-'+t+'" style="cursor: pointer;" class="icon-remove"></i>',$(i).append(n),$("#remove-"+t).on("click",function(){return e.plotter.remove(t)})},t.prototype.new=function(t){var i,e,n
return i=this,n=this.uuid(),e='<div class="dropdown"> <li><a id="new-'+n+'" class="new-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-plus"></i></a> <ul id="new-'+n+'-dropdown" class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="new-'+n+'"> <li><a id="new-'+n+'-parameter" style="cursor: pointer">Add Parameter Plot</a></li> <li><a id="new-'+n+'-station" style="cursor: pointer">Add Station Plot</a></li> </ul> </li> </div>',$(t).append(e),$("#new-"+n).dropdown(),$("#new-"+n+"-parameter").on("click",function(){return i.plotter.add("parameter")}),$("#new-"+n+"-station").on("click",function(){return i.plotter.add("station")})},t.prototype.uuid=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},t.prototype.isCurrent=function(t,i,e){var n,o
for(n in t)if(o=t[n],o[i]===e)return o
return!1},t.prototype.bindSubMenuEvent=function(t){return $(t).unbind().on("click",function(t){var i
return t.preventDefault(),t.stopPropagation(),i=$(this).next(),i.is(":visible")?($(this).find("i").removeClass("icon-caret-up").addClass("icon-caret-down"),i.slideUp()):($(this).find("i").removeClass("icon-caret-down").addClass("icon-caret-up"),i.slideDown())})},t.prototype.selectInitParameter=function(){var t
return t="<ul> </ul>"},t.prototype.selectInitStation=function(){var t
return t=""},t}()}.call(this),function(){var t,i=[].indexOf||function(t){for(var i=0,e=this.length;i<e;i++)if(i in this&&this[i]===t)return i
return-1}
window.Plotting||(window.Plotting={}),window.Plotting.Data=t=function(){function t(t){var i,e,n,o,s
if(this.preError="Plotting.Data.",o=this.preError+".constructor(...)",!(t instanceof Array))return void console.log(o+" data not of type array.")
for(this.data=$.extend(!0,[],t),this.sourceCount=1,i=this.data.length-1,e=n=0,s=i;0<=s?n<=s:n>=s;e=0<=s?++n:--n)void 0===this.data[e]&&console.log(o+" on construct, @data[i] is (i, row)",e,this.data[e])
this.test=function(t,i,e){var n,s,a,r,l,p
for(o=this.preError+"test(...):",s=e.length,n=0,l=!1,a=0,r=e.length;a<r;a++){if(p=e[a],void 0===t[p])throw new Error(o+" key '"+p+"' not found in primary data set.")
if(void 0===i[p])throw new Error(o+" key '"+p+"' not found in joining data set.")
t[p]instanceof Date?t[p].getTime()===i[p].getTime()&&n++:t[p]===i[p]&&n++}return n===s&&(l=!0),l}}return t.prototype.join=function(t,e){var n,o,s,a,r,l,p,d,h,u,c,f,m,y,g
m=this.preError+".join(data, onKeys)",y=[],a="_"+parseInt(this.sourceCount+1),l=Object.keys(this.data[0]),n=Object.keys(t[0]),t.length>this.data.length?(r=$.extend(!0,[],t),d=$.extend(!0,[],this.data)):(r=$.extend(!0,[],this.data),d=$.extend(!0,[],t))
for(f in r){g=r[f],s=y.push($.extend(!0,{},g))
for(o in d)if(p=d[o],u=this.test(g,p,e)){for(h in p)c=p[h],i.call(e,h)<0&&(y[s-1][h+a]=c)
d.splice(o,1)
break}}return this.sourceCount++,this.data=this._clean(y),this.data},t.prototype.merge=function(t,e){var n,o,s,a,r,l,p,d,h,u,c,f,m,y
f=this.preError+".merge(data, onKeys)",m=[],r=Object.keys(this.data[0]),n=Object.keys(t[0]),t.length>this.data.length?(a=$.extend(!0,[],t),p=$.extend(!0,[],this.data)):(a=$.extend(!0,[],this.data),p=$.extend(!0,[],t))
for(c in a){y=a[c],s=m.push($.extend(!0,{},y))
for(o in p)if(l=p[o],h=this.test(y,l,e)){for(d in l)u=l[d],i.call(e,d)<0&&(m[s-1][d]=u)
p.splice(o,1)
break}}return this.data=this._clean(m),this.data},t.prototype.append=function(t,e){var n,o,s,a,r,l,p,d,h,u,c
h=this.preError+".append(data, onKeys)",o=$.extend(!0,[],this.data),a=$.extend(!0,[],t)
for(d in o){c=o[d]
for(n in a)if(s=a[n],l=this.test(c,s,e)){for(r in s)p=s[r],i.call(e,r)<0&&(o[d][r]=p)
a.splice(n,1)}}return u=o.concat(a),this.data=this._clean(u),this.data},t.prototype.sub=function(t,i){return this.data=this._clean($.extend(!0,[],this.data.slice(t,i))),this.data},t.prototype.get=function(){return $.extend(!0,[],this.data)},t.prototype.getSourceCount=function(){return this.sourceCount},t.prototype._clean=function(t){var i,e,n,o,s
for(i=$.extend(!0,[],t),e=i.length-1,n=o=0,s=e;0<=s?o<=s:o>=s;n=0<=s?++o:--o)void 0===i[n]&&i.splice(n,1)
return $.extend(!0,[],i)},t.prototype._tryError=function(t,i){var e,n,o,s,a
for(e=t.length-1,a=[],n=o=0,s=e;0<=s?o<=s:o>=s;n=0<=s?++o:--o){if(void 0===t[n])throw console.log("@data[i] is (i, row)",n,row),new Error(i+" undefined row")
a.push(void 0)}return a},t}()}.call(this),function(){Object.mergeDefaults||(Object.mergeDefaults=function(t,i){var e,n,o,s,a
o={}
for(e in i)s=i[e],o[e]=s
for(n in t)a=t[n],o[n]=a
return o})}.call(this),function(){var t,i=[].slice
window.Plotting||(window.Plotting={}),window.Plotting.LinePlot=t=function(){function t(t,e,n){var o,s,a
this.preError="LinePlot.",this.plotter=t,this.initialized=!1,a={plotId:null,uuid:"",debug:!0,target:null,dataParams:null,merge:!1,x:{variable:null,format:"%Y-%m-%d %H:%M:%S",min:null,max:null,ticks:7},y:{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,maxBarValue:null,color:"rgb(41, 128, 185)"},yBand:{minVariable:null,maxVariable:null},y2:{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,color:"rgb(39, 174, 96)"},y2Band:{minVariable:null,maxVariable:null},y3:{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,color:"rgb(142, 68, 173)"},y3Band:{minVariable:null,maxVariable:null},zoom:{scale:{min:.3,max:5}},aspectDivisor:5,transitionDuration:500,weight:2,axisColor:"rgb(0,0,0)",font:{weight:100,size:12},crosshairX:{weight:1,color:"rgb(149,165,166)"},requestInterval:{data:336}},n.x&&(n.x=Object.mergeDefaults(n.x,a.x)),n.y&&(n.y=Object.mergeDefaults(n.y,a.y)),n.y2&&(n.y2=Object.mergeDefaults(n.y2,a.y2)),n.y3&&(n.y3=Object.mergeDefaults(n.y3,a.y3)),this.options=Object.mergeDefaults(n,a),this.device="full",this.log=function(){var t
t=1<=arguments.length?i.call(arguments,0):[]},this.options.debug&&(this.log=function(){var t
return t=1<=arguments.length?i.call(arguments,0):[],console.log(t)}),this.parseDate=d3.timeParse(this.options.x.format),this.bisectDate=d3.bisector(function(t){return t.x}).left,this.sortDatetimeAsc=function(t,i){return t.x-i.x},this.data=this.processData(e),this.getDefinition(),s=null,o=null,e.length>0&&(s=this.getDomainScale(this.definition.x),o=this.getDomainMean(this.definition.x)),this.state={range:{data:null,scale:s},length:{data:null},interval:{data:null},zoom:1,request:{data:null},mean:{scale:o}},e.length>0&&(this.setDataState(),this.setIntervalState(),this.setDataRequirement())}return t.prototype.processData=function(t){var i,e,n,o
n=[]
for(e in t)o=t[e],n[e]={x:new Date(this.parseDate(o[this.options.x.variable]).getTime()-288e5),y:o[this.options.y.variable]},null!==this.options.y2.variable&&(this.options.y.variable===this.options.y2.variable?n[e].y2=o[this.options.y2.variable+"_2"]:n[e].y2=o[this.options.y2.variable]),null!==this.options.y3.variable&&(this.options.y.variable===this.options.y3.variable||this.options.y2.variable===this.options.y3.variable?n[e].y3=o[this.options.y3.variable+"_3"]:n[e].y3=o[this.options.y3.variable]),null!==this.options.yBand.minVariable&&null!==this.options.yBand.maxVariable&&(n[e].yMin=o[this.options.yBand.minVariable],n[e].yMax=o[this.options.yBand.maxVariable]),null!==this.options.y2Band.minVariable&&null!==this.options.y2Band.maxVariable&&(n[e].y2Min=o[this.options.y2Band.minVariable],n[e].y2Max=o[this.options.y2Band.maxVariable]),null!==this.options.y3Band.minVariable&&null!==this.options.y3Band.maxVariable&&(n[e].y3Min=o[this.options.y3Band.minVariable],n[e].y3Max=o[this.options.y3Band.maxVariable])
return i=new Plotting.Data(n),n=i._clean(i.get()),n.sort(this.sortDatetimeAsc)},t.prototype.appendData=function(t){var i,e
return i=this.processData(t),e=new Plotting.Data(this.data),e.append(i,["x"]),this.data=e._clean(e.get()),this.data=this.data.sort(this.sortDatetimeAsc),this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.setDataState=function(){var t,i,e,n
for(t=this.data.length-1,i=e=0,n=t;0<=n?e<=n:e>=n;i=0<=n?++e:--e)void 0===this.data[i]&&console.log("data[i] is (i, row)",i,this.data[i])
return this.state.range.data={min:d3.min(this.data,function(t){return t.x}),max:d3.max(this.data,function(t){return t.x})},this.state.length.data=this.data.length},t.prototype.setIntervalState=function(){return this.state.interval.data={min:(this.state.range.scale.min.getTime()-this.state.range.data.min.getTime())/36e5,max:(this.state.range.data.max.getTime()-this.state.range.scale.max.getTime())/36e5}},t.prototype.setDataRequirement=function(){var t,i
return i=new Date,t=!1,this.state.range.data.max<i&&(t=this.state.interval.data.max<this.options.requestInterval.data),this.state.request.data={min:this.state.interval.data.min<this.options.requestInterval.data,max:t}},t.prototype.setZoomState=function(t){return this.state.zoom=t},t.prototype.getDomainScale=function(t){var i
return i={min:t.domain()[0],max:t.domain()[1]}},t.prototype.getDomainMean=function(t){var i
return i=new Date(d3.mean(t.domain())),i.setHours(i.getHours()+Math.round(i.getMinutes()/60)),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),i},t.prototype.getDefinition=function(){var t,i,e
return e=this.preError+"getDefinition():",t=this,this.definition={colorScale:d3.schemeCategory20},this.calculateChartDims(),this.calculateAxisDims(this.data),this.definition.xAxis=d3.axisBottom().scale(this.definition.x).ticks(Math.round($(this.options.target).width()/100)),this.definition.yAxis=d3.axisLeft().scale(this.definition.y).ticks(this.options.y.ticks),this.definition.x.domain([this.definition.x.min,this.definition.x.max]),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),i=[[-(1/0),0],[this.definition.x(new Date),this.definition.dimensions.innerHeight]],this.definition.zoom=d3.zoom().scaleExtent([this.options.zoom.scale.min,this.options.zoom.scale.max]).translateExtent(i).on("zoom",function(){var i
return i=t.setZoomTransform(),t.plotter.zoom(i)}),this.definition.line=d3.line().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(i){return t.definition.x(i.x)}).y(function(i){return t.definition.y(i.y)}),this.definition.line2=d3.line().defined(function(t){return!isNaN(t.y2)&&null!==t.y2}).x(function(i){return t.definition.x(i.x)}).y(function(i){return t.definition.y(i.y2)}),this.definition.line3=d3.line().defined(function(t){return!isNaN(t.y3)&&null!==t.y3}).x(function(i){return t.definition.x(i.x)}).y(function(i){return t.definition.y(i.y3)}),this.definition.area=d3.area().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(i){return t.definition.x(i.x)}).y0(function(i){return t.definition.y(i.yMin)}).y1(function(i){return t.definition.y(i.yMax)}),this.definition.area2=d3.area().defined(function(t){return!isNaN(t.y2)&&null!==t.y2}).x(function(i){return t.definition.x(i.x)}).y0(function(i){return t.definition.y(i.y2Min)}).y1(function(i){return t.definition.y(i.y2Max)}),this.definition.area3=d3.area().defined(function(t){return!isNaN(t.y3)&&null!==t.y3}).x(function(i){return t.definition.x(i.x)}).y0(function(i){return t.definition.y(i.y3Min)}).y1(function(i){return t.definition.y(i.y3Max)})},t.prototype.calculateChartDims=function(){var t,i,e
return e=Math.round($(this.options.target).width())-24,t=Math.round(e/this.options.aspectDivisor),e>1e3?i={top:Math.round(.04*t),right:Math.round(Math.pow(e,.3)),bottom:Math.round(.08*t),left:Math.round(Math.pow(e,.6))}:e>600?(this.device="mid",this.options.font.size=this.options.font.size/1.25,t=Math.round(e/(this.options.aspectDivisor/1.25)),i={top:Math.round(.04*t),right:Math.round(Math.pow(e,.3)),bottom:Math.round(.12*t),left:Math.round(Math.pow(e,.6))}):(this.device="small",this.options.font.size=this.options.font.size/1.5,t=Math.round(e/(this.options.aspectDivisor/1.5)),i={top:Math.round(.04*t),right:Math.round(Math.pow(e,.3)),bottom:Math.round(.18*t),left:Math.round(Math.pow(e,.6))}),this.definition.dimensions={width:e,height:t,margin:i},this.definition.dimensions.topPadding=parseInt(this.definition.dimensions.margin.top),this.definition.dimensions.bottomPadding=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom),this.definition.dimensions.leftPadding=parseInt(this.definition.dimensions.margin.left),this.definition.dimensions.innerHeight=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom-this.definition.dimensions.margin.top),this.definition.dimensions.innerWidth=parseInt(this.definition.dimensions.width-this.definition.dimensions.margin.left-this.definition.dimensions.margin.right),this.definition.x=d3.scaleTime().range([i.left,e-i.right]),this.definition.y=d3.scaleLinear().range([t-i.bottom,i.top])},t.prototype.calculateAxisDims=function(t){return this.calculateXAxisDims(t),this.calculateYAxisDims(t)},t.prototype.calculateXAxisDims=function(t){return this.definition.x.min=null===this.options.x.min?d3.min(t,function(t){return t.x}):this.parseDate(this.options.x.min),this.definition.x.max=null===this.options.x.max?d3.max(t,function(t){return t.x}):this.parseDate(this.options.x.max)},t.prototype.calculateYAxisDims=function(t){return this.definition.y.min=d3.min([d3.min(t,function(t){return t.y}),d3.min(t,function(t){return t.y2}),d3.min(t,function(t){return t.y2}),d3.min(t,function(t){return t.yMin}),d3.min(t,function(t){return t.y2Min}),d3.min(t,function(t){return t.y3Min})]),this.definition.y.max=d3.max([d3.max(t,function(t){return t.y}),d3.max(t,function(t){return t.y2}),d3.max(t,function(t){return t.y3}),d3.max(t,function(t){return t.yMax}),d3.max(t,function(t){return t.y2Max}),d3.max(t,function(t){return t.y3Max})]),this.definition.y.min===this.definition.y.max&&(this.definition.y.min=.8*this.definition.y.min,this.definition.y.max=1.2*this.definition.y.min),this.definition.y.min=null===this.options.y.min?this.definition.y.min:this.options.y.min,this.definition.y.max=null===this.options.y.max?this.definition.y.max:this.options.y.max},t.prototype.preAppend=function(){var t,i,e,n,o
return n=this.preError+"preAppend()",t=this,this.outer=d3.select(this.options.target).append("div").attr("class","line-plot-body").style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px").style("display","inline-block"),this.ctls=d3.select(this.options.target).append("div").attr("class","line-plot-controls").style("width","23px").style("height",this.definition.dimensions.height+"px").style("display","inline-block").style("vertical-align","top"),0===this.data.length&&("station"===this.options.type?(e="Select the Plot's Station",o="Station type plots allow comparison of different variables from the same station."):"parameter"===this.options.type&&(e="Select the Plot's Parameter",o="Parameter type plots allow comparison of a single paramater at multiple stations"),i=$(this.options.target).offset(),this.temp=this.outer.append("div").style("position","absolute").style("top",parseInt(i.top+this.definition.dimensions.innerHeight/2-18)+"px").style("left",parseInt(i.left+this.definition.dimensions.margin.left)+"px").style("width",this.definition.dimensions.innerWidth+"px").style("text-align","center"),this.temp.append("a").text(e).attr("onclick","buildNewPlot("+this.options.plotId+")"),this.temp.append("p").text(o).style("color","#ggg").style("font-size","12px")),this.svg=this.outer.append("svg").attr("class","line-plot").attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.append("defs").append("clipPath").attr("id",this.options.target+"_clip").append("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.append("g").attr("class","line-plot-axis-x").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.append("g").attr("class","line-plot-axis-y").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)")},t.prototype.append=function(){var t,i,e,n,o,s,a
if(this.initialized=!0,this.initialized)return a=this.preError+"append()",t=this,this.preAppend(),o=""+this.options.y.title,this.options.y.units&&(o=o+" "+this.options.y.units),s=-95,n=-46,"small"===this.device&&(s=-50,n=-30),this.svg.select(".line-plot-axis-y").append("text").text(o).attr("class","line-plot-y-label").attr("x",s).attr("y",n).attr("dy",".75em").attr("transform","rotate(-90)").style("font-size",this.options.font.size).style("font-weight",this.options.font.weight),this.options.y2.title&&(i=i+" "+this.options.y2.title),this.options.y3.units&&(e=e+" "+this.options.y3.units),null!==this.options.yBand.minVariable&&null!==this.options.yBand.maxVariable&&(this.lineband=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.area).attr("class","line-plot-area").style("fill",this.options.y.color).style("opacity",.15).style("stroke",function(){return d3.color(t.options.y.color).darker(1)})),null!==this.options.y2Band.minVariable&&null!==this.options.y2Band.maxVariable&&(this.lineband2=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.area2).attr("class","line-plot-area2").style("fill",this.options.y2.color).style("opacity",.25).style("stroke",function(){return d3.rgb(t.options.y2.color).darker(1)})),null!==this.options.y3Band.minVariable&&null!==this.options.y3Band.maxVariable&&(this.lineband3=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.area3).attr("class","line-plot-area3").style("fill",this.options.y3.color).style("opacity",.25).style("stroke",function(){return d3.rgb(t.options.y3.color).darker(1)})),this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.line).attr("class","line-plot-path").style("stroke",this.options.y.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.line2).attr("class","line-plot-path2").style("stroke",this.options.y2.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(this.data).attr("d",this.definition.line3).attr("class","line-plot-path3").style("stroke",this.options.y3.color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),null!==this.options.y.maxBarValue&&this.svg.append("rect").attr("class","line-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(32)).attr("width",this.definition.dimensions.innerWidth).attr("height",1).style("color","#gggggg").style("opacity",.4),this.crosshairs=this.svg.append("g").attr("class","crosshair"),this.crosshairs.append("line").attr("class","crosshair-x").style("stroke",this.options.crosshairX.color).style("stroke-width",this.options.crosshairX.weight).style("stroke-dasharray","3, 3").style("fill","none"),this.crosshairs.append("rect").attr("class","crosshair-x-under").style("fill","rgb(255,255,255)").style("opacity",.1),this.focusCircle=this.svg.append("circle").attr("r",4).attr("id","focus-circle-1").attr("class","focus-circle").attr("fill",this.options.y.color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText=this.svg.append("text").attr("id","focus-text-1").attr("class","focus-text").attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y.color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),this.focusCircle2=this.svg.append("circle").attr("r",4).attr("id","focus-circle-2").attr("class","focus-circle").attr("fill",this.options.y2.color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText2=this.svg.append("text").attr("id","focus-text-2").attr("class","focus-text").attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y2.color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),this.focusCircle3=this.svg.append("circle").attr("r",4).attr("id","focus-circle-3").attr("class","focus-circle").attr("fill",this.options.y3.color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText3=this.svg.append("text").attr("id","focus-text-3").attr("class","focus-text").attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y3.color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)"),this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(),this.appendZoomTarget()},t.prototype.update=function(){var t,i
return i=this.preError+"update()",t=this,this.svg.select(".line-plot-area").datum(this.data).attr("d",this.definition.area),this.svg.select(".line-plot-area2").datum(this.data).attr("d",this.definition.area2),this.svg.select(".line-plot-area3").datum(this.data).attr("d",this.definition.area3),this.svg.select(".line-plot-path").datum(this.data).attr("d",this.definition.line),this.svg.select(".line-plot-path2").datum(this.data).attr("d",this.definition.line2),this.svg.select(".line-plot-path3").datum(this.data).attr("d",this.definition.line3),this.overlay.datum(this.data),this.calculateYAxisDims(this.data),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),this.svg.select(".line-plot-area").datum(this.data).attr("d",this.definition.area),this.svg.select(".line-plot-area2").datum(this.data).attr("d",this.definition.area2),this.svg.select(".line-plot-area3").datum(this.data).attr("d",this.definition.area3),this.svg.select(".line-plot-path").datum(this.data).attr("d",this.definition.line),this.svg.select(".line-plot-path2").datum(this.data).attr("d",this.definition.line2),this.svg.select(".line-plot-path3").datum(this.data).attr("d",this.definition.line3),this.svg.select(".line-plot-axis-y").call(this.definition.yAxis)},t.prototype.appendCrosshairTarget=function(t){var i,e
if(this.initialized)return e=this.preError+"appendCrosshairTarget()",i=this,this.overlay.datum(this.data).attr("class","overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").on("mouseover",function(){return i.plotter.showCrosshairs()}).on("mouseout",function(){return i.plotter.hideCrosshairs()}).on("mousemove",function(){var e
return e=i.setCrosshair(t),i.plotter.crosshair(t,e)})},t.prototype.appendZoomTarget=function(){var t,i
if(this.initialized)return i=this.preError+"appendZoomTarget()",t=this,this.overlay.attr("class","zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").style("cursor","move").call(this.definition.zoom,d3.zoomIdentity)},t.prototype.setZoomTransform=function(t){var i,e,n,o
if(this.initialized)return o=this.preError+".setZoomTransform(transform)",i=this,n=t?t:d3.event.transform,e=n.rescaleX(this.definition.x),this.svg.select(".line-plot-axis-x").call(this.definition.xAxis.scale(e)),this.state.range.scale=this.getDomainScale(e),this.state.mean.scale=this.getDomainMean(e),this.setDataState(),this.setIntervalState(),this.setDataRequirement(),this.setZoomState(n.k),this.definition.area=d3.area().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(t){return n.applyX(i.definition.x(t.x))}).y0(function(t){return i.definition.y(t.yMin)}).y1(function(t){return i.definition.y(t.yMax)}),this.svg.select(".line-plot-area").attr("d",this.definition.area),this.definition.line=d3.line().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(t){return n.applyX(i.definition.x(t.x))}).y(function(t){return i.definition.y(t.y)}),this.svg.select(".line-plot-path").attr("d",this.definition.line),this.definition.area2=d3.area().defined(function(t){return!isNaN(t.y2Max)&&null!==t.y2Max}).x(function(t){return n.applyX(i.definition.x(t.x))}).y0(function(t){return i.definition.y(t.y2Min)}).y1(function(t){return i.definition.y(t.y2Max)}),this.svg.select(".line-plot-area2").attr("d",this.definition.area2),this.definition.line2=d3.line().defined(function(t){return!isNaN(t.y2)&&null!==t.y2}).x(function(t){return n.applyX(i.definition.x(t.x))}).y(function(t){return i.definition.y(t.y2)}),this.svg.select(".line-plot-path2").attr("d",this.definition.line2),this.definition.area3=d3.area().defined(function(t){return!isNaN(t.y3Max)&&null!==t.y3Max}).x(function(t){return n.applyX(i.definition.x(t.x))}).y0(function(t){return i.definition.y(t.y3Min)}).y1(function(t){return i.definition.y(t.y3Max)}),this.svg.select(".line-plot-area3").attr("d",this.definition.area3),this.definition.line3=d3.line().defined(function(t){return!isNaN(t.y3)&&null!==t.y3}).x(function(t){return n.applyX(i.definition.x(t.x))}).y(function(t){return i.definition.y(t.y3)}),this.svg.select(".line-plot-path3").attr("d",this.definition.line3),this.appendCrosshairTarget(n),n},t.prototype.setCrosshair=function(t,i){var e,n,o,s,a,r,l,p,d,h,u,c,f,m
if(this.initialized)return c=this.preError+".setCrosshair(mouse)",e=this,o=this.definition.dimensions,s=this.overlay.node(),n=this.overlay.datum(),i=i?i:d3.mouse(s),f=this.definition.x.invert(i[0]+o.leftPadding),t&&(f=this.definition.x.invert(t.invertX(i[0]+o.leftPadding))),u=e.bisectDate(n,f,1),r=f.getMinutes()>=30?n[u]:n[u-1],f.getTime()<this.state.range.data.min.getTime()&&(r=n[u-1]),f.getTime()>this.state.range.data.max.getTime()&&(r=n[u-1]),l=t?t.applyX(this.definition.x(r.x)):this.definition.x(r.x),null!==this.options.y.variable&&(p=this.definition.y(r.y),isNaN(p)||this.focusCircle.attr("transform","translate(0, 0)")),null!==this.options.y2.variable&&(d=this.definition.y(r.y2),isNaN(d)||this.focusCircle2.attr("transform","translate(0, 0)")),null!==this.options.y3.variable&&(h=this.definition.y(r.y3),isNaN(h)||this.focusCircle3.attr("transform","translate(0, 0)")),null!==r&&void 0!==r||console.log("d is broken (d)",r),a=l-o.leftPadding,this.crosshairs.select(".crosshair-x").attr("x1",a).attr("y1",o.topPadding).attr("x2",a).attr("y2",o.innerHeight+o.topPadding).attr("transform","translate("+o.leftPadding+", 0)"),this.crosshairs.select(".crosshair-x-under").attr("x",a).attr("y",o.topPadding).attr("width",o.innerWidth-a).attr("height",o.innerHeight).attr("transform","translate("+o.leftPadding+", 0)"),null===this.options.y.variable||isNaN(p)||(this.focusCircle.attr("cx",l).attr("cy",p),this.focusText.attr("x",l+o.leftPadding/10).attr("y",p-o.topPadding/10).text(r.y.toFixed(2)+" "+this.options.y.units)),null===this.options.y2.variable||isNaN(d)||(this.focusCircle2.attr("cx",l).attr("cy",d),this.focusText2.attr("x",l+o.leftPadding/10).attr("y",d-o.topPadding/10).text(r.y2.toFixed(2)+" "+this.options.y2.units)),null===this.options.y3.variable||isNaN(h)||(this.focusCircle3.attr("cx",l).attr("cy",h),this.focusText3.attr("x",l+o.leftPadding/10).attr("y",h-o.topPadding/10).text(r.y3.toFixed(2)+" "+this.options.y3.units)),null!==this.options.y.variable&&null!==this.options.y2.variable&&null!==this.options.y3.variable&&(m=[],this.svg.selectAll(".focus-text").attr("transform",function(t,i){var e
return e={ind:i,y:parseInt(d3.select(this).attr("y")),offset:0},m.push(e),""}).call(function(t){return m.sort(function(t,i){return t.y-i.y}),m.forEach(function(t,i){var e
if(i>0)return e=Math.max(0,m[i-1].y+18-m[i].y),0===m[i].ind&&(e=-e),m[i].offset=e})}).attr("transform",function(t,i){return"translate (0, "+m[i].offset+")"})),i},t.prototype.showCrosshair=function(){if(console.log("Plot (plotId, initialized)",this.options.plotId,this.initialized),this.initialized)return this.crosshairs.select(".crosshair-x").style("display",null),this.crosshairs.select(".crosshair-x-under").style("display",null),null!==this.options.y.variable&&(this.focusCircle.style("display",null),this.focusText.style("display",null)),null!==this.options.y2.variable&&(this.focusCircle2.style("display",null),this.focusText2.style("display",null)),null!==this.options.y3.variable?(this.focusCircle3.style("display",null),this.focusText3.style("display",null)):void 0},t.prototype.hideCrosshair=function(){if(this.initialized)return this.crosshairs.select(".crosshair-x").style("display","none"),this.crosshairs.select(".crosshair-x-under").style("display","none"),null!==this.options.y.variable&&(this.focusCircle.style("display","none"),this.focusText.style("display","none")),null!==this.options.y2.variable&&(this.focusCircle2.style("display","none"),this.focusText2.style("display","none")),null!==this.options.y3.variable?(this.focusCircle3.style("display","none"),this.focusText3.style("display","none")):void 0},t.prototype.appendTitle=function(t,i){var e,n,o
if(n=1,e="16px",o="12px","small"===this.device&&(n=.4,e="10px",o="7px"),this.title=this.svg.append("g").attr("class","line-plot-title"),this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2-4*n).style("font-size",e).style("font-weight",600).text(t),i)return this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2+12*n).style("font-size",o).text(i)},t.prototype.getState=function(){return this.state},t}()}.call(this),function(){var t
window.Plotting||(window.Plotting={}),window.Plotting.Handler=t=function(){function t(t,i,e){var n,o
this.preError="Plotting.Handler",o={target:null,dateFormat:"%Y-%m-%dT%H:%M:%SZ",refresh:500,updateLength:256,colors:{light:["rgb(53, 152, 219)","rgb(241, 196, 14)","rgb(155, 88, 181)","rgb(27, 188, 155)","rgb(52, 73, 94)","rgb(231, 126, 35)","rgb(45, 204, 112)","rgb(232, 76, 61)","rgb(149, 165, 165)"],dark:["rgb(45, 62, 80)","rgb(210, 84, 0)","rgb(39, 174, 97)","rgb(192, 57, 43)","rgb(126, 140, 141)","rgb(42, 128, 185)","rgb(239, 154, 15)","rgb(143, 68, 173)","rgb(23, 160, 134)"]}},this.options=Object.mergeDefaults(i,o),this.now=new Date,this.endpoint=null,n={token:null,expires:null,expired:!0},t=Object.mergeDefaults(t,n),this.api=new window.Plotting.API(t.token),this.syncronousapi=new window.Plotting.API(t.token,!1),this.controls=new window.Plotting.Controls(this,t),this.parseDate=d3.timeParse(this.options.dateFormat),this.format=d3.utcFormat(this.options.dateFormat),this.getNow=function(){return this.format(this.now)},this.hasAccess=function(){return this.parseDate(t.expires)>new Date&&(t.expired=!0),!t.expired}}return t.prototype.initialize=function(){return this.getTemplate(),this.getTemplatePlotData(),this.append(),this.listen()},t.prototype.listen=function(){var t,i,e,n
e=this.template
for(t in e)i=e[t],i.proto.initialized&&(n=i.proto.getState(),n.request.data.min&&this.prependData(t),n.request.data.max&&this.appendData(t))
return setTimeout(Plotting.Handler.prototype.listen.bind(this),this.options.refresh)},t.prototype.listenTest=function(){var t,i,e
if(t=0,i=this.template[t],e=i.proto.getState(),e.request.data.min&&this.prependData(t),e.request.data.max)return this.appendData(t)},t.prototype.listenTestLoop=function(){var t,i,e,n,o
e=this.template,n=[]
for(t in e)i=e[t],o=i.proto.getState(),o.request.data.min&&this.prependData(t),o.request.data.max?n.push(this.appendData(t)):n.push(void 0)
return n},t.prototype.getTemplate=function(t){var i,e,n,o,s
return o=this.preError+".getTemplate(...)",s="template/"+this.options.plotHandlerId,e=null,i=this,n=function(t){return null===t.responseJSON||t.responseJSON.error?void console.log(o+".callback(...) error detected (data)",t):i.template=t.responseJSON.templateData},this.syncronousapi.get(s,e,n)},t.prototype.getStationParamData=function(t,i){var e,n,o,s,a
return s=this.preError+".getStationParamData()",a=location.protocol+"//dev.nwac.us/api/v5/measurement",e=this,n=this.template[t].dataParams[i],o=function(i){return void 0===e.template[t].data?e.template[t].data=[i.responseJSON.results]:e.template[t].data.push(i.responseJSON.results),console.log(s+" (template.data)",e.template[t].data)},this.syncronousapi.get(a,n,o)},t.prototype.getTemplatePlotData=function(){var t,i,e,n,o,s,a
n=this.preError+".getPlotData()",o=this.template,s=[]
for(t in o)e=o[t],s.push(function(){var e,n
e=this.template[t].dataParams,n=[]
for(a in e)i=e[a],n.push(this.getStationParamData(t,a))
return n}.call(this))
return s},t.prototype.append=function(){var t,i,e,n,o,s,a,r,l,p,d,h,u,c
l=this.preError+".append()",p=this.template,h=[]
for(a in p){if(r=p[a],u=this.utarget(this.options.target),$(this.options.target).append("<div id='"+u+"'></div>"),this.mergeTemplateOption(a),void 0===r.options.y2&&(r.options.y2={}),void 0===r.options.y3&&(r.options.y3={}),r.options.plotId=a,r.options.uuid=this.uuid(),r.options.target="#"+u,r.options.y.color=this.getColor("light",a),r.options.y2.color=this.getColor("light",parseInt(a+4)),r.options.y3.color=this.getColor("light",parseInt(a+6)),i=this.getVariableBounds(r.options.y.variable),i&&(r.options.y.min=i.min,r.options.y.max=i.max),"temperature"===r.options.y.variable&&(r.options.y.maxBarValue=32),t=new window.Plotting.Data(r.data[0]),e=r.data.length-1,e>0)for(n=s=1,d=e;1<=d?s<=d:s>=d;n=1<=d?++s:--s)t.join(r.data[n],[r.options.x.variable])
c=this.getTitle(r),o=new window.Plotting.LinePlot(this,t.get(),r.options),o.append(),this.template[a].proto=o,h.push(this.appendControls(a))}return h},t.prototype.mergeTemplateOption=function(t){var i,e
if(e=this.template[t],e.options.dataParams=e.dataParams,console.log("Merge Template Options (options)",e.options),i=e.options.dataParams.length,i>0&&(e.options.y.dataLoggerId=e.options.dataParams[0].data_logger),i>1&&(e.options.y2.dataLoggerId=e.options.dataParams[1].data_logger),i>2)return e.options.y2.dataLoggerId=e.options.dataParams[2].data_logger},t.prototype.getAppendData=function(t,i,e){var n,o,s,a,r,l
return r=this.preError+".getAppendData(key, dataParams)",l="http://dev.nwac.us/api/v5/measurement",n=this,s=this.template[i].proto.options.dataParams[e],o=this.template[i].proto.options.dataParams.length,a=function(e){var s
if(s=n.template[i],void 0===s.__data&&(s.__data=[]),void 0===s.__data[t]?s.__data[t]=new window.Plotting.Data(e.responseJSON.results):s.__data[t].join(e.responseJSON.results,[s.proto.options.x.variable]),s.__data[t].getSourceCount()===o)return s.proto.appendData(s.__data[t].get()),s.proto.update(),delete s.__data[t]},this.api.get(l,s,a)},t.prototype.prependData=function(t){var i,e,n,o,s,a,r,l
s=this.preError+".prependData()",o=this.template[t],l=o.proto.getState(),i=this.uuid(),a=o.proto.options.dataParams,r=[]
for(n in a)e=a[n],o.proto.options.dataParams[n].max_datetime=this.format(l.range.data.min),o.proto.options.dataParams[n].limit=this.options.updateLength,r.push(this.getAppendData(i,t,n))
return r},t.prototype.appendData=function(t){var i,e,n,o,s,a,r,l,p,d,h
if(l=this.preError+".appendData()",r=this.template[t],h=r.proto.getState(),n=new Date,!(h.range.data.max>=n)){i=h.range.data.max.getTime(),e=i+36e5*this.options.updateLength,o=this.uuid(),p=r.proto.options.dataParams,d=[]
for(a in p)s=p[a],r.proto.options.dataParams[a].max_datetime=this.format(new Date(e)),r.proto.options.dataParams[a].limit=this.options.updateLength,d.push(this.getAppendData(o,t,a))
return d}},t.prototype.addVariable=function(t,i){var e,n,o,s,a,r,l,p,d
p=this.template[t].proto.getState(),e=this.getVariableBounds(i),n=this.getVariableInfo(i),o=p.range.data.max.getTime(),null===this.template[t].proto.options.y.variable?(this.template[t].proto.options.y={variable:i},n&&(this.template[t].proto.options.y.title=n.title,this.template[t].proto.options.y.units=n.units),e&&(this.template[t].proto.options.y.min=e.min,this.template[t].proto.options.y.max=e.max)):null===this.template[t].proto.options.y2.variable?(this.template[t].proto.options.y2={variable:i},n&&(this.template[t].proto.options.y2.title=n.title,this.template[t].proto.options.y2.units=n.units),e&&(this.template[t].proto.options.y2.min=e.min,this.template[t].proto.options.y2.max=e.max)):null===this.template[t].proto.options.y3.variable&&(this.template[t].proto.options.y3={variable:i},n&&(this.template[t].proto.options.y3.title=n.title,this.template[t].proto.options.y3.units=n.units),e&&(this.template[t].proto.options.y3.min=e.min,this.template[t].proto.options.y3.max=e.max)),d=this.uuid(),r=this.template[t].proto.options.dataParams,l=[]
for(a in r)s=r[a],this.template[t].proto.options.dataParams[a].max_datetime=this.format(new Date(o)),this.template[t].proto.options.dataParams[a].limit=p.length.data,l.push(this.getAppendData(d,t,a))
return l},t.prototype.addStation=function(t,i){var e,n,o,s,a,r,l,p,d,h,u
h=this.template[t].proto.getState(),r=this.template[t].proto.options.y.variable,e=this.getVariableBounds(r),n=this.getVariableInfo(r),s=h.range.data.max.getTime(),a=$.extend(!0,{},this.template[t].proto.options.dataParams[0]),a.data_logger=i,o=this.template[t].proto.options.dataParams.push(a),console.log("addStation: (dataLoggerId, _len, dataParams)",i,o,this.template[t].proto.options.dataParams),null===this.template[t].proto.options.y.variable?(this.template[t].proto.options.y={dataLoggerId:i,variable:r,color:this.getColor("light",parseInt(t))},n&&(this.template[t].proto.options.y.title=n.title,this.template[t].proto.options.y.units=n.units),e&&(this.template[t].proto.options.y.min=e.min,this.template[t].proto.options.y.max=e.max)):null===this.template[t].proto.options.y2.variable?(this.template[t].proto.options.y2={dataLoggerId:i,variable:r,color:this.getColor("light",parseInt(t+4))},n&&(this.template[t].proto.options.y2.title=n.title,this.template[t].proto.options.y2.units=n.units),e&&(this.template[t].proto.options.y2.min=e.min,this.template[t].proto.options.y2.max=e.max)):null===this.template[t].proto.options.y3.variable&&(this.template[t].proto.options.y3={dataLoggerId:i,variable:r,color:this.getColor("light",parseInt(t+6))},n&&(this.template[t].proto.options.y2.title=n.title,this.template[t].proto.options.y2.units=n.units),e&&(this.template[t].proto.options.y3.min=e.min,this.template[t].proto.options.y3.max=e.max)),u=this.uuid(),d=this.template[t].proto.options.dataParams
for(p in d)l=d[p],this.template[t].proto.options.dataParams[p].max_datetime=this.format(new Date(s)),this.template[t].proto.options.dataParams[p].limit=h.length.data,this.getAppendData(u,t,p)
return this.controls.updateStationDropdown(t)},t.prototype.zoom=function(t){var i,e,n,o,s
for(o=this.template,s=[],i=0,e=o.length;i<e;i++)n=o[i],s.push(n.proto.setZoomTransform(t))
return s},t.prototype.crosshair=function(t,i){var e,n,o,s,a
for(s=this.template,a=[],e=0,n=s.length;e<n;e++)o=s[e],a.push(o.proto.setCrosshair(t,i))
return a},t.prototype.showCrosshairs=function(){var t,i,e,n,o
for(n=this.template,o=[],t=0,i=n.length;t<i;t++)e=n[t],o.push(e.proto.showCrosshair())
return o},t.prototype.hideCrosshairs=function(){var t,i,e,n,o
for(n=this.template,o=[],t=0,i=n.length;t<i;t++)e=n[t],o.push(e.proto.hideCrosshair())
return o},t.prototype.appendControls=function(t){var i,e,n,o
return o="plot-controls-"+t,i="",n='<ul id="'+o+'" class="unstyled" style="list-style-type: none; padding-left: 6px;"> </ul>',$(this.template[t].proto.options.target).find(".line-plot-controls").append(n),this.controls.move(t,"#"+o,"up"),this.controls.new("#"+o,"down"),this.controls.remove(t,"#"+o),this.controls.move(t,"#"+o,"down"),"station"===this.template[t].type?(e=[this.template[t].proto.options.y,this.template[t].proto.options.y2,this.template[t].proto.options.y3],this.controls.appendParameterDropdown(t,"#"+o,this.template[t].proto.options.y.dataloggerid,e)):"parameter"===this.template[t].type?(e=[this.template[t].proto.options.y,this.template[t].proto.options.y2,this.template[t].proto.options.y3],this.controls.appendStationDropdown(t,"#"+o,this.template[t].proto.options.y.variable,e)):void 0},t.prototype.remove=function(t){return $(this.template[t].proto.options.target).fadeOut(500,function(){return $(this).remove()}),this.template[t]=null},t.prototype.move=function(t,i){var e,n,o
if(e=this.template[t].pageOrder,o=$(this.template[t].proto.options.target),"up"===i){if(e>1)return n=this.indexOfValue(this.template,"pageOrder",e-1),this.template[t].pageOrder--,this.template[n].pageOrder++,o.prev().insertAfter(o)}else if("down"===i&&e<this.template.length)return n=this.indexOfValue(this.template,"pageOrder",e+1),this.template[t].pageOrder++,this.template[n].pageOrder--,o.next().insertBefore(o)},t.prototype.add=function(t){var i,e,n,o,s
return console.log("Adding (type)",t,this.template),n=this.utarget(this.options.target),e={plotOrder:this.template.length,type:t,options:{type:t,target:"#"+n}},o='<div id="'+n+'"></div>',$(this.options.target).append(o),i=this.template.push(e)-1,s=new window.Plotting.LinePlot(this,[],e.options),console.log("Instance ready for preAppend (instance)",s),s.preAppend(),this.template[i].proto=s,this.template[i].proto.options.plotId=i,this.appendControls(i)},t.prototype.getVariableBounds=function(t){var i
return i={battery_voltage:{min:8,max:16},net_solar:{min:0,max:800},relative_humidity:{min:0,max:100},snow_depth:{min:0,max:40},wind_direction:{min:0,max:360},precipitation:{min:0,max:.7},temperature:{min:0,max:60},wind_speed:{min:0,max:60}},i[t]},t.prototype.getVariableInfo=function(t){var i
return i={battery_voltage:{title:"Battery Voltage",units:"V"},net_solar:{title:"Solar Radiation",units:"W/m2"},relative_humidity:{title:"Relative Humidity",units:"%"},barometric_pressure:{title:"Barometric Pressure",units:"atm"},snow_depth:{title:"Snow Depth",units:'"'},wind_direction:{title:"Wind Direction",units:"°"},precipitation:{title:"Precipitation",units:'"'},temperature:{title:"Temperature",units:"°F"},wind_speed:{title:"Wind Speed",units:"mph"}},i[t]},t.prototype.getColor=function(t,i){return this.options.colors[t][i]},t.prototype.getTitle=function(t){var i
return i={},"station"===t.type?(i.title=t.station.station,i.subtitle=""):"parameter"===t.type&&(i.title=t.options.y.title,i.subtitle=""),i},t.prototype.indexOfValue=function(t,i,e){var n,o,s,a
for(o=-1,n=s=0,a=t.length-1;0<=a?s<=a:s>=a;n=0<=a?++s:--s)t[n][i]===e&&(o=n)
return o},t.prototype.uuid=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},t.prototype.utarget=function(t){return t=t.replace("#",""),t+"-"+this.uuid()},t}()}.call(this)
