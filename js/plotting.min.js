(function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.API=t=function(){function t(t,e){var i
this.preError="Plotter.API",i=this.preError+".constructor()",this.async=!0,"undefined"!=typeof e&&(this.async=e),this.getAccessToken=function(){return t},this.getAccessTokenValue=function(){if(void 0===t)throw new Error(i+" Access token is not defined.")
return"Token "+t}}return t.prototype.build=function(){var t,e,i
if(e=this.preError+".build()",i=null,XMLHttpRequest)i=new XMLHttpRequest
else try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){t=o
try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){t=i,console.error(e,"Cannot specify XMLHTTPRequest (error)",t)}}return i},t.prototype.get=function(t,e,i){var o,n,r
n=this.preError+".get(uri, params, callback)",r=this.build(),"undefined"!=typeof i&&(r.onreadystatechange=function(){var t,e
if(4===r.readyState){if(200!==r.status&&304!==r.status)return console.log(n+" HTTP error, (status): "+r.status),void(r=null)
e={response:r.response,responseText:r.responseText,responseJSON:null}
try{e.responseJSON=JSON.parse(e.responseText)}catch(i){t=i,e.responseJSON=null}return i(e)}}),e=this.encodeArgs("GET",e)
try{r.open("GET",t+e,this.async),r.setRequestHeader("Authorization",this.getAccessTokenValue()),r.send(null)}catch(t){throw o=t,new Error(n+", "+o)}},t.prototype.put=function(t,e,i){var o,n,r
n=this.preError+".put(uri, params, callback)",r=this.build(),"undefined"!=typeof i&&(r.onreadystatechange=function(){var t,e
if(4===r.readyState){if(200!==r.status&&304!==r.status)return console.log(n+" HTTP error, (status): "+r.status),void(r=null)
e={response:r.response,responseText:r.responseText,responseJSON:null}
try{e.responseJSON=JSON.parse(e.responseText)}catch(i){t=i,e.responseJSON=null}return i(e)}}),e=this.encodeArgs("PUT",e)
try{r.open("PUT",t,this.async),r.setRequestHeader("Authorization",this.getAccessToken()),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(e)}catch(t){o=t,console.log(n+"catch(error).",o)}},t.prototype.post=function(t,e,i){var o,n,r
n=this.preError+".post(uri, params, callback)",r=build(),"undefined"!=typeof i&&(r.onreadystatechange=function(){var t,e
if(4===r.readyState){if(200!==r.status&&304!==r.status)return console.log(n+" HTTP error, (status): "+r.status),void(r=null)
e={response:r.response,responseText:r.responseText,responseJSON:null}
try{e.responseJSON=JSON.parse(e.responseText)}catch(i){t=i,e.responseJSON=null}return i(e)}}),e=this.encodeArgs("POST",e)
try{r.open("POST",t,this.async),r.setRequestHeader("Authorization",this.getAccessToken()),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(e)}catch(t){o=t,console.log(n+"catch(error).",o)}},t.prototype.delete=function(t,e,i){var o,n,r
n=this.preError+".delete(uri, params, callback)",r=this.build(),"undefined"!=typeof i&&(r.onreadystatechange=function(){var t,e
if(4===r.readyState){if(200!==r.status&&304!==r.status)return console.log(n+" HTTP error, (status): "+r.status),void(r=null)
e={response:r.response,responseText:r.responseText,responseJSON:null}
try{e.responseJSON=JSON.parse(e.responseText)}catch(i){t=i,e.responseJSON=null}return i(e)}}),e=this.encodeArgs("DELETE",e)
try{r.open("DELETE",t,this.async),r.setRequestHeader("Authorization",this.getAccessToken()),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(e)}catch(t){o=t,console.log(n+"catch(error).",o)}},t.prototype.encodeArgs=function(t,e){var i,o,n,r,s
if(s=this.preError+"encodeArgs(type, json_args)",o="",i=0,"string"==typeof e)try{e=JSON.parse(e)}catch(t){r=t,console.log(s+"catch(error).",r)}if("POST"===t||"PUT"===t)o=JSON.stringify(e)
else if("GET"===t)for(n in e)o=0===i?"?"+n+"="+e[n]:o+"&"+n+"="+e[n],i++
return o},t}()}).call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Colors=t=function(){function t(){var t
t={light:["rgb(53, 152, 219)","rgb(241, 196, 14)","rgb(155, 88, 181)","rgb(27, 188, 155)","rgb(52, 73, 94)","rgb(231, 126, 35)","rgb(45, 204, 112)","rgb(232, 76, 61)","rgb(149, 165, 165)"],dark:["rgb(45, 62, 80)","rgb(210, 84, 0)","rgb(39, 174, 97)","rgb(192, 57, 43)","rgb(126, 140, 141)","rgb(42, 128, 185)","rgb(239, 154, 15)","rgb(143, 68, 173)","rgb(23, 160, 134)"]},this.color=function(e,i){return t[e][i]},this.templateColors={}}return t.prototype.getInitial=function(t){var e,i,o
i=t.y
for(e in i)o=i[e],o.color=this.get(o.dataLoggerId)
return t},t.prototype.get=function(t){var e,i
return e=Object.keys(this.templateColors).length,i=2*e%7,null!=this.templateColors[t]==!1&&(this.templateColors[t]=this.color("light",i)),this.templateColors[t]},t}()}.call(this),function(){var t,e=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e
return-1}
window.Plotter||(window.Plotter={}),window.Plotter.Controls=t=function(){function t(t){this.preError="Plotter.Dropdown",this.plotter=t,this.api=this.plotter.i.api,this.current=[],this.stations=[],this.maps=[],this.markers={},this.listeners={}}return t.prototype.append=function(t){var e,i,o,n,r,s
return o=this.plotter.i.template.full()[t],i=this.plotter.plots[t].proto,n=i.options.uuid,s="plot-controls-"+n,e="",r='<ul id="'+s+'" class="unstyled" style="list-style-type: none; padding-left: 6px;"> </ul>',$(i.options.target).find(".line-plot-controls").append(r),this.move(t,"#"+s,"up"),this.new("#"+s,"down"),this.remove(t,"#"+s),this.move(t,"#"+s,"down"),"station"===o.type?this.appendParameterDropdown(t,"#"+s,i.options.y.dataloggerid):"parameter"===o.type?this.appendStationDropdown(t,"#"+s,i.options.y[0].variable):void 0},t.prototype.setCurrent=function(t){var e,i,o,n,r,s
if(e=this.plotter.plots[t].proto,this.current[t]=[],e.initialized){n=e.options.y,r=[]
for(o in n)s=n[o],null!==s.dataLoggerId?(i={dataLoggerId:parseInt(s.dataLoggerId),yTarget:o,color:s.color},r.push(this.current[t].push(i))):r.push(void 0)
return r}},t.prototype.getCurrent=function(t){return t>=0?this.current[t]:this.current},t.prototype.updateStationStates=function(t){var e,i,o,n,r,s,a,l,p
if(this.setCurrent(t),this.stations[t].length>0){for(s=this.stations[t],l=[],n=0,r=s.length;n<r;n++)a=s[n],a.displayed=[],l.push(function(){var n,r,s,l
for(s=a.dataloggers,l=[],n=0,r=s.length;n<r;n++)p=s[n],p.displayed=!1,p.color="",i=this.plotter.lib.indexOfValue(this.current[t],"dataLoggerId",p.id),i>-1?(e=this.current[t][i].color,p.displayed=!0,p.color=e,o={dataLoggerId:p.id,color:e},l.push(a.displayed.push(o))):l.push(void 0)
return l}.call(this))
return l}},t.prototype.appendStationDropdown=function(t,e,i){var o,n,r,s,a,l
return a=location.protocol+"//dev.nwac.us/api/v5/dataloggerregion?sensor_name="+i,o=this,n={},s=this.getCurrent(t),l=this.plotter.lib.uuid(),r=function(i){var n,r,s,a,p,d,h,u,c,f
for(o.stations[t]=i.responseJSON.results,r='<div class="dropdown"> <li><a id="'+l+'" class="station-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="station-dropdown-'+t+'" class="dropdown-menu pull-right">',h=o.stations[t],s=0,p=h.length;s<p;s++){for(c=h[s],n=o.plotter.lib.toLower(c.name),r=r+' <li class="subheader"> <a data-region="'+n+'" data-plot-id="'+t+'" href=""> <i class="icon-caret-down" style="margin-right: 6px"></i> <span class="region-name">'+c.name+'</span> <span class="region-dots"></span> </a> </li> <ul class="list-group-item sublist" style="display: none;">',u=c.dataloggers,a=0,d=u.length;a<d;a++)f=u[a],r=r+' <li class="station" data-station-id="'+f.id+'" data-plot-id="'+t+'" style="padding: 1px 5px; cursor: pointer; list-style-type: none"> <i class="icon-circle"></i> <span class="station-name"> '+f.datalogger_name+" | "+f.elevation+" ft </span> </li>"
r+=" </ul>"}return r+=" </ul> </li>",$(e).prepend(r),$("#"+l).dropdown(),o.bindSubMenuEvent(".subheader"),o.setCurrent(t),o.updateStationDropdown(t),o.appendStationMap(t,e,i.responseJSON.results)},this.api.get(a,n,r)},t.prototype.updateStationDropdown=function(t){var e,i,o,n,r,s,a,l,p,d,h,u,c,f,m,g
for(e=this,this.updateStationStates(t),o=function(t){var e,i,o,n
for(e="",i=0,o=t.length;i<o;i++)n=t[i],e=e+' <i style="color: '+n.color+';" class="icon-circle"></i>'
return e},i=function(t,e,i){return i.displayed?$('[data-station-id="'+i.id+'"][data-plot-id="'+t+'"]').off("click").on("click",function(t){var i
return t.stopPropagation(),i=$(this).attr("data-plot-id"),$(this).append('<i class="icon-spinner icon-spin" data-plot-id="'+i+'"></i>'),e.removeStation(i,$(this).attr("data-station-id"))}):$('[data-station-id="'+i.id+'"][data-plot-id="'+t+'"]').off("click").on("click",function(t){var i
return t.stopPropagation(),i=$(this).attr("data-plot-id"),$(this).append('<i class="icon-spinner icon-spin" data-plot-id="'+i+'"></i>'),e.addStation(i,$(this).attr("data-station-id"))})},u=this.stations[t],m=[],l=0,d=u.length;l<d;l++){for(f=u[l],r=this.plotter.lib.toLower(f.name),s="",a="",n="",f.displayed.length>0&&(n="rgb(248, 248, 248)",a=700,s=o(f.displayed)),c=f.dataloggers,p=0,h=c.length;p<h;p++)g=c[p],$('[data-station-id="'+g.id+'"][data-plot-id="'+t+'"]> i.icon-circle').css("color",g.color),i(t,e.plotter,g)
$('[data-region="'+r+'"][data-plot-id="'+t+'"]').css("background-color",n).css("font-weight",a),m.push($('[data-region="'+r+'"][data-plot-id="'+t+'"] > span.region-dots').html(s))}return m},t.prototype.removeSpinner=function(t){return $('i.icon-spinner[data-plot-id="'+t+'"]').remove()},t.prototype.appendParameterDropdown=function(t,i,o){var n,r,s,a,l,p
return l=location.protocol+"//dev.nwac.us/api/v5/sensortype?sensors__data_logger="+o,r={},a=this.getCurrent(t),p=this.plotter.lib.uuid(),n=[],s=function(o){var n,r,s,l,d,h,u,c,f,m
for(l='<div class="dropdown"> <li><a id="'+p+'" class="parameter-dropdown dropdown-toggle" role="button" data-toggle="dropdown" href="#"> <i class="icon-list"></i></a> <ul id="param-dropdown-'+t+'" class="dropdown-menu pull-right" role="menu" aria-labelledby="'+p+'">',f=o.responseJSON.results,d=0,u=f.length;d<u;d++)c=f[d],"wind_speed_minimum"===c.field_name||"wind_speed_maximum"===c.field_name||("wind_speed_average"===c.field_name?(n=c.field_name,r=n.replace("_","-"),h=r+"-plot-"+t,m=a.variable,e.call(c.field_name,m)>=0&&(s='<i id="'+h+'" class="parameter-'+c.parameter+' icon-circle" style="color: '+a.color+'"></i>')):(n=c.field_name,r=n.replace("_","-"),h=r+"-plot-"+t,s=a.variable===c.field_name?'<i id="'+h+'" class="icon-circle" style="color: '+a.color+'"></i>':'<i id="'+h+'" class="icon-circle" style=""></i>')),l=l+' <li><a style="cursor: pointer" onclick="plotter.addVariable('+t+", '"+n+"')\">"+s+" "+c.sensortype_name+"</a></li>"
return l+=" </ul> </li> </div>",$(i).prepend(l),$("#"+p).dropdown()},this.api.get(l,r,s)},t.prototype.appendStationMap=function(t,e,i){var o,n,r,s,a,l,p,d,h,u,c,f,m,g,y,v,w,x,b,S,P,_,D,T
for(o=this,h=this.getCurrent(t),u="map-control-"+this.plotter.plots[t].proto.options.uuid,c='<li data-toggle="popover" data-placement="left"> <i id="map-'+t+'" class="icon-map-marker" style="cursor: pointer"></i> </li> <div class="popover" style="max-width: 356px;"> <div class="arrow"></div> <div class="popover-content"> <div id="'+u+'" style="width: 312px; height: 312px;"></div> </div> </div>',$(e).prepend(c),console.log("Append Map (target)",e),$("#map-"+t).on("click",function(){return o.plotter.i.controls.toggleMap(t)}),this.maps[t]=new google.maps.Map(document.getElementById(u),{center:new google.maps.LatLng(46.98,-121.98),zoom:6,maxZoom:12,mapTypeId:"terrain",zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1}),m=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),this.markers[t]=[],this.listeners[t]=[],r=new google.maps.LatLngBounds,n=[],f=0,v=i.length;f<v;f++)for(_=i[f],P=_.dataloggers,g=0,w=P.length;g<w;g++)T=P[g],d="rgb(200,200,200)",D=5,S=.5,p="map-plot-"+t+"-station-"+T.id,l=o.isCurrent(h,"dataLoggerId",T.id),l&&(d=l.color,D=7,S=.8,n.push(new google.maps.LatLng(T.lat,T.lon))),b=new google.maps.Marker({position:{lat:T.lat,lng:T.lon},id:p,tooltip:T.datalogger_name+" - "+T.elevation+" ft",dataLoggerId:T.id,icon:{path:google.maps.SymbolPath.CIRCLE,scale:D,strokeWeight:2,fillOpacity:S,fillColor:d},selected:!1}),b.addListener("mouseover",function(){return m.setContent(this.tooltip),m.open(o.maps[t],this)}),b.addListener("mouseout",function(){return m.close()}),this.listeners[t][p]=b.addListener("click",function(){return o.plotter.addStation(t,this.dataLoggerId)}),s=this.markers[t][p]=b,this.markers[t][p].setMap(this.maps[t])
for(y=0,x=n.length;y<x;y++)a=n[y],r.extend(a)
return this.maps[t].fitBounds(r)},t.prototype.resetStationMap=function(t){var e,i,o,n,r
e=this,n=this.markers[t],r=[]
for(i in n)o=n[i],o.setIcon({path:google.maps.SymbolPath.CIRCLE,scale:5,strokeWeight:2,fillOpacity:.5,fillColor:"rgb(200,200,200)"}),o.set("selected",!1),e.listeners[t][i].remove(),r.push(e.listeners[t][i]=o.addListener("click",function(){var i
return i=this.get("dataLoggerId"),e.plotter.addStation(t,i)}))
return r},t.prototype.updateStationMap=function(t){var e,i,o,n,r,s,a,l
e=this,this.resetStationMap(t),l=function(t,i,o){return e.markers[t][i].setIcon({path:google.maps.SymbolPath.CIRCLE,scale:7,strokeWeight:2,fillOpacity:.8,fillColor:o}),e.markers[t][i].set("selected",!0),e.listeners[t][i].remove(),e.listeners[t][i]=e.markers[t][i].addListener("click",function(){var i
return i=this.get("dataLoggerId"),e.plotter.removeStation(t,i)})},o=this.plotter.plots[t].proto.options,s=o.y
for(r in s)a=s[r],null!==a.variable&&(i=a.variable.replace("_","-"),n="map-plot-"+t+"-station-"+a.dataLoggerId,l(t,n,a.color))
return this.boundOnSelected(t)},t.prototype.boundOnSelected=function(t){var e,i,o,n,r,s,a,l,p,d
e=this,o=new google.maps.LatLngBounds,i=[],d=this.markers[t]
for(n in d)r=d[n],a=r.get("selected"),a===!0&&i.push(r.getPosition())
for(l=0,p=i.length;l<p;l++)s=i[l],o.extend(s)
if(this.maps[t].fitBounds(o),this.maps[t].getZoom()<6)return this.maps[t].setZoom(6)},t.prototype.toggleMap=function(t){var e,i,o,n,r,s
return r=this.plotter.plots[t].proto.options.uuid,i=128,o=256,"http://localhost:5000"===location.origin&&(i=0,o=0),e=this.plotter.i.controls.maps[t].getCenter(),s=this.plotter.i.controls.maps[t].getZoom(),n=$("#map-control-"+r).parent().parent().prev().offset(),$("#map-control-"+r).parent().parent().toggle().css("left",n.left-356-i).css("top",n.top-o),google.maps.event.trigger(this.plotter.i.controls.maps[t],"resize"),this.plotter.i.controls.maps[t].setCenter(e),this.plotter.i.controls.maps[t].setZoom(s)},t.prototype.toggle=function(t){return $(t).toggle()},t.prototype.move=function(t,e,i){var o,n
return o=this,n='<i id="move-'+t+"-"+i+'" style="cursor: pointer;" class="icon-arrow-'+i+'"></i>',$(e).append(n),$("#move-"+t+"-"+i).on("click",function(){return o.plotter.move(t,i)})},t.prototype.remove=function(t,e){var i,o
return i=this,o='<i id="remove-'+t+'" style="cursor: pointer;" class="icon-remove"></i>',$(e).append(o),$("#remove-"+t).on("click",function(){return i.plotter.remove(t)})},t.prototype.new=function(t){var e,i,o,n
return e=this,n=this.plotter.lib.uuid(),i='<ul id="new-'+n+'-dropdown" class="dropdown-menu pull-right" role="menu" aria-labelledby="new-'+n+'"> <li><a id="new-'+n+'-parameter" style="cursor: pointer">Add Parameter Plot</a></li> <li><a id="new-'+n+'-station" style="cursor: pointer">Add Station Plot</a></li> </ul>',o='<div class="dropdown"> <li><a id="new-'+n+'" role="button" href="#"> <i class="icon-plus"></i> </a></li> </div>',$(t).append(o),$("#new-"+n).on("click",function(){return e.plotter.add("parameter")})},t.prototype.isCurrent=function(t,e,i){var o,n
for(o in t)if(n=t[o],n[e]===i)return n
return!1},t.prototype.bindSubMenuEvent=function(t){return $(t).unbind().on("click",function(t){var e
return t.preventDefault(),t.stopPropagation(),e=$(this).next(),e.is(":visible")?($(this).find("i").removeClass("icon-caret-up").addClass("icon-caret-down"),e.slideUp()):($(this).find("i").removeClass("icon-caret-down").addClass("icon-caret-up"),e.slideDown())})},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Crosshairs=t=function(){function t(t){this.preError="Plotter.Crosshairs.",this.plotter=t}return t.prototype.set=function(t,e){var i,o,n,r,s
for(r=this.plotter.plots,s=[],i=0,o=r.length;i<o;i++)n=r[i],null!=n?s.push(n.proto.setCrosshair(t,e)):s.push(void 0)
return s},t.prototype.show=function(){var t,e,i,o,n
for(o=this.plotter.plots,n=[],t=0,e=o.length;t<e;t++)i=o[t],null!=i?n.push(i.proto.showCrosshair()):n.push(void 0)
return n},t.prototype.hide=function(){var t,e,i,o,n
for(o=this.plotter.plots,n=[],t=0,e=o.length;t<e;t++)i=o[t],null!=i?n.push(i.proto.hideCrosshair()):n.push(void 0)
return n},t}()}.call(this),function(){var t,e=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e
return-1}
window.Plotter||(window.Plotter={}),window.Plotter.Data=t=function(){function t(t){var e
return this.preError="Plotter.Data.",e=this.preError+".constructor(...)",t instanceof Array?(this.data=$.extend(!0,[],t),this.sourceCount=1,void(this.test=function(t,i,o){var n,r,s,a,l,p
if(e=this.preError+"test(...):",null==o)throw new Error(e+" Missing onKeys (required)")
for(r=o.length,n=0,l=!1,s=0,a=o.length;s<a;s++){if(p=o[s],void 0===t[p])throw new Error(e+" key '"+p+"' not found in primary data set.")
if(void 0===i[p])throw new Error(e+" key '"+p+"' not found in joining data set.")
t[p]instanceof Date?t[p].getTime()===i[p].getTime()&&n++:t[p]===i[p]&&n++}return n===r&&(l=!0),l})):void console.log(e+" data not of type array.")}return t.prototype.join=function(t,i){var o,n,r,s,a,l,p,d,h,u,c,f,m,g,y
m=this.preError+".join(data, onKeys)",g=[],s="_"+parseInt(this.sourceCount+1),l=Object.keys(this.data[0]),o=Object.keys(t[0]),t.length>this.data.length?(a=$.extend(!0,[],t),d=$.extend(!0,[],this.data)):(a=$.extend(!0,[],this.data),d=$.extend(!0,[],t))
for(f in a){y=a[f],r=g.push($.extend(!0,{},y))
for(n in d)if(p=d[n],u=this.test(y,p,i)){for(h in p)c=p[h],e.call(i,h)<0&&(g[r-1][h+s]=c)
d.splice(n,1)
break}}return this.sourceCount++,this.data=this._clean(g),this.data},t.prototype.merge=function(t,i){var o,n,r,s,a,l,p,d,h,u,c,f,m,g
f=this.preError+".merge(data, onKeys)",m=[],a=Object.keys(this.data[0]),o=Object.keys(t[0]),t.length>this.data.length?(s=$.extend(!0,[],t),p=$.extend(!0,[],this.data)):(s=$.extend(!0,[],this.data),p=$.extend(!0,[],t))
for(c in s){g=s[c],r=m.push($.extend(!0,{},g))
for(n in p)if(l=p[n],h=this.test(g,l,i)){for(d in l)u=l[d],e.call(i,d)<0&&(m[r-1][d]=u)
p.splice(n,1)
break}}return this.data=this._clean(m),this.data},t.prototype.append=function(t,i){var o,n,r,s,a,l,p,d,h,u,c
h=this.preError+".append(data, onKeys)",n=$.extend(!0,[],this.data),s=$.extend(!0,[],t)
for(d in n){c=n[d]
for(o in s)if(r=s[o],l=this.test(c,r,i)){for(a in r)p=r[a],e.call(i,a)<0&&(n[d][a]=p)
s.splice(o,1)}}return u=n.concat(s),this.data=this._clean(u),this.data},t.prototype.appendKeys=function(t,e){var i,o,n
o=[]
for(i in t)n=t[i],o[i+e]=n
return this._clean(o)},t.prototype.sub=function(t,e){return this.data=this._clean($.extend(!0,[],this.data.slice(t,e))),this.data},t.prototype.get=function(){return $.extend(!0,[],this.data)},t.prototype.getSourceCount=function(){return this.sourceCount},t.prototype._clean=function(t){var e,i,o,n,r
for(e=$.extend(!0,[],t),i=e.length-1,o=n=0,r=i;0<=r?n<=r:n>=r;o=0<=r?++n:--n)void 0===e[o]&&e.splice(o,1)
return $.extend(!0,[],e)},t.prototype._tryError=function(t,e){var i,o,n,r,s
for(i=t.length-1,s=[],o=n=0,r=i;0<=r?n<=r:n>=r;o=0<=r?++n:--n){if(void 0===t[o])throw console.log("@data[i] is (i, row)",o,row),new Error(e+" undefined row")
s.push(void 0)}return s},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.InitialSync=t=function(){function t(t){this.preError="Plotter.InitialSync",this.plotter=t,this.sapi=this.plotter.i.sapi,this.requests={},this.endpoint=function(){return this.plotter.options.href+"/api/v5/measurement"}}return t.prototype.stageAll=function(){var t,e,i,o
for(o=[],e=t=0,i=this.plotter.i.template.plotCount()-1;0<=i?t<=i:t>=i;e=0<=i?++t:--t)o.push(this.stage(e))
return o},t.prototype.stage=function(t){var e,i,o,n,r,s,a,l
for(e=this.plotter.i.template.template[t],r=e.x.max,a=[],o=n=0,s=this.plotter.i.template.dataSetCount(t)-1;0<=s?n<=s:n>=s;o=0<=s?++n:--n)i=this.plotter.i.template.forSync(t,o,r,504),l=this.plotter.lib.uuid(),this.requests[l]={plot:t,ready:!1,requested:!1},a.push(this.requests[l].requested=this.get(t,o,l,i))
return a},t.prototype.add=function(t){var e,i,o,n,r,s
return e=this.plotter.i.template.template[t],i=this.plotter.plots[0].proto.getState(),r=this.plotter.lib.format(i.range.data[0].max),n=i.length.data[0],o=this.plotter.i.template.forSync(t,0,r,n),s=this.plotter.lib.uuid(),this.requests[s]={plotId:t,ready:!1,requested:!1},this.requests[s].requested=this.getAppend(t,0,s,o)},t.prototype.get=function(t,e,i,o){var n,r,s,a
return s=this.preError+".get()",a=this.endpoint(),n=this,r=function(o){if(null==o.responseJSON)throw new Error(s+" error requesting data.")
if(0===o.responseJSON.results.length)throw new Error(s+" no set found.")
return n.requests[i].ready=!0,n.plotter.plots[t].__data__[e]=o.responseJSON.results},this.sapi.get(a,o,r),!0},t.prototype.getAppend=function(t,e,i,o){var n,r,s,a
return s=this.preError+".get()",a=this.endpoint(),n=this,r=function(o){if(null==o.responseJSON)throw new Error(s+" error requesting data.")
if(0===o.responseJSON.results.length)throw new Error(s+" no set found.")
return null==n.plotter.plots[t].__data__&&(n.plotter.plots[t].__data__=[]),n.requests[i].ready=!0,n.plotter.plots[t].__data__[e]=o.responseJSON.results,n.plotter.plots[t].proto.setData(n.plotter.plots[t].__data__[e]),n.plotter.plots[t].proto.append(),n.plotter.i.controls.removeSpinner(t)},this.sapi.get(a,o,r),!0},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Library=t=function(){function t(t){var e,i
i={dateFormat:"%Y-%m-%dT%H:%M:%SZ"},e=this.mergeDefaults(i,t),this.parseDate=d3.timeParse(e.dateFormat),this.format=d3.utcFormat(e.dateFormat),this.getNow=function(){return this.format(new Date)}}return t.prototype.mergeDefaults=function(t,e){var i,o,n,r,s
n={}
for(i in e)r=e[i],n[i]=r
for(o in t)s=t[o],n[o]=s
return n},t.prototype.indexOfValue=function(t,e,i){var o,n,r,s
if(n=-1,t.length>0)for(o=r=0,s=t.length-1;0<=s?r<=s:r>=s;o=0<=s?++r:--r)t[o][e]===i&&(n=o)
return n},t.prototype.uuid=function(){return(4294967296*(1+Math.random())|0).toString(16).substring(1)},t.prototype.utarget=function(t){return t=t.replace("#",""),t+"-"+this.uuid()},t.prototype.toLower=function(t){return t.replace(" ","_").toLowerCase()},t}()}.call(this),function(){var t,e=[].slice
window.Plotter||(window.Plotter={}),window.Plotter.LinePlot=t=function(){function t(t,i,o){var n,r,s
this.preError="LinePlot.",this.plotter=t,this.initialized=!1,s=[{dataLoggerId:null,variable:null,ticks:5,min:null,max:null,maxBarValue:null,color:"rgb(41, 128, 185)",band:{minVariable:null,maxVariable:null}}],this.defaults={plotId:null,uuid:"",debug:!0,target:null,merge:!1,x:{variable:null,format:"%Y-%m-%dT%H:%M:%SZ",min:null,max:null,ticks:7},y:s,zoom:{scale:{min:.05,max:5}},aspectDivisor:5,transitionDuration:500,weight:2,axisColor:"rgb(0,0,0)",font:{weight:100,size:12},crosshairX:{weight:1,color:"rgb(149,165,166)"},requestInterval:{data:336}},o.x&&(o.x=this.plotter.lib.mergeDefaults(o.x,this.defaults.x)),o.y[0]=this.plotter.lib.mergeDefaults(o.y[0],this.defaults.y[0]),this.options=this.plotter.lib.mergeDefaults(o,this.defaults),this.device="full",this.links=[{variable:"battery_voltage",title:"Battery Voltage"},{variable:"temperature",title:"Temperature"},{variable:"relative_humidity",title:"Relative Humidity"},{variable:"precipitation",title:"Precipitation"},{variable:"snow_depth",title:"Snow Depth"},{variable:"wind_direction",title:"Wind Direction"},{variable:"wind_speed_average",title:"Wind Speed"},{variable:"net_solar",title:"Net Solar"},{variable:"solar_pyranometer",title:"Solar Pyranometer"},{variable:"equip_temperature",title:"Equipment Temperature"},{variable:"barometric_pressure",title:"Barometric Pressure"},{variable:"snowfall_24_hour",title:"24-Hr Snowfall"},{variable:"intermittent_snow",title:"Intermittent Snow"}],this.log=function(){var t
t=1<=arguments.length?e.call(arguments,0):[]},this.options.debug&&(this.log=function(){var t
return t=1<=arguments.length?e.call(arguments,0):[],console.log(t)}),this.parseDate=d3.timeParse(this.options.x.format),this.bisectDate=d3.bisector(function(t){return t.x}).left,this.sortDatetimeAsc=function(t,e){return t.x-e.x},this.data=this.processData(i),this.getDefinition(),this.bands=[],this.lines=[],this.focusCircle=[],this.focusText=[],r=null,n=null,i.length>0&&(r=this.getDomainScale(this.definition.x),n=this.getDomainMean(this.definition.x)),this.state={range:{data:[],scale:r},length:{data:[]},interval:{data:[]},zoom:1,request:{data:[]},requested:{data:[]},mean:{scale:n}},i[0].length>0&&(this.setDataState(),this.setIntervalState(),this.setDataRequirement())}return t.prototype.processData=function(t){var e,i,o
e=[]
for(o in t)i=t[o],e[o]=this.processDataSet(i,o)
return e},t.prototype.processDataSet=function(t,e){var i,o,n,r,s
o=this.options.y[e],r=[]
for(n in t)s=t[n],r[n]={x:new Date(this.parseDate(s[this.options.x.variable]).getTime()-288e5),y:s[o.variable]},null!=o.band&&(o.band.minVariable&&(r[n].yMin=s[o.band.minVariable]),o.band.maxVariable&&(r[n].yMax=s[o.band.maxVariable]))
return i=new Plotter.Data(r),r=i._clean(i.get()),r.sort(this.sortDatetimeAsc)},t.prototype.setData=function(t){var e,i
if(this.data=[this.processDataSet(t,0)],this.getDefinition(),i=null,e=null,t.length>0&&(i=this.getDomainScale(this.definition.x),e=this.getDomainMean(this.definition.x)),this.state.range.scale=i,this.state.mean.scale=e,t.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.addData=function(t,e){var i,o
if(this.data[e]=this.processDataSet(t,e),this.getDefinition(),o=null,i=null,t.length>0&&(o=this.getDomainScale(this.definition.x),i=this.getDomainMean(this.definition.x)),this.state.range.scale=o,this.state.mean.scale=i,t.length>0)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.appendData=function(t,e){var i,o
if(i=this.processDataSet(t,e),o=new window.Plotter.Data(this.data[e]),o.append(i,["x"]),this.data[e]=o._clean(o.get()),this.data[e]=this.data[e].sort(this.sortDatetimeAsc),this.initialized)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.removeData=function(t){if(this.data.splice(t,1),this.options.y.splice(t,1),this.svg.select(".line-plot-area-"+t).remove(),this.svg.select(".line-plot-path-"+t).remove(),this.svg.select(".focus-circle-"+t).remove(),this.svg.select(".focus-text-"+t).remove(),this.initialized)return this.setDataState(),this.setIntervalState(),this.setDataRequirement()},t.prototype.setDataState=function(){var t,e,i,o,n,r,s,a
for(t=this.data.length-1,e=i=0,n=t;0<=n?i<=n:i>=n;e=0<=n?++i:--i)void 0===this.data[e]&&console.log("data[i] is (i, row)",e,this.data[e])
r=this.data,s=[]
for(o in r)a=r[o],this.state.range.data[o]={min:d3.min(this.data[o],function(t){return t.x}),max:d3.max(this.data[o],function(t){return t.x})},s.push(this.state.length.data[o]=this.data[o].length)
return s},t.prototype.setIntervalState=function(){var t,e,i,o
e=this.data,i=[]
for(t in e)o=e[t],i.push(this.state.interval.data[t]={min:(this.state.range.scale.min.getTime()-this.state.range.data[t].min.getTime())/36e5,max:(this.state.range.data[t].max.getTime()-this.state.range.scale.max.getTime())/36e5})
return i},t.prototype.setDataRequirement=function(){var t,e,i,o,n,r
e=new Date,o=this.data,n=[]
for(i in o)r=o[i],t=!1,this.state.range.data[i].max.getTime()<e.getTime()-9e6&&(t=this.state.interval.data[i].max<this.options.requestInterval.data),this.state.request.data[i]={min:this.state.interval.data[i].min<this.options.requestInterval.data,max:t},null==this.state.requested.data[i]?n.push(this.state.requested.data[i]={min:!1,max:!1}):n.push(void 0)
return n},t.prototype.setZoomState=function(t){return this.state.zoom=t},t.prototype.getDomainScale=function(t){var e
return e={min:t.domain()[0],max:t.domain()[1]}},t.prototype.getDomainMean=function(t){var e
return e=new Date(d3.mean(t.domain())),e.setHours(e.getHours()+Math.round(e.getMinutes()/60)),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},t.prototype.getDefinition=function(){var t,e,i
return i=this.preError+"getDefinition():",t=this,this.definition={},this.calculateChartDims(),this.calculateAxisDims(this.data),this.definition.xAxis=d3.axisBottom().scale(this.definition.x).ticks(Math.round($(this.options.target).width()/100)),this.definition.yAxis=d3.axisLeft().scale(this.definition.y).ticks(this.options.y[0].ticks),this.definition.x.domain([this.definition.x.min,this.definition.x.max]),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),e=[[-(1/0),0],[this.definition.x(new Date),this.definition.dimensions.innerHeight]],this.definition.zoom=d3.zoom().scaleExtent([this.options.zoom.scale.min,this.options.zoom.scale.max]).translateExtent(e).on("zoom",function(){var e
return e=t.setZoomTransform(),t.plotter.i.zoom.set(e)}),this.definition.line=d3.line().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(e){return t.definition.x(e.x)}).y(function(e){return t.definition.y(e.y)}),this.definition.area=d3.area().defined(function(t){return!isNaN(t.yMin)&&null!==t.yMin&&!isNaN(t.yMax)&&null!==t.yMax}).x(function(e){return t.definition.x(e.x)}).y0(function(e){return t.definition.y(e.yMin)}).y1(function(e){return t.definition.y(e.yMax)})},t.prototype.calculateChartDims=function(){var t,e,i
return i=Math.round($(this.options.target).width())-24,t=Math.round(i/this.options.aspectDivisor),i>1e3?e={top:Math.round(.04*t),right:Math.round(Math.pow(i,.3)),bottom:Math.round(.12*t),left:Math.round(Math.pow(i,.6))}:i>600?(this.device="mid",this.options.font.size=this.options.font.size/1.25,t=Math.round(i/(this.options.aspectDivisor/1.25)),e={top:Math.round(.04*t),right:Math.round(Math.pow(i,.3)),bottom:Math.round(.14*t),left:Math.round(Math.pow(i,.6))}):(this.device="small",this.options.font.size=this.options.font.size/1.5,t=Math.round(i/(this.options.aspectDivisor/1.5)),e={top:Math.round(.04*t),right:Math.round(Math.pow(i,.3)),bottom:Math.round(.18*t),left:Math.round(Math.pow(i,.6))}),this.definition.dimensions={width:i,height:t,margin:e},this.definition.dimensions.topPadding=parseInt(this.definition.dimensions.margin.top),this.definition.dimensions.bottomPadding=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom),this.definition.dimensions.leftPadding=parseInt(this.definition.dimensions.margin.left),this.definition.dimensions.innerHeight=parseInt(this.definition.dimensions.height-this.definition.dimensions.margin.bottom-this.definition.dimensions.margin.top),this.definition.dimensions.innerWidth=parseInt(this.definition.dimensions.width-this.definition.dimensions.margin.left-this.definition.dimensions.margin.right),this.definition.x=d3.scaleTime().range([e.left,i-e.right]),this.definition.y=d3.scaleLinear().range([t-e.bottom,e.top])},t.prototype.calculateAxisDims=function(t){return this.calculateXAxisDims(t),this.calculateYAxisDims(t)},t.prototype.calculateXAxisDims=function(t){return null===this.options.x.min?this.definition.x.min=d3.min(t[0],function(t){return t.x}):this.definition.x.min=this.parseDate(this.options.x.min),null===this.options.x.max?this.definition.x.max=d3.max(t[0],function(t){return t.x}):this.definition.x.max=this.parseDate(this.options.x.max)},t.prototype.calculateYAxisDims=function(t){var e,i,o,n
this.definition.y.min=0,this.definition.y.max=0
for(n in t)o=t[n],i=d3.min([d3.min(o,function(t){return t.y}),d3.min(o,function(t){return t.yMin})]),e=d3.max([d3.max(o,function(t){return t.y}),d3.max(o,function(t){return t.yMax})]),(i<this.definition.y.min||void 0===this.definition.y.min)&&(this.definition.y.min=i),(e>this.definition.y.max||void 0===this.definition.y.max)&&(this.definition.y.max=e)
if(this.definition.y.min===this.definition.y.max&&(this.definition.y.min=.8*this.definition.y.min,this.definition.y.max=1.2*this.definition.y.min),null!=this.options.y[0].min&&(this.definition.y.min=this.options.y[0].min),null!=this.options.y[0].max)return this.definition.y.max=this.options.y[0].max},t.prototype.preAppend=function(){var t,e,i,o,n
return o=this.preError+"preAppend()",t=this,this.outer=d3.select(this.options.target).append("div").attr("class","line-plot-body").style("width",this.definition.dimensions.width+"px").style("height",this.definition.dimensions.height+"px").style("display","inline-block"),this.ctls=d3.select(this.options.target).append("div").attr("class","line-plot-controls").style("width","23px").style("height",this.definition.dimensions.height+"px").style("display","inline-block").style("vertical-align","top"),0===this.data[0].length&&("station"===this.options.type?(i="Select the Plot's Station",n="Station type plots allow comparison of different variables from the same station."):"parameter"===this.options.type&&(i="Select the Plot's Parameter",n="Parameter type plots allow comparison of a single paramater at multiple stations"),e=$(this.options.target).offset(),this.temp=this.outer.append("div").attr("class","new-temp-"+this.options.plotId).style("position","absolute").style("top",parseInt(e.top+this.definition.dimensions.innerHeight/2-18)+"px").style("left",parseInt(e.left+this.definition.dimensions.margin.left)+"px").style("width",this.definition.dimensions.innerWidth+"px").style("text-align","center"),this.dropdown=this.temp.append("div").attr("class","dropdown"),this.dropdown.append("a").text(i).attr("class","dropdown-toggle").attr("data-toggle","dropdown"),this.dropdown.append("ul").attr("class","dropdown-menu").selectAll("li").data(t.links).enter().append("li").append("a").text(function(t){return t.title}).on("click",function(e){return t.plotter.initializePlot(t.options.plotId,e.variable,e.title)}),this.temp.append("p").text(n).style("color","#ggg").style("font-size","12px")),this.svg=this.outer.append("svg").attr("class","line-plot").attr("width",this.definition.dimensions.width).attr("height",this.definition.dimensions.height),this.svg.append("defs").append("clipPath").attr("id",this.options.target+"_clip").append("rect").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")"),this.svg.append("g").attr("class","line-plot-axis-x").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.xAxis).attr("transform","translate(0, "+this.definition.dimensions.bottomPadding+")"),this.svg.append("g").attr("class","line-plot-axis-y").style("fill","none").style("stroke",this.options.axisColor).style("font-size",this.options.font.size).style("font-weight",this.options.font.weight).call(this.definition.yAxis).attr("transform","translate("+this.definition.dimensions.leftPadding+", 0)")},t.prototype.append=function(){var t,e,i,o,n,r,s,a,l
if(this.initialized=!0,this.initialized){r=this.preError+"append()",t=this,this.svg.select(".line-plot-axis-x").call(this.definition.xAxis),this.svg.select(".line-plot-axis-y").call(this.definition.yAxis),i=""+this.options.y[0].title,this.options.y[0].units&&(i=i+" "+this.options.y[0].units),o=-15,e=-52,"small"===this.device&&(o=-10,e=-30),this.svg.select(".line-plot-axis-y").append("text").text(i).attr("class","line-plot-y-label").attr("x",o).attr("y",e).attr("dy",".75em").attr("transform","rotate(-90)").style("font-size",this.options.font.size).style("font-weight",this.options.font.weight),s=this.data
for(n in s)l=s[n],this.bands[n]=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(l).attr("d",this.definition.area).attr("class","line-plot-area-"+n).style("fill",this.options.y[n].color).style("opacity",.15).style("stroke",function(){return d3.color(t.options.y[n].color).darker(1)}),this.lines[n]=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(l).attr("d",this.definition.line).attr("class","line-plot-path-"+n).style("stroke",this.options.y[n].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none")
null!=this.options.y[0].maxBarValue&&this.svg.append("rect").attr("class","line-plot-max-bar").attr("x",this.definition.dimensions.leftPadding).attr("y",this.definition.y(32)).attr("width",this.definition.dimensions.innerWidth).attr("height",1).style("color","#gggggg").style("opacity",.4),this.crosshairs=this.svg.append("g").attr("class","crosshair"),this.crosshairs.append("line").attr("class","crosshair-x").style("stroke",this.options.crosshairX.color).style("stroke-width",this.options.crosshairX.weight).style("stroke-dasharray","3, 3").style("fill","none"),this.crosshairs.append("rect").attr("class","crosshair-x-under").style("fill","rgb(255,255,255)").style("opacity",.1),a=this.data
for(n in a)l=a[n],this.focusCircle[n]=this.svg.append("circle").attr("r",4).attr("class","focus-circle-"+n).attr("fill",this.options.y[n].color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText[n]=this.svg.append("text").attr("class","focus-text-"+n).attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y[n].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)")
return this.overlay=this.svg.append("rect").attr("class","plot-event-target"),this.appendCrosshairTarget(),this.appendZoomTarget()}},t.prototype.update=function(){var t,e,i,o,n,r
i=this.preError+"update()",t=this,o=this.data
for(e in o)r=o[e],null!=r&&null!=t.options.y[e]&&(null===this.svg.select(".line-plot-area-"+e).node()?this.bands[e]=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(r).attr("d",this.definition.area).attr("class","line-plot-area-"+e).style("fill",this.options.y[e].color).style("opacity",.15).style("stroke",function(){return d3.color(t.options.y[e].color).darker(1)}):this.svg.select(".line-plot-area-"+e).datum(r).attr("d",this.definition.area).style("fill",this.options.y[e].color).style("stroke",function(){return d3.rgb(t.options.y[e].color).darker(1)}),null===this.svg.select(".line-plot-path-"+e).node()?(this.lines[e]=this.svg.append("g").attr("clip-path","url(#"+this.options.target+"_clip)").append("path").datum(r).attr("d",this.definition.line).attr("class","line-plot-path-"+e).style("stroke",this.options.y[e].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"),this.focusCircle[e]=this.svg.append("circle").attr("r",4).attr("class","focus-circle-"+e).attr("fill",this.options.y[e].color).attr("transform","translate(-10, -10)").style("display","none"),this.focusText[e]=this.svg.append("text").attr("class","focus-text-"+e).attr("x",9).attr("y",7).style("display","none").style("fill",this.options.y[e].color).style("text-shadow","-2px -2px 0 rgb(255,255,255), 2px -2px 0 rgb(255,255,255), -2px 2px 0 rgb(255,255,255), 2px 2px 0 rgb(255,255,255)")):this.svg.select(".line-plot-path-"+e).datum(r).attr("d",this.definition.line).style("stroke",this.options.y[e].color).style("stroke-width",Math.round(Math.pow(this.definition.dimensions.width,.1))).style("fill","none"))
this.overlay.datum(this.data),this.calculateYAxisDims(this.data),this.definition.y.domain([this.definition.y.min,this.definition.y.max]).nice(),n=this.data
for(e in n)r=n[e],this.svg.select(".line-plot-area-"+e).datum(r).attr("d",this.definition.area),this.svg.select(".line-plot-path-"+e).datum(r).attr("d",this.definition.line)
return this.svg.select(".line-plot-axis-y").call(this.definition.yAxis)},t.prototype.removeTemp=function(){return this.temp.remove()},t.prototype.appendCrosshairTarget=function(t){var e,i
if(this.initialized)return i=this.preError+"appendCrosshairTarget()",e=this,this.overlay.datum(this.data).attr("class","overlay").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").on("mouseover",function(){return e.plotter.i.crosshairs.show()}).on("mouseout",function(){return e.plotter.i.crosshairs.hide()}).on("mousemove",function(){var i
return i=e.setCrosshair(t),e.plotter.i.crosshairs.set(t,i)})},t.prototype.appendZoomTarget=function(){var t,e
if(this.initialized)return e=this.preError+"appendZoomTarget()",t=this,this.overlay.attr("class","zoom-pane").attr("width",this.definition.dimensions.innerWidth).attr("height",this.definition.dimensions.innerHeight).attr("transform","translate("+this.definition.dimensions.leftPadding+", "+this.definition.dimensions.topPadding+")").style("fill","none").style("pointer-events","all").style("cursor","move").call(this.definition.zoom,d3.zoomIdentity)},t.prototype.setZoomTransform=function(t){var e,i,o,n,r,s,a
if(this.initialized){r=this.preError+".setZoomTransform(transform)",e=this,o=t?t:d3.event.transform,i=o.rescaleX(this.definition.x),this.svg.select(".line-plot-axis-x").call(this.definition.xAxis.scale(i)),this.state.range.scale=this.getDomainScale(i),this.state.mean.scale=this.getDomainMean(i),this.setDataState(),this.setIntervalState(),this.setDataRequirement(),this.setZoomState(o.k),this.definition.area=d3.area().defined(function(t){return!isNaN(t.yMin)&&null!==t.yMin&&!isNaN(t.yMax)&&null!==t.yMax}).x(function(t){return o.applyX(e.definition.x(t.x))}).y0(function(t){return e.definition.y(t.yMin)}).y1(function(t){return e.definition.y(t.yMax)}),this.definition.line=d3.line().defined(function(t){return!isNaN(t.y)&&null!==t.y}).x(function(t){return o.applyX(e.definition.x(t.x))}).y(function(t){return e.definition.y(t.y)}),s=this.data
for(n in s)a=s[n],this.svg.select(".line-plot-area-"+n).attr("d",this.definition.area),this.svg.select(".line-plot-path-"+n).attr("d",this.definition.line)
return this.appendCrosshairTarget(o),o}},t.prototype.setCrosshair=function(t,e){var i,o,n,r,s,a,l,p,d,h,u,c,f,m,g
if(this.initialized){if(u=this.preError+".setCrosshair(mouse)",i=this,n=this.definition.dimensions,r=this.overlay.node(),o=this.overlay.datum(),e=e?e:d3.mouse(r),g=this.definition.x.invert(e[0]+n.leftPadding),t&&(g=this.definition.x.invert(t.invertX(e[0]+n.leftPadding))),d=i.bisectDate(o[0],g,1),g.getTime()<this.state.range.data[0].min.getTime()&&d--,g.getTime()>this.state.range.data[0].max.getTime()&&d--,d=g.getMinutes()>=30?d:d-1,null!=o[0][d]){l=t?t.applyX(this.definition.x(o[0][d].x)):this.definition.x(o[0][d].x),p=[],s=[],c=this.data
for(h in c)m=c[h],null!==this.options.y[h].variable&&(s[h]=o[h][d],null!=s[h]&&(p[h]=this.definition.y(s[h].y),isNaN(p[h])||null==s[h].y||this.focusCircle[h].attr("transform","translate(0, 0)")))
a=l-n.leftPadding,a>=0&&(this.crosshairs.select(".crosshair-x").attr("x1",a).attr("y1",n.topPadding).attr("x2",a).attr("y2",n.innerHeight+n.topPadding).attr("transform","translate("+n.leftPadding+", 0)"),this.crosshairs.select(".crosshair-x-under").attr("x",a).attr("y",n.topPadding).attr("width",n.innerWidth-a).attr("height",n.innerHeight).attr("transform","translate("+n.leftPadding+", 0)")),f=this.data
for(h in f)m=f[h],null===this.options.y[h].variable||isNaN(p[h])||null==s[h].y||(this.focusCircle[h].attr("cx",l).attr("cy",p[h]),this.focusText[h].attr("x",l+n.leftPadding/10).attr("y",p[h]-n.topPadding/10).text(s[h].y?s[h].y.toFixed(1)+" "+this.options.y[h].units:void 0))}return e}},t.prototype.showCrosshair=function(){var t,e,i,o
if(this.initialized){this.crosshairs.select(".crosshair-x").style("display",null),this.crosshairs.select(".crosshair-x-under").style("display",null),t=this.options.y,e=[]
for(o in t)i=t[o],null!==i.variable?(this.focusCircle[o].style("display",null).attr("fill",i.color),e.push(this.focusText[o].style("display",null).style("color",i.color).style("fill",i.color))):e.push(void 0)
return e}},t.prototype.hideCrosshair=function(){var t,e,i,o
if(this.initialized){this.crosshairs.select(".crosshair-x").style("display","none"),this.crosshairs.select(".crosshair-x-under").style("display","none"),t=this.options.y,e=[]
for(o in t)i=t[o],null!==i.variable?(this.focusCircle[o].style("display","none"),e.push(this.focusText[o].style("display","none"))):e.push(void 0)
return e}},t.prototype.appendTitle=function(t,e){var i,o,n
if(o=1,i="16px",n="12px","small"===this.device&&(o=.4,i="10px",n="7px"),this.title=this.svg.append("g").attr("class","line-plot-title"),this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2-4*o).style("font-size",i).style("font-weight",600).text(t),e)return this.title.append("text").attr("x",this.definition.dimensions.margin.left+10).attr("y",this.definition.dimensions.margin.top/2+12*o).style("font-size",n).text(e)},t.prototype.getState=function(){return this.state},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.LiveSync=t=function(){function t(t){this.preError="Plotter.LiveSync",this.plotter=t,this.api=this.plotter.i.api,this.requests={},this.endpoint=function(){return this.plotter.options.href+"/api/v5/measurement"}}return t.prototype.append=function(t,e,i){var o,n,r,s,a,l,p
return o=new Date,i.range.data[e].max>=o||(r=i.range.data[e].max.getTime(),l=new Date(r+36e5*this.plotter.options.updateLength),a=this.plotter.lib.format(new Date(l)),s=this.plotter.options.updateLength,n=this.plotter.i.template.forSync(t,e,a,s),p=this.plotter.lib.uuid(),this.requests[p]={ready:!1,requested:!1},this.requests[p].requested=this.get(t,e,p,n,"max"))},t.prototype.prepend=function(t,e,i){var o,n,r,s
return r=this.plotter.lib.format(i.range.data[e].min),n=this.plotter.options.updateLength,o=this.plotter.i.template.forSync(t,e,r,n),s=this.plotter.lib.uuid(),this.requests[s]={ready:!1,requested:!1},this.requests[s].requested=this.get(t,e,s,o,"min")},t.prototype.add=function(t,e,i){var o,n,r,s,a
return o=new Date,i.range.data[0].max>=o||(s=this.plotter.lib.format(i.range.data[0].max),r=i.length.data[0],n=this.plotter.i.template.forSync(t,e,s,r),a=this.plotter.lib.uuid(),console.log("Adding line (plotId, dataSetId, args)",t,e,n),this.requests[a]={ready:!1,requested:!1},this.requests[a].requested=this.getNew(t,e,a,n))},t.prototype.get=function(t,e,i,o,n){var r,s,a,l
return a=this.preError+".get()",l=this.endpoint(),r=this,s=function(o){var s,l
if(s=r.plotter.plots[t].proto,null==o.responseJSON)throw new Error(a+" error requesting data.")
if(l=o.responseJSON.results,void 0===r.plotter.plots[t].__data__)throw new Error(a+" appending to empty data set.")
if(0===o.responseJSON.results.length)throw new Error(a+" no new data found.")
return s.appendData(l,e),s.update(),r.requests[i].ready=!0,s.state.requested.data[e][n]=!1,r.plotter.updates=r.plotter.updates<0?0:r.plotter.updates-1},this.api.get(l,o,s),!0},t.prototype.getNew=function(t,e,i,o){var n,r,s,a
return s=this.preError+".getNew()",a=this.endpoint(),n=this,r=function(o){var r,a
if(r=n.plotter.plots[t].proto,null==o.responseJSON)throw new Error(s+" error requesting data.")
if(a=o.responseJSON.results,void 0===n.plotter.plots[t].__data__)throw new Error(s+" appending to empty data set.")
if(0===o.responseJSON.results.length)throw new Error(s+" no new data found.")
return console.log("Adding data to plot (_result, dataSetId)",a,e),r.addData(a,e),r.update(),n.requests[i].ready=!0,n.plotter.i.controls.removeSpinner(t),n.plotter.updates=n.plotter.updates<0?0:n.plotter.updates-1},this.api.get(a,o,r),!0},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Now=t=function(){function t(t,e){return this.parse=function(e){var i,o
return e.includes("now")&&(o=new Date,e.includes("(")&&(i=parseInt(e.replace("(","").replace(")","").replace("now","")),o=new Date(o.getTime()+36e5*i)),e=t(o)),e},this.datetime=this.parse(e),this.datetime}return t.prototype.set=function(t){return this.datetime=this.parse(t),!0},t.prototype.get=function(){return this.datetime},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Handler=t=function(){function t(t,e,i){var o,n,r,s,a,l
this.preError="Plotter.Handler",r=e.dateFormat?e.dateFormat:"%Y-%m-%dT%H:%M:%SZ",s={dateFormat:r},this.lib=new window.Plotter.Library(s),n="http://localhost:5000"===location.origin?"http://dev.nwac.us":location.origin,l={templateId:null,href:n,target:null,dateFormat:"%Y-%m-%dT%H:%M:%SZ",refresh:500,updateLength:168,updateLimit:6},this.options=this.lib.mergeDefaults(e,l),o={token:null,admin:!1},a=this.lib.mergeDefaults(t,o),this.isAdmin=function(){return a.admin},this.i={api:new window.Plotter.API(a.token),sapi:new window.Plotter.API(a.token,!1)},this.i.template=new window.Plotter.Template(this),this.i.controls=new window.Plotter.Controls(this),this.i.initialsync=new window.Plotter.InitialSync(this),this.i.livesync=new window.Plotter.LiveSync(this),this.i.zoom=new window.Plotter.Zoom(this),this.i.crosshairs=new window.Plotter.Crosshairs(this),this.i.specs=new window.Plotter.Specs,this.i.colors=new window.Plotter.Colors,this.plots=[],this.updates=0,this.isReady=function(){return this.updates<=this.options.updateLimit}}return t.prototype.initialize=function(){return this.i.template.get(),this.initializePlots(),this.i.initialsync.stageAll(),this.append(),this.listen()},t.prototype.initializePlots=function(){var t,e,i,o,n
e=this.i.template.full(),o=[]
for(i in e)n=e[i],t={proto:null,__data__:[]},o.push(this.plots[i]=t)
return o},t.prototype.listen=function(t){var e,i,o,n,r,s,a
n=this.plots
for(o in n)if(i=n[o],null!=i&&i.proto.initialized){a=i.proto.getState(),r=a.request.data
for(e in r)s=r[e],s.min===!0&&this.isReady()&&i.proto.state.requested.data[e].min===!1&&(this.updates++,i.proto.state.requested.data[e].min=!0,this.i.livesync.prepend(o,e,a)),s.max===!0&&this.isReady()&&i.proto.state.requested.data[e].max===!1&&(this.updates++,i.proto.state.requested.data[e].max=!0,this.i.livesync.append(o,e,a))}if(!t)return setTimeout(Plotter.Handler.prototype.listen.bind(this),this.options.refresh)},t.prototype.append=function(){var t,e,i,o,n
i=this.plots,o=[]
for(e in i)n=i[e],n.uuid=this.lib.uuid(),$(this.options.target).append('<div id="outer-'+n.uuid+'"></div>'),t=this.i.template.forPlots(e),t=this.i.colors.getInitial(t),t.target="#outer-"+n.uuid,t.uuid=n.uuid,console.log("Options.y",t.y),n.proto=new window.Plotter.LinePlot(this,n.__data__,t),n.proto.preAppend(),n.proto.append(),console.log("Options.y",t.y),o.push(this.i.controls.append(e))
return o},t.prototype.remove=function(t){return $(this.plots[t].proto.options.target).fadeOut(500,function(){return $(this).remove()}),this.i.template.removePlot(t),delete this.plots[t]},t.prototype.move=function(t,e){var i,o,n,r,s,a
if(r=this.i.template.template,o=r[t],i=o.pageOrder,a=$(this.plots[t].proto.options.target),"up"===e){if(i>1)return s=this.lib.indexOfValue(r,"pageOrder",i-1),n=r[s],o.pageOrder--,n.pageOrder++,a.prev().insertAfter(a)}else if("down"===e&&i<r.length)return s=this.lib.indexOfValue(r,"pageOrder",i+1),n=r[s],o.pageOrder++,n.pageOrder--,a.next().insertBefore(a)},t.prototype.add=function(t){var e,i,o,n,r
return r=this.lib.uuid(),i="outer-"+r,n={plotOrder:this.i.template.plotCount()+1,type:t,target:"#"+i,y:[]},o='<div id="'+i+'"></div>',$(this.options.target).append(o),e=this.i.template.add(n),this.plots[e]={},this.plots[e].proto=new window.Plotter.LinePlot(this,[[]],n),this.plots[e].proto.preAppend(),this.plots[e].proto.options.plotId=e,this.plots[e].proto.options.uuid=r},t.prototype.initializePlot=function(t,e,i){var o,n
return n=this.i.specs.getOptions(e,null),this.i.template.template[t].x=$.extend(!0,{},this.i.template.template[0].x),this.i.template.template[t].y=[n],o=this.i.template.forPlots(t),this.plots[t].proto.options.x=o.x,this.plots[t].proto.options.y=o.y,console.log("Initialize Plot Options (template, plot)",this.i.template.full(t),this.plots[t].proto.options),this.i.controls.append(t),this.plots[t].proto.removeTemp()},t.prototype.addStation=function(t,e){var i,o,n,r
return this.plots[t].proto.initialized?(i=this.plots[t].proto.getState(),r=i.range.data[0].max.getTime(),o=$.extend(!0,{},this.plots[t].proto.options.y[0]),o.dataLoggerId=e,o.color=this.i.colors.get(e),n=this.plots[t].proto.options.y.push(o)-1,this.i.controls.updateStationDropdown(t),this.i.controls.updateStationMap(t),this.i.livesync.add(t,n,i),!0):(this.plots[t].proto.options.y[0].dataLoggerId=e,this.plots[t].proto.options.y[0].color=this.i.colors.get(e),this.i.initialsync.add(t),this.i.controls.updateStationDropdown(t),this.i.controls.updateStationMap(t),!0)},t.prototype.removeStation=function(t,e){var i
return i=this.lib.indexOfValue(this.plots[t].proto.options.y,"dataLoggerId",e),this.i.template.template[t].y.splice(i,1),this.plots[t].proto.getDefinition(),this.plots[t].proto.removeData(i),this.plots[t].proto.update(),this.i.controls.updateStationDropdown(t),this.i.controls.updateStationMap(t),this.i.controls.removeSpinner(t)},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Specs=t=function(){function t(){}return t.prototype.getOptions=function(t,e){var i,o,n
return i=this.getVariableBounds(t),o=this.getVariableInfo(t),n={dataLoggerId:e,variable:t,min:i.min,max:i.max,maxBar:i.maxBar,title:o.title,units:o.units}},t.prototype.getVariableBounds=function(t){var e
return e={battery_voltage:{min:8,max:16,maxBar:null},net_solar:{min:0,max:800,maxBar:null},relative_humidity:{min:0,max:102,maxBar:null},snow_depth:{min:0,max:40,maxBar:null},wind_direction:{min:0,max:360,maxBar:null},precipitation:{min:0,max:.7,maxBar:null},temperature:{min:0,max:60,maxBar:32},wind_speed_average:{min:0,max:60,maxBar:null}},e[t]},t.prototype.getVariableInfo=function(t){var e
return e={battery_voltage:{title:"Battery Voltage",units:"V"},net_solar:{title:"Solar Radiation",units:"W/m2"},relative_humidity:{title:"Relative Humidity",units:"%"},barometric_pressure:{title:"Barometric Pressure",units:"atm"},snow_depth:{title:"Snow Depth",units:'"'},wind_direction:{title:"Wind Direction",units:""},precipitation:{title:"Precipitation",units:'"'},temperature:{title:"Temperature",units:"F"},wind_speed_average:{title:"Wind Speed",units:"mph"}},e[t]},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Template=t=function(){function t(t){this.preError="Plotter.Template.",this.plotter=t,this.api=this.plotter.i.api,this.sapi=this.plotter.i.sapi,this.template=null,this.dataSets=0,this.isValid=function(t){var e,i,o,n,r,s,a
for(e=0,o=t.length;e<o;e++){if(s=t[e],void 0===s.type)return!1
if(void 0===s.x)return!1
if(void 0===s.y)return!1
if(void 0===s.x.variable)return!1
if(void 0===s.x.min)return!1
if(void 0===s.x.max)return!1
if(void 0===s.y[0])return!1
for(r=s.y,i=0,n=r.length;i<n;i++){if(a=r[i],void 0===a.dataLoggerId)return!1
if(void 0===a.variable)return!1
if(void 0===a.title)return!1
if(void 0===a.units)return!1}}return!0},this.newIsValid=function(t){var e,i,o
for(e=0,i=t.length;e<i;e++)if(o=t[e],void 0===o.type)return!1
return!0},this.parse=function(t){var e,i,o,n
if(e=JSON.parse(t).templateData,this.isValid(e)){for(i=0,o=e.length;i<o;i++)n=e[i],n.x.min=new window.Plotter.Now(this.plotter.lib.format,n.x.min).get(),n.x.max=new window.Plotter.Now(this.plotter.lib.format,n.x.max).get()
return e}throw new Error("Plotter template format is invalid. Reference a working example.")},this.stringify=function(){var t
return t={templateData:this.template},JSON.stringify(t)},this.endpoint=function(){return this.plotter.options.href+"/api/v5/plothandler/"}}return t.prototype.get=function(){var t,e,i,o,n
return o=this.preError+"get()",n=this.endpoint()+this.plotter.options.templateId,e=null,t=this,i=function(e){if(null===e.responseJSON||e.responseJSON.error)throw new Error(o+".callback(data) error retrieving template.")
return t.template=t.parse(e.responseJSON.template_data)},this.sapi.get(n,e,i)},t.prototype.put=function(){var t,e,i,o,n
if(o=this.preError+"put()",this.plotter.isAdmin()===!1)throw new Error(o+", not authorized for PUT requests.")
return n=this.endpoint(),e={id:this.plotter.options.templateId,template_data:this.stringify(this.template)},t=this,i=function(t){return console.log("Template PUT completed (data)",t)},this.api.put(n,e,i)},t.prototype.add=function(t){var e,i,o
return o=this.preError+"add(options)",i=this.template.push(t)-1,e=function(){if(!this.newIsValid(this.template))throw new Error(o+" template invalid after adding new plot.")}.call(this),i},t.prototype.plotCount=function(){return this.template.length},t.prototype.dataSetCount=function(t){return this.template[t].y.length},t.prototype.full=function(){return this.template},t.prototype.forSync=function(t,e,i,o){var n
return n={data_logger:this.template[t].y[e].dataLoggerId,max_datetime:i,limit:o}},t.prototype.forControls=function(){},t.prototype.forPlots=function(t){var e,i,o,n,r,s
for(i=this.template[t].x,o=this.template[t].y,n=0,r=o.length;n<r;n++)e=o[n],"wind_speed_average"===e.variable&&(e.band={minVariable:"wind_speed_minimum",maxVariable:"wind_speed_maximum"})
return s={plotId:t,x:i,y:o}},t.prototype.removePlot=function(t){return delete this.template[t]},t}()}.call(this),function(){var t
window.Plotter||(window.Plotter={}),window.Plotter.Zoom=t=function(){function t(t){this.preError="Plotter.Zoom.",this.plotter=t}return t.prototype.set=function(t){var e,i,o,n,r
for(n=this.plotter.plots,r=[],e=0,i=n.length;e<i;e++)o=n[e],null!=o?r.push(o.proto.setZoomTransform(t)):r.push(void 0)
return r},t}()}.call(this)
